<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NPS Real Time Engine â€” Simulador</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
<style>
:root {
  --bg-primary: #0a0a0f;
  --bg-secondary: #12121a;
  --bg-card: rgba(255,255,255,0.04);
  --bg-glass: rgba(255,255,255,0.06);
  --border-glass: rgba(255,255,255,0.08);
  --text-primary: #f0f0f5;
  --text-secondary: #8888a0;
  --text-muted: #55556a;
  --green: #00e676;
  --green-bg: rgba(0,230,118,0.1);
  --green-glow: rgba(0,230,118,0.3);
  --yellow: #ffd600;
  --yellow-bg: rgba(255,214,0,0.1);
  --yellow-glow: rgba(255,214,0,0.3);
  --red: #ff5252;
  --red-bg: rgba(255,82,82,0.1);
  --red-glow: rgba(255,82,82,0.3);
  --indigo: #536dfe;
  --indigo-bg: rgba(83,109,254,0.1);
  --indigo-glow: rgba(83,109,254,0.3);
  --purple: #b388ff;
  --cyan: #00e5ff;
  --meta: 36.6;
}
* { margin:0; padding:0; box-sizing:border-box; }
body {
  font-family:'Inter',sans-serif;
  background:var(--bg-primary);
  color:var(--text-primary);
  min-height:100vh;
  overflow-x:hidden;
}

/* â•â•â•â•â•â• PARTICLES â•â•â•â•â•â• */
#particles {
  position:fixed; top:0; left:0; width:100%; height:100%;
  pointer-events:none; z-index:0; overflow:hidden;
}
.particle {
  position:absolute; border-radius:50%; opacity:0.15;
  animation:floatP linear infinite;
}
@keyframes floatP {
  0%  { transform:translateY(100vh) scale(0); opacity:0; }
  10% { opacity:0.15; }
  90% { opacity:0.15; }
  100%{ transform:translateY(-10vh) scale(1); opacity:0; }
}

/* â•â•â•â•â•â• LAYOUT â•â•â•â•â•â• */
.app { position:relative; z-index:1; max-width:1400px; margin:0 auto; padding:20px; }

/* â•â•â•â•â•â• HEADER â•â•â•â•â•â• */
.header {
  display:flex; align-items:center; justify-content:space-between;
  padding:20px 28px; margin-bottom:24px;
  background:var(--bg-glass); border:1px solid var(--border-glass);
  border-radius:20px; backdrop-filter:blur(20px);
}
.header-left { display:flex; align-items:center; gap:16px; }
.header-logo {
  width:48px; height:48px; border-radius:14px;
  background:linear-gradient(135deg, var(--indigo), var(--purple));
  display:flex; align-items:center; justify-content:center;
  font-size:22px; font-weight:800; color:#fff;
}
.header-title { font-size:20px; font-weight:700; letter-spacing:-0.5px; }
.header-sub { font-size:12px; color:var(--text-secondary); margin-top:2px; }
.live-badge {
  display:flex; align-items:center; gap:8px;
  padding:8px 16px; border-radius:30px;
  background:rgba(255,82,82,0.12); border:1px solid rgba(255,82,82,0.25);
  font-size:13px; font-weight:600; color:var(--red);
}
.live-dot {
  width:10px; height:10px; border-radius:50%; background:var(--red);
  animation:pulse-dot 1.5s ease-in-out infinite;
}
@keyframes pulse-dot {
  0%,100% { box-shadow:0 0 0 0 rgba(255,82,82,0.6); }
  50% { box-shadow:0 0 0 8px rgba(255,82,82,0); }
}

/* â•â•â•â•â•â• STATS ROW â•â•â•â•â•â• */
.stats-row {
  display:grid; grid-template-columns:repeat(4,1fr); gap:16px; margin-bottom:24px;
}
.stat-card {
  background:var(--bg-glass); border:1px solid var(--border-glass);
  border-radius:16px; padding:20px; backdrop-filter:blur(12px);
  text-align:center; transition:all 0.4s;
}
.stat-card:hover { border-color:rgba(255,255,255,0.15); transform:translateY(-2px); }
.stat-card.green-accent { border-left:3px solid var(--green); }
.stat-card.yellow-accent { border-left:3px solid var(--yellow); }
.stat-card.red-accent { border-left:3px solid var(--red); }
.stat-card.indigo-accent { border-left:3px solid var(--indigo); }
.stat-label { font-size:11px; font-weight:600; color:var(--text-secondary); text-transform:uppercase; letter-spacing:1px; margin-bottom:8px; }
.stat-value { font-size:36px; font-weight:800; letter-spacing:-1px; line-height:1; }
.stat-value.green { color:var(--green); }
.stat-value.yellow { color:var(--yellow); }
.stat-value.red { color:var(--red); }
.stat-value.indigo { color:var(--indigo); }
.stat-sub { font-size:11px; color:var(--text-muted); margin-top:6px; }

/* â•â•â•â•â•â• NPS BAR â•â•â•â•â•â• */
.nps-bar-section { margin-bottom:24px; }
.nps-bar-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:10px; padding:0 4px; }
.nps-bar-label { font-size:13px; font-weight:600; color:var(--text-secondary); }
.nps-bar-value { font-size:22px; font-weight:800; }
.nps-bar-track {
  height:14px; background:var(--bg-glass); border-radius:10px; overflow:hidden; position:relative;
  border:1px solid var(--border-glass);
}
.nps-bar-fill {
  height:100%; border-radius:10px; transition:width 0.8s cubic-bezier(0.16,1,0.3,1), background 0.5s;
  position:relative;
}
.nps-bar-fill::after {
  content:''; position:absolute; top:0; right:0; bottom:0; left:0;
  background:linear-gradient(90deg, transparent 0%, rgba(255,255,255,0.15) 50%, transparent 100%);
  animation:shimmer 2s infinite;
}
@keyframes shimmer { 0%{transform:translateX(-100%)} 100%{transform:translateX(100%)} }
.nps-meta-marker {
  position:absolute; top:-6px; bottom:-6px; width:2px;
  background:var(--yellow); border-radius:2px; z-index:2;
  transition:left 0.8s cubic-bezier(0.16,1,0.3,1);
}
.nps-meta-label {
  position:absolute; top:-22px; transform:translateX(-50%);
  font-size:10px; font-weight:700; color:var(--yellow);
  white-space:nowrap;
}

/* â•â•â•â•â•â• MAIN GRID â•â•â•â•â•â• */
.main-grid {
  display:grid; grid-template-columns:1fr 380px; gap:20px; margin-bottom:24px;
}

/* â•â•â•â•â•â• RACHAS â•â•â•â•â•â• */
.section-card {
  background:var(--bg-glass); border:1px solid var(--border-glass);
  border-radius:18px; padding:22px; backdrop-filter:blur(12px);
}
.section-title {
  font-size:14px; font-weight:700; text-transform:uppercase; letter-spacing:1px;
  color:var(--text-secondary); margin-bottom:16px; display:flex; align-items:center; gap:8px;
}
.racha-row {
  display:flex; align-items:center; gap:12px; padding:12px 14px;
  border-radius:12px; margin-bottom:8px; transition:all 0.3s;
  background:rgba(255,255,255,0.02); border:1px solid transparent;
}
.racha-row:hover { background:rgba(255,255,255,0.04); border-color:var(--border-glass); }
.racha-avatar {
  width:38px; height:38px; border-radius:10px; display:flex;
  align-items:center; justify-content:center; font-size:15px; font-weight:700;
  flex-shrink:0;
}
.racha-info { flex:1; min-width:0; }
.racha-name { font-size:13px; font-weight:600; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
.racha-stats { font-size:11px; color:var(--text-muted); margin-top:2px; }
.racha-dots { display:flex; gap:4px; flex-wrap:wrap; margin-top:4px; }
.racha-dot {
  width:20px; height:20px; border-radius:6px; font-size:10px;
  display:flex; align-items:center; justify-content:center; font-weight:700;
  transition:all 0.3s; animation:dotIn 0.4s cubic-bezier(0.34,1.56,0.64,1) backwards;
}
@keyframes dotIn { from{transform:scale(0);opacity:0} to{transform:scale(1);opacity:1} }
.racha-dot.P { background:var(--green-bg); color:var(--green); border:1px solid rgba(0,230,118,0.2); }
.racha-dot.N { background:var(--yellow-bg); color:var(--yellow); border:1px solid rgba(255,214,0,0.2); }
.racha-dot.D { background:var(--red-bg); color:var(--red); border:1px solid rgba(255,82,82,0.2); }
.racha-streak {
  font-size:12px; font-weight:700; padding:4px 10px; border-radius:8px; white-space:nowrap;
}

/* â•â•â•â•â•â• FEED DE ALERTAS â•â•â•â•â•â• */
.feed-container { max-height:500px; overflow-y:auto; padding-right:4px; }
.feed-container::-webkit-scrollbar { width:4px; }
.feed-container::-webkit-scrollbar-thumb { background:rgba(255,255,255,0.1); border-radius:4px; }
.alert-card {
  padding:16px; border-radius:14px; margin-bottom:10px;
  border:1px solid; animation:slideIn 0.5s cubic-bezier(0.16,1,0.3,1);
  position:relative; overflow:hidden;
}
@keyframes slideIn { from{transform:translateX(60px);opacity:0} to{transform:translateX(0);opacity:1} }
.alert-card.detractor {
  background:var(--red-bg); border-color:rgba(255,82,82,0.2);
}
.alert-card.promotor {
  background:var(--green-bg); border-color:rgba(0,230,118,0.2);
}
.alert-card.neutro {
  background:var(--yellow-bg); border-color:rgba(255,214,0,0.2);
}
.alert-card.pattern {
  background:var(--indigo-bg); border-color:rgba(83,109,254,0.2);
}
.alert-card.achievement {
  background:linear-gradient(135deg, rgba(179,136,255,0.12), rgba(0,229,255,0.08));
  border-color:rgba(179,136,255,0.25);
}
.alert-header { display:flex; align-items:center; gap:8px; margin-bottom:8px; }
.alert-icon { font-size:18px; }
.alert-type { font-size:11px; font-weight:700; text-transform:uppercase; letter-spacing:1px; }
.alert-time { font-size:10px; color:var(--text-muted); margin-left:auto; }
.alert-body { font-size:12px; line-height:1.6; color:var(--text-secondary); }
.alert-body strong { color:var(--text-primary); font-weight:600; }
.alert-espejo {
  margin-top:10px; padding:10px 12px; border-radius:10px;
  background:rgba(255,255,255,0.04); border:1px solid rgba(255,255,255,0.06);
}
.alert-espejo-title { font-size:10px; font-weight:700; color:var(--green); text-transform:uppercase; letter-spacing:1px; margin-bottom:6px; }
.alert-espejo-item { font-size:11px; color:var(--text-secondary); margin-bottom:3px; }
.alert-pattern-box {
  margin-top:10px; padding:10px 12px; border-radius:10px;
  background:rgba(83,109,254,0.08); border:1px solid rgba(83,109,254,0.15);
}
.alert-pattern-title { font-size:10px; font-weight:700; color:var(--indigo); text-transform:uppercase; letter-spacing:1px; margin-bottom:4px; }

/* â•â•â•â•â•â• ACHIEVEMENT POPUP â•â•â•â•â•â• */
.achievement-overlay {
  position:fixed; top:0; left:0; width:100%; height:100%; z-index:1000;
  background:rgba(0,0,0,0.7); backdrop-filter:blur(8px);
  display:none; align-items:center; justify-content:center;
  animation:fadeIn 0.3s;
}
.achievement-overlay.show { display:flex; }
@keyframes fadeIn { from{opacity:0} to{opacity:1} }
.achievement-box {
  text-align:center; padding:50px 60px; border-radius:28px;
  background:linear-gradient(135deg, rgba(179,136,255,0.15), rgba(0,229,255,0.1));
  border:1px solid rgba(179,136,255,0.3);
  backdrop-filter:blur(20px);
  animation:achieveIn 0.6s cubic-bezier(0.34,1.56,0.64,1);
}
@keyframes achieveIn { from{transform:scale(0.5) rotate(-5deg);opacity:0} to{transform:scale(1) rotate(0);opacity:1} }
.achievement-emoji { font-size:72px; margin-bottom:16px; animation:bounce 0.8s ease infinite alternate; }
@keyframes bounce { from{transform:translateY(0)} to{transform:translateY(-12px)} }
.achievement-title { font-size:24px; font-weight:800; letter-spacing:-0.5px; background:linear-gradient(135deg,var(--purple),var(--cyan)); -webkit-background-clip:text; -webkit-text-fill-color:transparent; margin-bottom:8px; }
.achievement-desc { font-size:14px; color:var(--text-secondary); }
.achievement-close { margin-top:20px; padding:10px 28px; border-radius:12px; border:1px solid rgba(179,136,255,0.3); background:rgba(179,136,255,0.1); color:var(--purple); font-weight:600; cursor:pointer; font-size:13px; transition:all 0.3s; }
.achievement-close:hover { background:rgba(179,136,255,0.2); }

/* â•â•â•â•â•â• CIERRE TURNO MODAL â•â•â•â•â•â• */
.cierre-overlay {
  position:fixed; top:0; left:0; width:100%; height:100%; z-index:1000;
  background:rgba(0,0,0,0.75); backdrop-filter:blur(10px);
  display:none; align-items:center; justify-content:center;
}
.cierre-overlay.show { display:flex; }
.cierre-box {
  width:90%; max-width:600px; padding:36px; border-radius:24px;
  background:var(--bg-secondary); border:1px solid var(--border-glass);
  animation:achieveIn 0.5s cubic-bezier(0.16,1,0.3,1);
}
.cierre-header { text-align:center; margin-bottom:24px; }
.cierre-turno-label { font-size:12px; font-weight:700; text-transform:uppercase; letter-spacing:2px; color:var(--indigo); margin-bottom:6px; }
.cierre-hora { font-size:28px; font-weight:800; letter-spacing:-1px; }
.cierre-week {
  display:grid; grid-template-columns:repeat(5,1fr); gap:10px; margin-bottom:24px;
}
.cierre-day {
  text-align:center; padding:14px 8px; border-radius:14px;
  background:var(--bg-glass); border:1px solid var(--border-glass);
  transition:all 0.3s;
}
.cierre-day.today { border-color:var(--indigo); background:var(--indigo-bg); }
.cierre-day.future { opacity:0.35; }
.cierre-day-name { font-size:11px; font-weight:700; color:var(--text-muted); text-transform:uppercase; margin-bottom:6px; }
.cierre-day-enc { font-size:22px; font-weight:800; margin-bottom:2px; }
.cierre-day-nps { font-size:13px; font-weight:600; }
.cierre-summary {
  text-align:center; padding:18px; border-radius:14px;
  background:var(--bg-glass); border:1px solid var(--border-glass); margin-bottom:18px;
}
.cierre-summary-nps { font-size:32px; font-weight:800; }
.cierre-summary-label { font-size:12px; color:var(--text-secondary); margin-top:4px; }
.cierre-message {
  text-align:center; font-size:14px; color:var(--text-secondary);
  line-height:1.7; font-style:italic;
}
.cierre-close { display:block; margin:20px auto 0; padding:10px 32px; border-radius:12px; border:1px solid var(--border-glass); background:var(--bg-glass); color:var(--text-primary); font-weight:600; cursor:pointer; font-size:13px; transition:all 0.3s; }
.cierre-close:hover { background:rgba(255,255,255,0.08); }

/* â•â•â•â•â•â• SIMULATOR BUTTONS â•â•â•â•â•â• */
.sim-section {
  background:var(--bg-glass); border:1px solid var(--border-glass);
  border-radius:18px; padding:22px; backdrop-filter:blur(12px); margin-bottom:24px;
}
.sim-grid {
  display:grid; grid-template-columns:repeat(4,1fr); gap:10px;
}
.sim-btn {
  padding:14px 10px; border-radius:14px; border:1px solid;
  font-family:'Inter',sans-serif; font-size:12px; font-weight:600;
  cursor:pointer; transition:all 0.3s; display:flex; flex-direction:column;
  align-items:center; gap:6px; text-align:center;
}
.sim-btn:hover { transform:translateY(-2px); }
.sim-btn:active { transform:scale(0.96); }
.sim-btn.green-btn { background:var(--green-bg); border-color:rgba(0,230,118,0.2); color:var(--green); }
.sim-btn.green-btn:hover { box-shadow:0 4px 20px var(--green-glow); }
.sim-btn.red-btn { background:var(--red-bg); border-color:rgba(255,82,82,0.2); color:var(--red); }
.sim-btn.red-btn:hover { box-shadow:0 4px 20px var(--red-glow); }
.sim-btn.yellow-btn { background:var(--yellow-bg); border-color:rgba(255,214,0,0.2); color:var(--yellow); }
.sim-btn.yellow-btn:hover { box-shadow:0 4px 20px var(--yellow-glow); }
.sim-btn.indigo-btn { background:var(--indigo-bg); border-color:rgba(83,109,254,0.2); color:var(--indigo); }
.sim-btn.indigo-btn:hover { box-shadow:0 4px 20px var(--indigo-glow); }
.sim-btn.purple-btn { background:rgba(179,136,255,0.1); border-color:rgba(179,136,255,0.2); color:var(--purple); }
.sim-btn.purple-btn:hover { box-shadow:0 4px 20px rgba(179,136,255,0.3); }
.sim-btn-icon { font-size:24px; }

/* â•â•â•â•â•â• CONFETTI â•â•â•â•â•â• */
.confetti-piece {
  position:fixed; width:10px; height:10px; z-index:1001;
  animation:confettiFall linear forwards; pointer-events:none;
}
@keyframes confettiFall {
  0%   { transform:translateY(-10vh) rotate(0deg); opacity:1; }
  100% { transform:translateY(110vh) rotate(720deg); opacity:0; }
}

/* â•â•â•â•â•â• FLASH â•â•â•â•â•â• */
.flash-overlay {
  position:fixed; top:0; left:0; width:100%; height:100%;
  pointer-events:none; z-index:999; opacity:0;
  transition:opacity 0.1s;
}
.flash-overlay.red { background:rgba(255,82,82,0.15); }
.flash-overlay.green { background:rgba(0,230,118,0.1); }
.flash-overlay.show { opacity:1; }

/* â•â•â•â•â•â• FOOTER â•â•â•â•â•â• */
.footer {
  text-align:center; padding:20px; font-size:11px; color:var(--text-muted);
}

/* â•â•â•â•â•â• RESPONSIVE â•â•â•â•â•â• */
@media(max-width:900px) {
  .stats-row { grid-template-columns:repeat(2,1fr); }
  .main-grid { grid-template-columns:1fr; }
  .sim-grid { grid-template-columns:repeat(2,1fr); }
}
@media(max-width:480px) {
  .stats-row { grid-template-columns:1fr; }
  .sim-grid { grid-template-columns:1fr; }
  .header { flex-direction:column; gap:12px; text-align:center; }
  .cierre-week { grid-template-columns:repeat(3,1fr); }
}
</style>
</head>
<body>

<!-- PARTICLES -->
<div id="particles"></div>

<!-- FLASH OVERLAYS -->
<div class="flash-overlay red" id="flashRed"></div>
<div class="flash-overlay green" id="flashGreen"></div>

<!-- ACHIEVEMENT POPUP -->
<div class="achievement-overlay" id="achievementOverlay">
  <div class="achievement-box">
    <div class="achievement-emoji" id="achieveEmoji">ğŸ’</div>
    <div class="achievement-title" id="achieveTitle">Â¡LOGRO DESBLOQUEADO!</div>
    <div class="achievement-desc" id="achieveDesc">Racha perfecta de 5 promotores</div>
    <button class="achievement-close" onclick="closeAchievement()">Â¡Genial! âœ¨</button>
  </div>
</div>

<!-- CIERRE TURNO MODAL -->
<div class="cierre-overlay" id="cierreOverlay">
  <div class="cierre-box">
    <div class="cierre-header">
      <div class="cierre-turno-label" id="cierreTurnoLabel">CIERRE TURNO MAÃ‘ANA</div>
      <div class="cierre-hora" id="cierreHora">ğŸ“Š 12:25 PM</div>
    </div>
    <div class="cierre-week" id="cierreWeek"></div>
    <div class="cierre-summary">
      <div class="cierre-summary-nps" id="cierreNpsSemana">--</div>
      <div class="cierre-summary-label">NPS Acumulado Semana Â· Meta: 36.6%</div>
    </div>
    <div class="cierre-message" id="cierreMsg"></div>
    <button class="cierre-close" onclick="closeCierre()">Cerrar</button>
  </div>
</div>

<!-- APP -->
<div class="app">

  <!-- HEADER -->
  <div class="header">
    <div class="header-left">
      <div class="header-logo">N</div>
      <div>
        <div class="header-title">NPS Real Time Engine</div>
        <div class="header-sub">Publicaciones Sellers Mature Â· Simulador Interactivo</div>
      </div>
    </div>
    <div class="live-badge">
      <div class="live-dot"></div>
      LIVE SIM
    </div>
  </div>

  <!-- STATS -->
  <div class="stats-row">
    <div class="stat-card green-accent">
      <div class="stat-label">Promotores</div>
      <div class="stat-value green" id="countP">0</div>
      <div class="stat-sub">hoy</div>
    </div>
    <div class="stat-card yellow-accent">
      <div class="stat-label">Neutros</div>
      <div class="stat-value yellow" id="countN">0</div>
      <div class="stat-sub">hoy</div>
    </div>
    <div class="stat-card red-accent">
      <div class="stat-label">Detractores</div>
      <div class="stat-value red" id="countD">0</div>
      <div class="stat-sub">hoy</div>
    </div>
    <div class="stat-card indigo-accent">
      <div class="stat-label">Encuestas</div>
      <div class="stat-value indigo" id="countTotal">0</div>
      <div class="stat-sub">hoy</div>
    </div>
  </div>

  <!-- NPS BAR -->
  <div class="nps-bar-section">
    <div class="nps-bar-header">
      <span class="nps-bar-label">NPS HOY</span>
      <span class="nps-bar-value" id="npsValue" style="color:var(--text-muted)">--%</span>
    </div>
    <div class="nps-bar-track" style="position:relative">
      <div class="nps-bar-fill" id="npsFill" style="width:50%;background:var(--text-muted)"></div>
      <div class="nps-meta-marker" id="npsMeta" style="left:68.3%">
        <div class="nps-meta-label">Meta 36.6%</div>
      </div>
    </div>
  </div>

  <!-- MAIN GRID -->
  <div class="main-grid">

    <!-- RACHAS -->
    <div class="section-card">
      <div class="section-title">ğŸ”¥ Rachas en Vivo</div>
      <div id="rachasContainer"></div>
    </div>

    <!-- FEED -->
    <div class="section-card">
      <div class="section-title">ğŸ“¡ Feed en Tiempo Real</div>
      <div class="feed-container" id="feedContainer">
        <div style="text-align:center;padding:40px 0;color:var(--text-muted);font-size:13px;">
          Oprime un botÃ³n del simulador para empezar...
        </div>
      </div>
    </div>

  </div>

  <!-- SIMULATOR BUTTONS -->
  <div class="sim-section">
    <div class="section-title">ğŸ® Simulador</div>
    <div class="sim-grid">
      <button class="sim-btn green-btn" onclick="simPromotor()">
        <span class="sim-btn-icon">ğŸŸ¢</span>
        Llega Promotor
      </button>
      <button class="sim-btn red-btn" onclick="simDetractor()">
        <span class="sim-btn-icon">ğŸ”´</span>
        Llega Detractor
      </button>
      <button class="sim-btn yellow-btn" onclick="simNeutro()">
        <span class="sim-btn-icon">ğŸŸ¡</span>
        Llega Neutro
      </button>
      <button class="sim-btn indigo-btn" onclick="simCierreAM()">
        <span class="sim-btn-icon">ğŸŒ…</span>
        Cierre AM 12:25
      </button>
      <button class="sim-btn indigo-btn" onclick="simCierrePM()">
        <span class="sim-btn-icon">ğŸŒ‡</span>
        Cierre PM 6:30
      </button>
      <button class="sim-btn purple-btn" onclick="simLogro()">
        <span class="sim-btn-icon">ğŸ†</span>
        Logro Desbloqueado
      </button>
      <button class="sim-btn purple-btn" onclick="simPatron()">
        <span class="sim-btn-icon">ğŸ§ </span>
        Alerta PatrÃ³n
      </button>
      <button class="sim-btn" style="background:rgba(255,255,255,0.04);border-color:var(--border-glass);color:var(--text-secondary);" onclick="simReset()">
        <span class="sim-btn-icon">ğŸ”„</span>
        Reset DÃ­a
      </button>
    </div>
  </div>

  <div class="footer">
    hecho por juan sebastian guerrero rodriguez, hecho con el ğŸ’›<br>
    <span style="font-size:10px;opacity:0.5">NPS Real Time Engine Â· Simulador Demo Â· 2026</span>
  </div>

</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<!-- PARTE 2 DEL SCRIPT VA AQUÃ (siguiente mensaje) -->
<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DATA FICTICIA
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const REPS = [
  { id:'pepitoperez', name:'Pepito PÃ©rez', avatar:'PP', color:'#536dfe' },
  { id:'mariagarcia', name:'MarÃ­a GarcÃ­a', avatar:'MG', color:'#00e676' },
  { id:'carlosruiz', name:'Carlos Ruiz', avatar:'CR', color:'#ff5252' },
  { id:'anamoreno', name:'Ana Moreno', avatar:'AM', color:'#b388ff' },
  { id:'luisdiaz', name:'Luis DÃ­az', avatar:'LD', color:'#ffd600' },
  { id:'sofialopez', name:'SofÃ­a LÃ³pez', avatar:'SL', color:'#00e5ff' },
  { id:'diegotorres', name:'Diego Torres', avatar:'DT', color:'#ff9100' },
  { id:'valeriacast', name:'Valeria Castro', avatar:'VC', color:'#69f0ae' },
  { id:'andresrios', name:'AndrÃ©s RÃ­os', avatar:'AR', color:'#ea80fc' }
];

const PROCESOS = [
  'ReputaciÃ³n ME - Reclamo afecta la reputaciÃ³n',
  'PR - Propiedad Intelectual - Denuncia',
  'GestiÃ³n de PublicaciÃ³n - Modificar variantes',
  'Potenciador - Eventos comerciales T1, T2 y T3',
  'Calidad de Fotos - Mejorar fotos del producto',
  'ReputaciÃ³n ME Ventas - LogÃ­stica Places',
  'Antes de Publicar - CorrecciÃ³n de catÃ¡logo',
  'PR TÃ©cnica - Datos tÃ©cnicos del producto',
  'PR Art Prohib - ArtÃ­culos prohibidos',
  'GestiÃ³n Pub - ModeraciÃ³n de publicaciÃ³n'
];

const SOLUCIONES = [
  'Analizamos reputaciÃ³n y mantenemos impacto',
  'Denuncia recibida - Procedemos con anÃ¡lisis',
  'Modificar variantes, fotos y precio por variaciÃ³n',
  'Beneficios del potenciador explicados',
  'CatÃ¡logo - Sugerencia de correcciÃ³n enviada',
  'ReputaciÃ³n ME Ventas: LogÃ­stica Places - Excluimos',
  'Fotos actualizadas correctamente',
  'Datos tÃ©cnicos corregidos en la publicaciÃ³n',
  'ArtÃ­culo restringido - Alternativas ofrecidas',
  'PublicaciÃ³n moderada exitosamente'
];

const COMENTARIOS_P = [
  'Pudieron solucionar mi problema, excelente atenciÃ³n',
  'Muy buena ayuda, resolvieron rÃ¡pido',
  'La asesora fue muy amable y clara',
  'Fue buena, me explicaron todo paso a paso',
  'Excelente servicio, en pocos minutos quedÃ³ resuelto',
  'Me ayudaron perfecto con mi publicaciÃ³n',
  'SÃºper rÃ¡pido y efectivo, muchas gracias'
];

const COMENTARIOS_D = [
  'No me solucionaron el problema, sigo igual',
  'No utilizan el criterio ni el sentido comÃºn para responder',
  'Tienen un speech prearmado y no se salen del texto',
  'La asesora no terminÃ³ de ayudarme, me cortÃ³ la conversaciÃ³n',
  'El vendedor siempre pierde dinero tiempo esfuerzo',
  'Tardaron demasiado y no resolvieron nada',
  'Me pasaron de un asesor a otro sin soluciÃ³n'
];

const COMENTARIOS_N = [
  'Fue normal, ni bien ni mal',
  'Resolvieron pero tardaron bastante',
  'MÃ¡s o menos, esperaba algo mejor',
  'AtenciÃ³n regular, el proceso es muy largo',
  'No fue mala pero tampoco excelente'
];

const LOGROS = [
  { emoji:'ğŸ’', title:'RACHA PERFECTA', desc:'5 promotores seguidos sin parar' },
  { emoji:'ğŸ”¥', title:'EN LLAMAS', desc:'3 promotores consecutivos, Â¡sigue asÃ­!' },
  { emoji:'ğŸ›¡ï¸', title:'RECUPERACIÃ“N Ã‰PICA', desc:'Promotor justo despuÃ©s de un detractor' },
  { emoji:'â­', title:'ESTRELLA DEL DÃA', desc:'Mayor NPS del equipo con 5+ encuestas' },
  { emoji:'ğŸš€', title:'PRIMER PROMOTOR', desc:'Â¡ArrancÃ³ el dÃ­a con todo!' },
  { emoji:'ğŸ‘‘', title:'INVICTO', desc:'0 detractores en todo el dÃ­a' }
];

const WEEK_DATA = [
  { day:'Lun', enc:14, p:8, n:2, d:4 },
  { day:'Mar', enc:18, p:11, n:3, d:4 },
  { day:'MiÃ©', enc:12, p:6, n:2, d:4 },
  { day:'Jue', enc:0, p:0, n:0, d:0 },
  { day:'Vie', enc:0, p:0, n:0, d:0 }
];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let state = {
  promotores: 0,
  neutros: 0,
  detractores: 0,
  rachas: {},
  feedStarted: false,
  caseCounter: 436200000,
  hourCounter: 8
};

// Init rachas
REPS.forEach(r => { state.rachas[r.id] = []; });

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PARTICLES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function initParticles() {
  const c = document.getElementById('particles');
  const colors = ['var(--green)','var(--indigo)','var(--purple)','var(--cyan)','var(--yellow)'];
  for (let i = 0; i < 30; i++) {
    const p = document.createElement('div');
    p.className = 'particle';
    const size = Math.random()*4+2;
    p.style.cssText = `
      width:${size}px; height:${size}px;
      left:${Math.random()*100}%;
      background:${colors[Math.floor(Math.random()*colors.length)]};
      animation-duration:${Math.random()*15+10}s;
      animation-delay:${Math.random()*10}s;
    `;
    c.appendChild(p);
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RENDER RACHAS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderRachas() {
  const c = document.getElementById('rachasContainer');
  // Sort by activity
  const sorted = [...REPS].sort((a,b) => {
    const ra = state.rachas[a.id]||[], rb = state.rachas[b.id]||[];
    return rb.length - ra.length;
  });
  
  c.innerHTML = sorted.map(rep => {
    const dots = state.rachas[rep.id] || [];
    if (dots.length === 0) return '';
    
    const streak = calcStreak(dots);
    const streakInfo = getStreakInfo(streak, dots);
    
    return `
      <div class="racha-row">
        <div class="racha-avatar" style="background:${rep.color}22;color:${rep.color};border:1px solid ${rep.color}33">
          ${rep.avatar}
        </div>
        <div class="racha-info">
          <div class="racha-name">${rep.name}</div>
          <div class="racha-stats">${dots.length} enc Â· ${dots.filter(d=>d==='P').length}P ${dots.filter(d=>d==='N').length}N ${dots.filter(d=>d==='D').length}D</div>
          <div class="racha-dots">
            ${dots.map((d,i) => `<div class="racha-dot ${d}" style="animation-delay:${i*0.05}s">${d}</div>`).join('')}
          </div>
        </div>
        <div class="racha-streak" style="background:${streakInfo.bg};color:${streakInfo.color}">
          ${streakInfo.icon} ${streak.count}
        </div>
      </div>
    `;
  }).filter(Boolean).join('') || '<div style="text-align:center;padding:30px;color:var(--text-muted);font-size:13px;">Sin encuestas aÃºn...</div>';
}

function calcStreak(dots) {
  if (!dots.length) return { type:null, count:0 };
  let last = dots[dots.length-1];
  let count = 0;
  for (let i = dots.length-1; i >= 0; i--) {
    if (dots[i] === last) count++;
    else break;
  }
  return { type:last, count };
}

function getStreakInfo(streak, dots) {
  if (!streak.type) return { icon:'', bg:'transparent', color:'var(--text-muted)' };
  const m = {
    'P': { icon:'ğŸ”¥', bg:'var(--green-bg)', color:'var(--green)' },
    'N': { icon:'ğŸ˜', bg:'var(--yellow-bg)', color:'var(--yellow)' },
    'D': { icon:'âš ï¸', bg:'var(--red-bg)', color:'var(--red)' }
  };
  return m[streak.type] || { icon:'', bg:'transparent', color:'var(--text-muted)' };
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// UPDATE STATS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function updateStats() {
  animateCount('countP', state.promotores);
  animateCount('countN', state.neutros);
  animateCount('countD', state.detractores);
  animateCount('countTotal', state.promotores + state.neutros + state.detractores);
  updateNPSBar();
}

function animateCount(id, target) {
  const el = document.getElementById(id);
  const current = parseInt(el.textContent) || 0;
  if (current === target) return;
  
  const diff = target - current;
  const step = diff > 0 ? 1 : -1;
  let val = current;
  const interval = setInterval(() => {
    val += step;
    el.textContent = val;
    if (val === target) clearInterval(interval);
  }, 50);
  
  el.style.transform = 'scale(1.2)';
  setTimeout(() => el.style.transform = 'scale(1)', 300);
}

function updateNPSBar() {
  const total = state.promotores + state.neutros + state.detractores;
  const fill = document.getElementById('npsFill');
  const val = document.getElementById('npsValue');
  
  if (total === 0) {
    fill.style.width = '50%';
    fill.style.background = 'var(--text-muted)';
    val.textContent = '--%';
    val.style.color = 'var(--text-muted)';
    return;
  }
  
  const nps = ((state.promotores - state.detractores) / total * 100);
  const npsNorm = (nps + 100) / 200; // -100..+100 â†’ 0..1
  const pct = Math.max(2, Math.min(100, npsNorm * 100));
  
  fill.style.width = pct + '%';
  
  const color = nps >= 36.6 ? 'var(--green)' : nps >= 0 ? 'var(--yellow)' : 'var(--red)';
  fill.style.background = `linear-gradient(90deg, ${color}88, ${color})`;
  val.textContent = nps.toFixed(1) + '%';
  val.style.color = color;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FEED
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function addFeedCard(html) {
  const feed = document.getElementById('feedContainer');
  if (!state.feedStarted) {
    feed.innerHTML = '';
    state.feedStarted = true;
  }
  feed.insertAdjacentHTML('afterbegin', html);
  // Keep max 20
  while (feed.children.length > 20) feed.removeChild(feed.lastChild);
}

function getTime() {
  const h = state.hourCounter;
  const m = Math.floor(Math.random()*60);
  return `${h}:${m.toString().padStart(2,'0')}`;
}

function nextCase() {
  state.caseCounter += Math.floor(Math.random()*50)+1;
  return state.caseCounter;
}

function nextHour() {
  if (Math.random() > 0.6) state.hourCounter = Math.min(18, state.hourCounter + 1);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FLASH
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function flash(color) {
  const el = document.getElementById(color === 'red' ? 'flashRed' : 'flashGreen');
  el.classList.add('show');
  setTimeout(() => el.classList.remove('show'), 200);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CONFETTI
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function launchConfetti() {
  const colors = ['#00e676','#536dfe','#b388ff','#00e5ff','#ffd600','#ff9100','#ea80fc','#69f0ae'];
  for (let i = 0; i < 60; i++) {
    const c = document.createElement('div');
    c.className = 'confetti-piece';
    c.style.cssText = `
      left:${Math.random()*100}%;
      background:${colors[Math.floor(Math.random()*colors.length)]};
      width:${Math.random()*8+5}px;
      height:${Math.random()*8+5}px;
      border-radius:${Math.random()>0.5?'50%':'2px'};
      animation-duration:${Math.random()*2+1.5}s;
      animation-delay:${Math.random()*0.5}s;
    `;
    document.body.appendChild(c);
    setTimeout(() => c.remove(), 4000);
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SIMULATORS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function simPromotor() {
  const rep = REPS[Math.floor(Math.random()*REPS.length)];
  const proc = PROCESOS[Math.floor(Math.random()*PROCESOS.length)];
  const sol = SOLUCIONES[Math.floor(Math.random()*SOLUCIONES.length)];
  const com = COMENTARIOS_P[Math.floor(Math.random()*COMENTARIOS_P.length)];
  const caseId = nextCase();
  const time = getTime();
  
  state.promotores++;
  state.rachas[rep.id].push('P');
  
  // Check for streak achievement
  const streak = calcStreak(state.rachas[rep.id]);
  const prevDot = state.rachas[rep.id].length >= 2 ? state.rachas[rep.id][state.rachas[rep.id].length-2] : null;
  
  flash('green');
  
  addFeedCard(`
    <div class="alert-card promotor">
      <div class="alert-header">
        <span class="alert-icon">ğŸŸ¢</span>
        <span class="alert-type" style="color:var(--green)">Promotor</span>
        <span class="alert-time">${time} Â· Caso ${caseId}</span>
      </div>
      <div class="alert-body">
        <strong>${rep.name}</strong> Â· ${proc}<br>
        <em>"${com}"</em>
      </div>
    </div>
  `);
  
  updateStats();
  renderRachas();
  nextHour();
  
  // Auto-achievement on streak
  if (streak.type === 'P' && streak.count === 5) {
    setTimeout(() => showAchievement('ğŸ’', 'RACHA PERFECTA', `${rep.name} â€” 5 promotores seguidos sin parar`), 600);
  } else if (streak.type === 'P' && prevDot === 'D') {
    setTimeout(() => showAchievement('ğŸ›¡ï¸', 'RECUPERACIÃ“N Ã‰PICA', `${rep.name} â€” Promotor justo despuÃ©s de un detractor`), 600);
  }
}

function simDetractor() {
  const rep = REPS[Math.floor(Math.random()*REPS.length)];
  const procIdx = Math.floor(Math.random()*PROCESOS.length);
  const proc = PROCESOS[procIdx];
  const sol = SOLUCIONES[procIdx];
  const com = COMENTARIOS_D[Math.floor(Math.random()*COMENTARIOS_D.length)];
  const caseId = nextCase();
  const time = getTime();
  
  state.detractores++;
  state.rachas[rep.id].push('D');
  
  // Count rep detractores in this process
  const repDetCount = Math.floor(Math.random()*5)+1;
  const referente = REPS.filter(r=>r.id!==rep.id)[Math.floor(Math.random()*(REPS.length-1))];
  
  // Espejo cases
  const espejo1 = REPS.filter(r=>r.id!==rep.id)[Math.floor(Math.random()*(REPS.length-1))];
  const espejo2 = REPS.filter(r=>r.id!==rep.id&&r.id!==espejo1.id)[Math.floor(Math.random()*(REPS.length-2))];
  
  flash('red');
  
  // Shake effect on stat card
  const redCard = document.querySelectorAll('.stat-card')[2];
  redCard.style.animation = 'none';
  redCard.offsetHeight;
  redCard.style.animation = 'shake 0.5s ease';
  
  addFeedCard(`
    <div class="alert-card detractor">
      <div class="alert-header">
        <span class="alert-icon">ğŸš¨</span>
        <span class="alert-type" style="color:var(--red)">Detractor Detectado</span>
        <span class="alert-time">${time} Â· Caso ${caseId}</span>
      </div>
      <div class="alert-body">
        <strong>${rep.name}</strong> Â· ${proc}<br>
        Sol: ${sol}<br>
        <em>"${com}"</em>
      </div>
      <div class="alert-espejo">
        <div class="alert-espejo-title">ğŸ’¡ Casos espejo â€” Promotor en menor tiempo</div>
        <div class="alert-espejo-item">âœ… Caso ${caseId-Math.floor(Math.random()*5000)-1000} Â· <strong>${espejo1.name}</strong> Â· ${(Math.random()*8+12).toFixed(1)} min â†’ 100%</div>
        <div class="alert-espejo-item">âœ… Caso ${caseId-Math.floor(Math.random()*8000)-2000} Â· <strong>${espejo2.name}</strong> Â· ${(Math.random()*10+14).toFixed(1)} min â†’ 100%</div>
      </div>
      <div class="alert-pattern-box">
        <div class="alert-pattern-title">âš ï¸ Contexto histÃ³rico</div>
        <div style="font-size:11px;color:var(--text-secondary);line-height:1.5">
          <strong>${rep.name}</strong> lleva <strong>${repDetCount} detractores</strong> en <em>${proc.split(' - ')[0]}</em> este mes.<br>
          Referente del equipo en este proceso: <strong>${referente.name}</strong>
        </div>
      </div>
    </div>
  `);
  
  updateStats();
  renderRachas();
  nextHour();
}

function simNeutro() {
  const rep = REPS[Math.floor(Math.random()*REPS.length)];
  const proc = PROCESOS[Math.floor(Math.random()*PROCESOS.length)];
  const com = COMENTARIOS_N[Math.floor(Math.random()*COMENTARIOS_N.length)];
  const caseId = nextCase();
  const time = getTime();
  
  state.neutros++;
  state.rachas[rep.id].push('N');
  
  addFeedCard(`
    <div class="alert-card neutro">
      <div class="alert-header">
        <span class="alert-icon">ğŸŸ¡</span>
        <span class="alert-type" style="color:var(--yellow)">Neutro</span>
        <span class="alert-time">${time} Â· Caso ${caseId}</span>
      </div>
      <div class="alert-body">
        <strong>${rep.name}</strong> Â· ${proc}<br>
        <em>"${com}"</em>
      </div>
    </div>
  `);
  
  updateStats();
  renderRachas();
  nextHour();
}

function simPatron() {
  const proc = PROCESOS[Math.floor(Math.random()*PROCESOS.length)].split(' - ')[0];
  const solBad = SOLUCIONES[Math.floor(Math.random()*SOLUCIONES.length)];
  const solGood = SOLUCIONES[Math.floor(Math.random()*SOLUCIONES.length)];
  const pctDet = Math.floor(Math.random()*30)+60;
  const pctPro = Math.floor(Math.random()*25)+55;
  const avgTime = (Math.random()*8+12).toFixed(1);
  const hora = Math.floor(Math.random()*4)+14;
  
  addFeedCard(`
    <div class="alert-card pattern">
      <div class="alert-header">
        <span class="alert-icon">ğŸ§ </span>
        <span class="alert-type" style="color:var(--indigo)">PatrÃ³n Detectado</span>
        <span class="alert-time">AnÃ¡lisis histÃ³rico</span>
      </div>
      <div class="alert-body">
        <strong>${proc}</strong> + soluciÃ³n tipo <em>"${solBad.substring(0,40)}..."</em><br>
        â†’ <strong style="color:var(--red)">${pctDet}% detractores</strong> este mes en todo el equipo
      </div>
      <div class="alert-pattern-box">
        <div class="alert-pattern-title">ğŸ’¡ Alternativa con mejores resultados</div>
        <div style="font-size:11px;color:var(--text-secondary);line-height:1.6">
          Cuando se usa <em>"${solGood.substring(0,40)}..."</em><br>
          â†’ <strong style="color:var(--green)">${pctPro}% promotor</strong> Â· Tiempo promedio: <strong>${avgTime} min</strong><br>
          ğŸ“Š AdemÃ¡s: despuÃ©s de las <strong>${hora}:00</strong> los detractores suben un 23% (fatiga de turno)
        </div>
      </div>
    </div>
  `);
}

function simLogro() {
  const logro = LOGROS[Math.floor(Math.random()*LOGROS.length)];
  const rep = REPS[Math.floor(Math.random()*REPS.length)];
  showAchievement(logro.emoji, logro.title, `${rep.name} â€” ${logro.desc}`);
}

function showAchievement(emoji, title, desc) {
  document.getElementById('achieveEmoji').textContent = emoji;
  document.getElementById('achieveTitle').textContent = title;
  document.getElementById('achieveDesc').textContent = desc;
  document.getElementById('achievementOverlay').classList.add('show');
  launchConfetti();
  
  addFeedCard(`
    <div class="alert-card achievement">
      <div class="alert-header">
        <span class="alert-icon">${emoji}</span>
        <span class="alert-type" style="color:var(--purple)">Â¡Logro Desbloqueado!</span>
      </div>
      <div class="alert-body">
        <strong>${title}</strong><br>${desc}
      </div>
    </div>
  `);
}

function closeAchievement() {
  document.getElementById('achievementOverlay').classList.remove('show');
}

function simCierreAM() { showCierre('am'); }
function simCierrePM() { showCierre('pm'); }

function showCierre(turno) {
  const isAM = turno === 'am';
  document.getElementById('cierreTurnoLabel').textContent = isAM ? 'CIERRE TURNO MAÃ‘ANA' : 'CIERRE TURNO TARDE';
  document.getElementById('cierreHora').textContent = isAM ? 'ğŸ“Š 12:25 PM' : 'ğŸ“Š 6:30 PM';
  
  // Update week data with current day
  const todayIdx = 2; // MiÃ©rcoles
  const total = state.promotores + state.neutros + state.detractores;
  if (total > 0) {
    WEEK_DATA[todayIdx].enc = total;
    WEEK_DATA[todayIdx].p = state.promotores;
    WEEK_DATA[todayIdx].n = state.neutros;
    WEEK_DATA[todayIdx].d = state.detractores;
  }
  
  const weekEl = document.getElementById('cierreWeek');
  weekEl.innerHTML = WEEK_DATA.map((d, i) => {
    const isToday = i === todayIdx;
    const isFuture = i > todayIdx;
    const nps = d.enc > 0 ? ((d.p - d.d) / d.enc * 100).toFixed(1) + '%' : '--';
    const npsColor = d.enc > 0 ? (((d.p - d.d) / d.enc * 100) >= 36.6 ? 'var(--green)' : ((d.p - d.d) / d.enc * 100) >= 0 ? 'var(--yellow)' : 'var(--red)') : 'var(--text-muted)';
    return `
      <div class="cierre-day ${isToday?'today':''} ${isFuture?'future':''}">
        <div class="cierre-day-name">${d.day}</div>
        <div class="cierre-day-enc">${isFuture?'--':d.enc||'--'}</div>
        <div class="cierre-day-nps" style="color:${isFuture?'var(--text-muted)':npsColor}">${isFuture?'--':nps}</div>
      </div>
    `;
  }).join('');
  
  // Calc week NPS
  const weekTotals = WEEK_DATA.reduce((acc, d) => {
    acc.p += d.p; acc.n += d.n; acc.d += d.d; acc.enc += d.enc;
    return acc;
  }, {p:0,n:0,d:0,enc:0});
  
  const weekNps = weekTotals.enc > 0 ? ((weekTotals.p - weekTotals.d) / weekTotals.enc * 100) : 0;
  const weekNpsEl = document.getElementById('cierreNpsSemana');
  weekNpsEl.textContent = weekTotals.enc > 0 ? weekNps.toFixed(1) + '%' : '--%';
  weekNpsEl.style.color = weekNps >= 36.6 ? 'var(--green)' : weekNps >= 0 ? 'var(--yellow)' : 'var(--red)';
  
  // Message
  const msgEl = document.getElementById('cierreMsg');
  if (isAM) {
    if (weekNps >= 36.6) {
      msgEl.innerHTML = 'Â¡Vamos por encima de la meta! ğŸ’ª Pueden caer mÃ¡s encuestas en la tarde,<br>Â¡pero el equipo de maÃ±ana dejÃ³ la vara alta! ğŸ”¥';
    } else if (weekNps >= 20) {
      msgEl.innerHTML = 'Vamos cerquita de la meta, aÃºn hay camino por recorrer. ğŸ“ˆ<br>Â¡Esperemos que la tarde nos ayude a cerrar aÃºn mejor! ğŸ’ª';
    } else {
      msgEl.innerHTML = 'Semana retadora hasta ahora, pero aÃºn queda camino. ğŸ›¤ï¸<br>Cada encuesta cuenta, Â¡esperemos poder cerrar mejor al final del dÃ­a!';
    }
  } else {
    if (weekNps >= 36.6) {
      msgEl.innerHTML = 'Â¡Gran cierre de dÃ­a! El equipo lo dio todo. ğŸ†<br>MaÃ±ana seguimos construyendo sobre esta base. Â¡A descansar! ğŸŒ™';
    } else if (weekNps >= 20) {
      msgEl.innerHTML = 'AsÃ­ cerramos el panorama de hoy. AÃºn pueden caer encuestas,<br>pero el equipo dio todo. Â¡MaÃ±ana seguimos construyendo! ğŸ”¥';
    } else {
      msgEl.innerHTML = 'DÃ­a retador, pero cada dÃ­a es una oportunidad nueva. ğŸŒ…<br>MaÃ±ana arrancamos con toda. Â¡El equipo tiene con quÃ©! ğŸ’ª';
    }
  }
  
  document.getElementById('cierreOverlay').classList.add('show');
}

function closeCierre() {
  document.getElementById('cierreOverlay').classList.remove('show');
}

function simReset() {
  state.promotores = 0;
  state.neutros = 0;
  state.detractores = 0;
  state.feedStarted = false;
  state.hourCounter = 8;
  REPS.forEach(r => { state.rachas[r.id] = []; });
  WEEK_DATA[2] = { day:'MiÃ©', enc:0, p:0, n:0, d:0 };
  
  document.getElementById('feedContainer').innerHTML = '<div style="text-align:center;padding:40px 0;color:var(--text-muted);font-size:13px;">Oprime un botÃ³n del simulador para empezar...</div>';
  
  updateStats();
  renderRachas();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SHAKE ANIMATION (for detractor)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const shakeCSS = document.createElement('style');
shakeCSS.textContent = `
@keyframes shake {
  0%,100% { transform:translateX(0); }
  10%,30%,50%,70%,90% { transform:translateX(-4px); }
  20%,40%,60%,80% { transform:translateX(4px); }
}`;
document.head.appendChild(shakeCSS);

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
initParticles();
renderRachas();
updateStats();
</script>
</body>
</html>
