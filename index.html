<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NPS Real Time Engine V3</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<style>
:root{
  --bg:#0d1117;--bg2:#161b22;--bg3:#1c2333;--bg4:#21283b;
  --glass:rgba(255,255,255,0.04);--glass2:rgba(255,255,255,0.07);
  --border:rgba(255,255,255,0.06);--border2:rgba(255,255,255,0.12);
  --t1:#e6edf3;--t2:#8b949e;--t3:#484f58;
  --green:#00e676;--greenBg:rgba(0,230,118,0.10);--greenBd:rgba(0,230,118,0.18);
  --yellow:#ffc107;--yellowBg:rgba(255,193,7,0.10);--yellowBd:rgba(255,193,7,0.18);
  --red:#ff5252;--redBg:rgba(255,82,82,0.10);--redBd:rgba(255,82,82,0.18);
  --indigo:#536dfe;--indigoBg:rgba(83,109,254,0.10);
  --purple:#b388ff;--cyan:#00e5ff;
  --meli-yellow:#FFE600;--meli-blue:#2D3277;
}
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:'Inter',sans-serif;background:var(--bg);color:var(--t1);min-height:100vh;overflow-x:hidden;}
::-webkit-scrollbar{width:4px;}
::-webkit-scrollbar-thumb{background:rgba(255,255,255,0.08);border-radius:4px;}

/* â•â•â• PARTICLES â•â•â• */
#particles{position:fixed;inset:0;pointer-events:none;z-index:0;overflow:hidden;}
.ptc{position:absolute;border-radius:50%;opacity:0.1;animation:fp linear infinite;}
@keyframes fp{0%{transform:translateY(100vh) scale(0);opacity:0}10%{opacity:0.1}90%{opacity:0.1}100%{transform:translateY(-10vh) scale(1);opacity:0}}

.app{position:relative;z-index:1;max-width:1460px;margin:0 auto;padding:14px 18px;}

/* â•â•â• HEADER (Looker style) â•â•â• */
.hdr{display:flex;align-items:center;gap:16px;padding:14px 22px;margin-bottom:4px;background:var(--bg2);border:1px solid var(--border);border-radius:16px 16px 0 0;}
.hdr-brand{display:flex;align-items:center;gap:12px;}
.hdr-logo{width:40px;height:40px;border-radius:10px;background:var(--meli-yellow);display:flex;align-items:center;justify-content:center;}
.hdr-logo svg{width:24px;height:24px;}
.hdr-titles{display:flex;flex-direction:column;}
.hdr-t1{font-size:10px;font-weight:700;color:var(--meli-yellow);text-transform:uppercase;letter-spacing:2px;}
.hdr-t2{font-size:16px;font-weight:800;letter-spacing:-0.3px;}
.hdr-filters{display:flex;align-items:center;gap:8px;margin-left:auto;}
.hdr-sel{padding:7px 14px;border-radius:8px;background:var(--bg3);border:1px solid var(--border2);color:var(--t1);font-family:Inter;font-size:12px;font-weight:600;cursor:pointer;min-width:100px;appearance:none;-webkit-appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='6'%3E%3Cpath d='M0 0l5 6 5-6z' fill='%238b949e'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 10px center;padding-right:28px;}

/* â•â•â• FILTER PILLS â•â•â• */
.fpills{display:flex;gap:3px;background:var(--bg3);border:1px solid var(--border);border-radius:8px;padding:3px;}
.fpill{padding:5px 12px;border-radius:6px;border:none;font-family:Inter;font-size:11px;font-weight:600;cursor:pointer;transition:all 0.2s;background:transparent;color:var(--t2);}
.fpill:hover{color:var(--t1);background:rgba(255,255,255,0.04);}
.fpill.on{color:var(--t1);background:var(--glass2);box-shadow:0 1px 4px rgba(0,0,0,0.2);}
.fpill[data-v="P"].on{background:var(--greenBg);color:var(--green);}
.fpill[data-v="N"].on{background:var(--yellowBg);color:var(--yellow);}
.fpill[data-v="D"].on{background:var(--redBg);color:var(--red);}

/* â•â•â• TABS BAR â•â•â• */
.nav-bar{display:flex;align-items:center;justify-content:center;gap:0;padding:0;background:var(--bg2);border-left:1px solid var(--border);border-right:1px solid var(--border);border-bottom:1px solid var(--border);border-radius:0 0 16px 16px;margin-bottom:14px;}
.nav-tab{padding:12px 28px;font-size:12px;font-weight:600;cursor:pointer;color:var(--t2);transition:all 0.25s;border-bottom:2px solid transparent;display:flex;align-items:center;gap:6px;}
.nav-tab:hover{color:var(--t1);}
.nav-tab.on{color:var(--indigo);border-bottom-color:var(--indigo);}
.tab-p{display:none;}
.tab-p.on{display:block;}

/* â•â•â• DISCLAIMER â•â•â• */
.disclaimer{text-align:center;font-size:10px;color:var(--t3);margin-bottom:12px;font-style:italic;}

/* â•â•â• CLOCK + COMPARE ROW â•â•â• */
.info-row{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px;flex-wrap:wrap;gap:8px;}
.clock{font-size:12px;color:var(--t2);display:flex;align-items:center;gap:5px;}
.clock b{color:var(--t1);font-size:14px;}
.info-pill{font-size:11px;color:var(--t2);background:var(--bg2);padding:5px 12px;border-radius:8px;border:1px solid var(--border);}
.info-pill b{color:var(--t1);}

/* â•â•â• TRIO (Looker layout) â•â•â• */
.trio{display:grid;grid-template-columns:260px 1fr 260px;gap:14px;margin-bottom:14px;}
.trio-col{background:var(--bg2);border:1px solid var(--border);border-radius:14px;padding:16px;}
.trio-t{font-size:12px;font-weight:700;text-transform:uppercase;letter-spacing:1px;color:var(--t2);margin-bottom:12px;}

/* Stats inside trio */
.enc-big{text-align:center;margin-bottom:8px;}
.enc-big-label{font-size:10px;color:var(--t3);font-weight:600;text-transform:uppercase;letter-spacing:1px;}
.enc-big-val{font-size:36px;font-weight:900;line-height:1;}
.nps-big{text-align:center;margin-bottom:10px;}
.nps-big-label{font-size:10px;color:var(--t3);font-weight:600;text-transform:uppercase;letter-spacing:1px;}
.nps-big-val{font-size:38px;font-weight:900;line-height:1;}
.pills-row{display:flex;gap:6px;justify-content:center;margin-bottom:12px;}
.pill{padding:5px 14px;border-radius:8px;font-size:16px;font-weight:800;text-align:center;min-width:48px;}
.pill.p{background:var(--greenBg);color:var(--green);border:1px solid var(--greenBd);}
.pill.n{background:var(--yellowBg);color:var(--yellow);border:1px solid var(--yellowBd);}
.pill.d{background:var(--redBg);color:var(--red);border:1px solid var(--redBd);}

/* Top cards */
.tcard{background:var(--bg3);border:1px solid var(--border);border-radius:10px;padding:10px 12px;margin-bottom:8px;}
.tcard-t{font-size:9px;font-weight:700;text-transform:uppercase;letter-spacing:1px;color:var(--t3);margin-bottom:6px;}
.tcard-r{display:flex;align-items:center;justify-content:space-between;font-size:11px;}
.tcard-n{font-weight:600;}
.tcard-e{color:var(--t2);font-size:10px;}
.tcard-nps{font-weight:700;}

/* Live badge (right col) */
.live-hdr{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px;}
.live-badge{display:flex;align-items:center;gap:6px;padding:4px 10px;border-radius:20px;background:rgba(255,82,82,0.1);border:1px solid rgba(255,82,82,0.2);font-size:10px;font-weight:700;color:var(--red);}
.live-dot{width:8px;height:8px;border-radius:50%;background:var(--red);animation:pd 1.5s ease-in-out infinite;}
@keyframes pd{0%,100%{box-shadow:0 0 0 0 rgba(255,82,82,0.5)}50%{box-shadow:0 0 0 6px rgba(255,82,82,0)}}

/* Chart */
.chart-w{position:relative;height:100%;min-height:200px;}
.meta-label{position:absolute;top:6px;right:6px;font-size:9px;color:var(--yellow);font-weight:700;background:var(--yellowBg);padding:2px 7px;border-radius:5px;border:1px solid var(--yellowBd);}

/* â•â•â• THERMO â•â•â• */
.thermo{display:flex;align-items:center;gap:6px;justify-content:center;margin-bottom:12px;padding:7px 14px;border-radius:10px;background:var(--bg2);border:1px solid var(--border);font-size:11px;font-weight:600;color:var(--t2);}
.thermo b{color:var(--t1);}

/* â•â•â• NPS BAR â•â•â• */
.nps-bar{margin-bottom:14px;}
.nps-bar-h{display:flex;justify-content:space-between;align-items:center;margin-bottom:6px;}
.nps-bar-l{font-size:11px;font-weight:600;color:var(--t2);}
.nps-bar-v{font-size:18px;font-weight:800;}
.nps-track{height:10px;background:var(--bg3);border-radius:6px;overflow:hidden;position:relative;border:1px solid var(--border);}
.nps-fill{height:100%;border-radius:6px;transition:width 0.7s cubic-bezier(0.16,1,0.3,1),background 0.4s;}
.nps-fill::after{content:'';position:absolute;inset:0;background:linear-gradient(90deg,transparent,rgba(255,255,255,0.12),transparent);animation:sh 2.5s infinite;}
@keyframes sh{0%{transform:translateX(-100%)}100%{transform:translateX(100%)}}
.nps-meta{position:absolute;top:-4px;bottom:-4px;width:2px;background:var(--yellow);border-radius:2px;z-index:2;}
.nps-meta span{position:absolute;top:-16px;transform:translateX(-50%);font-size:8px;font-weight:700;color:var(--yellow);white-space:nowrap;}

/* â•â•â• ACCORDION (Rachas) â•â•â• */
.accordion{background:var(--bg2);border:1px solid var(--border);border-radius:14px;margin-bottom:14px;overflow:hidden;}
.acc-header{display:flex;align-items:center;justify-content:space-between;padding:14px 18px;cursor:pointer;transition:background 0.2s;user-select:none;}
.acc-header:hover{background:rgba(255,255,255,0.02);}
.acc-title{font-size:12px;font-weight:700;text-transform:uppercase;letter-spacing:1px;color:var(--t2);display:flex;align-items:center;gap:8px;}
.acc-badge{font-size:10px;padding:2px 8px;border-radius:6px;background:var(--indigoBg);color:var(--indigo);font-weight:700;}
.acc-arrow{font-size:14px;color:var(--t3);transition:transform 0.3s;}
.acc-body{max-height:0;overflow:hidden;transition:max-height 0.4s cubic-bezier(0.16,1,0.3,1);}
.acc-body.open{max-height:2000px;}
.acc-inner{padding:0 18px 16px;}

/* Racha rows */
.rrow{display:flex;align-items:center;gap:10px;padding:10px 12px;border-radius:10px;margin-bottom:4px;cursor:pointer;transition:all 0.2s;background:transparent;border:1px solid transparent;}
.rrow:hover{background:rgba(255,255,255,0.03);border-color:var(--border);}
.rrow.selected{background:var(--indigoBg);border-color:rgba(83,109,254,0.2);}
.rav{width:32px;height:32px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:700;flex-shrink:0;}
.rinf{flex:1;min-width:0;}
.rnm{font-size:12px;font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.rst{font-size:10px;color:var(--t3);margin-top:1px;}
.rdots{display:flex;gap:3px;flex-wrap:wrap;margin-top:3px;}
.rd{width:16px;height:16px;border-radius:4px;font-size:8px;display:flex;align-items:center;justify-content:center;font-weight:700;animation:di 0.3s cubic-bezier(0.34,1.56,0.64,1) backwards;}
@keyframes di{from{transform:scale(0);opacity:0}to{transform:scale(1);opacity:1}}
.rd.P{background:var(--greenBg);color:var(--green);border:1px solid var(--greenBd);}
.rd.N{background:var(--yellowBg);color:var(--yellow);border:1px solid var(--yellowBd);}
.rd.D{background:var(--redBg);color:var(--red);border:1px solid var(--redBd);}
.rstrk{font-size:10px;font-weight:700;padding:3px 8px;border-radius:6px;white-space:nowrap;}

/* Rep detail panel */
.rep-detail{background:var(--bg3);border:1px solid var(--border);border-radius:12px;margin:8px 0 14px;padding:14px;animation:si 0.35s cubic-bezier(0.16,1,0.3,1);}
@keyframes si{from{transform:translateY(-8px);opacity:0}to{transform:translateY(0);opacity:1}}
.rep-detail-h{display:flex;align-items:center;gap:10px;margin-bottom:10px;}
.rep-detail-h .rav{width:36px;height:36px;font-size:14px;}
.rep-detail-name{font-size:14px;font-weight:700;}
.rep-detail-stats{display:flex;gap:12px;font-size:11px;color:var(--t2);}
.rep-detail-stats b{color:var(--t1);}
.rep-enc-list{max-height:200px;overflow-y:auto;}
.rep-enc-item{display:flex;align-items:center;gap:8px;padding:6px 8px;border-radius:6px;font-size:10px;color:var(--t2);border-bottom:1px solid rgba(255,255,255,0.03);}
.rep-enc-item:last-child{border-bottom:none;}
.rep-enc-item:hover{background:rgba(255,255,255,0.02);}
.rep-enc-time{color:var(--t3);min-width:40px;}
.rep-enc-proc{flex:1;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.rep-enc-nps{font-weight:700;min-width:32px;text-align:right;}

/* â•â•â• FEED â•â•â• */
.feed-wrap{background:var(--bg2);border:1px solid var(--border);border-radius:14px;margin-bottom:14px;overflow:hidden;}
.feed-hdr{padding:14px 18px;display:flex;align-items:center;justify-content:space-between;}
.feed-title{font-size:12px;font-weight:700;text-transform:uppercase;letter-spacing:1px;color:var(--t2);display:flex;align-items:center;gap:8px;}
.feed-scroll{max-height:340px;overflow-y:auto;padding:0 18px 14px;}
.fc{padding:12px;border-radius:10px;margin-bottom:6px;border:1px solid;animation:fci 0.4s cubic-bezier(0.16,1,0.3,1);}
@keyframes fci{from{transform:translateX(40px);opacity:0}to{transform:translateX(0);opacity:1}}
.fc.pro{background:var(--greenBg);border-color:var(--greenBd);}
.fc.det{background:var(--redBg);border-color:var(--redBd);}
.fc.neu{background:var(--yellowBg);border-color:var(--yellowBd);}
.fc.pat{background:var(--indigoBg);border-color:rgba(83,109,254,0.15);}
.fch{display:flex;align-items:center;gap:5px;margin-bottom:4px;}
.fci{font-size:14px;}
.fct{font-size:9px;font-weight:700;text-transform:uppercase;letter-spacing:0.7px;}
.fctime{font-size:8px;color:var(--t3);margin-left:auto;}
.fcb{font-size:10px;line-height:1.5;color:var(--t2);}
.fcb b{color:var(--t1);font-weight:600;}
.espejo{margin-top:6px;padding:7px 9px;border-radius:7px;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.04);}
.espejo-t{font-size:8px;font-weight:700;color:var(--green);text-transform:uppercase;letter-spacing:0.7px;margin-bottom:3px;}
.espejo-i{font-size:9px;color:var(--t2);margin-bottom:1px;}
.pbox{margin-top:6px;padding:7px 9px;border-radius:7px;background:rgba(83,109,254,0.05);border:1px solid rgba(83,109,254,0.08);}
.pbox-t{font-size:8px;font-weight:700;color:var(--indigo);text-transform:uppercase;letter-spacing:0.7px;margin-bottom:2px;}

/* â•â•â• TABLE â•â•â• */
.tbl-wrap{background:var(--bg2);border:1px solid var(--border);border-radius:14px;margin-bottom:14px;overflow:hidden;}
.tbl-hdr{padding:14px 18px;}
.tbl-title{font-size:12px;font-weight:700;text-transform:uppercase;letter-spacing:1px;color:var(--t2);}
.tbl-scroll{max-height:280px;overflow-y:auto;}
.etbl{width:100%;border-collapse:collapse;font-size:10px;}
.etbl th{text-align:left;padding:7px 10px;font-size:9px;font-weight:700;text-transform:uppercase;letter-spacing:0.7px;color:var(--t3);border-bottom:1px solid var(--border);position:sticky;top:0;background:var(--bg2);z-index:1;}
.etbl td{padding:6px 10px;border-bottom:1px solid rgba(255,255,255,0.02);color:var(--t2);}
.etbl tr:hover td{background:rgba(255,255,255,0.015);}
.npill{padding:2px 7px;border-radius:5px;font-weight:700;font-size:9px;}
.npill.p{background:var(--greenBg);color:var(--green);}
.npill.n{background:var(--yellowBg);color:var(--yellow);}
.npill.d{background:var(--redBg);color:var(--red);}

/* â•â•â• TOAST (non-intrusive achievement) â•â•â• */
.toast-container{position:fixed;top:16px;right:16px;z-index:1100;display:flex;flex-direction:column;gap:8px;pointer-events:none;}
.toast{pointer-events:auto;display:flex;align-items:center;gap:10px;padding:12px 16px;border-radius:12px;backdrop-filter:blur(16px);border:1px solid rgba(179,136,255,0.25);background:linear-gradient(135deg,rgba(179,136,255,0.15),rgba(0,229,255,0.08));box-shadow:0 8px 32px rgba(0,0,0,0.4);animation:toastIn 0.5s cubic-bezier(0.16,1,0.3,1),toastOut 0.4s ease 6.6s forwards;max-width:340px;}
@keyframes toastIn{from{transform:translateX(120%);opacity:0}to{transform:translateX(0);opacity:1}}
@keyframes toastOut{from{opacity:1;transform:translateX(0)}to{opacity:0;transform:translateX(120%)}}
.toast-emoji{font-size:28px;flex-shrink:0;}
.toast-body{flex:1;}
.toast-title{font-size:11px;font-weight:800;background:linear-gradient(135deg,var(--purple),var(--cyan));-webkit-background-clip:text;-webkit-text-fill-color:transparent;}
.toast-desc{font-size:10px;color:var(--t2);margin-top:2px;}
.toast-bar{height:3px;border-radius:2px;background:rgba(179,136,255,0.3);margin-top:6px;overflow:hidden;}
.toast-bar-fill{height:100%;background:var(--purple);border-radius:2px;animation:barShrink 7s linear forwards;}
@keyframes barShrink{from{width:100%}to{width:0%}}

/* â•â•â• EMPTY STATE â•â•â• */
.empty{text-align:center;padding:40px 16px;}
.empty-e{font-size:44px;margin-bottom:10px;animation:bounce 1s ease infinite alternate;}
@keyframes bounce{from{transform:translateY(0)}to{transform:translateY(-8px)}}
.empty-t{font-size:16px;font-weight:700;margin-bottom:4px;}
.empty-s{font-size:12px;color:var(--t2);line-height:1.5;}

/* â•â•â• SIM SECTION â•â•â• */
.sim-sec{background:var(--bg2);border:1px solid var(--border);border-radius:14px;padding:18px;margin-bottom:14px;}
.sgrid{display:grid;grid-template-columns:repeat(4,1fr);gap:8px;}
.sbtn{padding:12px 8px;border-radius:10px;border:1px solid;font-family:Inter;font-size:11px;font-weight:600;cursor:pointer;transition:all 0.25s;display:flex;flex-direction:column;align-items:center;gap:4px;text-align:center;}
.sbtn:hover{transform:translateY(-2px);}
.sbtn:active{transform:scale(0.96);}
.sbtn.gb{background:var(--greenBg);border-color:var(--greenBd);color:var(--green);}
.sbtn.rb{background:var(--redBg);border-color:var(--redBd);color:var(--red);}
.sbtn.yb{background:var(--yellowBg);border-color:var(--yellowBd);color:var(--yellow);}
.sbtn.ib{background:var(--indigoBg);border-color:rgba(83,109,254,0.15);color:var(--indigo);}
.sbtn.pb{background:rgba(179,136,255,0.08);border-color:rgba(179,136,255,0.15);color:var(--purple);}
.sbtn-i{font-size:20px;}

/* â•â•â• FLASH â•â•â• */
.flash{position:fixed;inset:0;pointer-events:none;z-index:999;opacity:0;transition:opacity 0.1s;}
.flash.r{background:rgba(255,82,82,0.1);}
.flash.g{background:rgba(0,230,118,0.06);}
.flash.show{opacity:1;}

/* â•â•â• CONFETTI â•â•â• */
.confetti{position:fixed;z-index:1101;animation:cf linear forwards;pointer-events:none;}
@keyframes cf{0%{transform:translateY(-10vh) rotate(0);opacity:1}100%{transform:translateY(110vh) rotate(720deg);opacity:0}}

/* â•â•â• FOOTER â•â•â• */
.ftr{text-align:center;padding:16px;font-size:9px;color:var(--t3);}

/* â•â•â• RESPONSIVE â•â•â• */
@media(max-width:1100px){.trio{grid-template-columns:1fr;}}
@media(max-width:700px){
  .sgrid{grid-template-columns:repeat(2,1fr);}
  .hdr{flex-wrap:wrap;}.hdr-filters{width:100%;justify-content:center;}
  .pills-row{flex-wrap:wrap;}.info-row{flex-direction:column;align-items:flex-start;}
}
@keyframes shake{0%,100%{transform:translateX(0)}10%,50%,90%{transform:translateX(-3px)}30%,70%{transform:translateX(3px)}}
</style>
</head>
<body>
<div id="particles"></div>
<div class="flash r" id="flR"></div>
<div class="flash g" id="flG"></div>

<!-- TOASTS (non-intrusive achievements) -->
<div class="toast-container" id="toasts"></div>

<!-- CIERRE MODAL -->
<div id="ciOv" style="position:fixed;inset:0;z-index:1000;background:rgba(0,0,0,0.7);backdrop-filter:blur(8px);display:none;align-items:center;justify-content:center;">
  <div style="width:90%;max-width:560px;padding:30px;border-radius:20px;background:var(--bg2);border:1px solid var(--border);animation:si 0.5s cubic-bezier(0.16,1,0.3,1);">
    <div style="text-align:center;margin-bottom:18px;">
      <div id="ciTL" style="font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:2px;color:var(--indigo);margin-bottom:4px;"></div>
      <div id="ciHR" style="font-size:24px;font-weight:800;"></div>
    </div>
    <div id="ciWK" style="display:grid;grid-template-columns:repeat(5,1fr);gap:8px;margin-bottom:18px;"></div>
    <div style="text-align:center;padding:14px;border-radius:12px;background:var(--bg3);border:1px solid var(--border);margin-bottom:14px;">
      <div id="ciSN" style="font-size:28px;font-weight:800;">--</div>
      <div style="font-size:10px;color:var(--t2);margin-top:3px;">NPS Semana Â· Meta: 36.6%</div>
    </div>
    <div id="ciMG" style="text-align:center;font-size:12px;color:var(--t2);line-height:1.7;font-style:italic;"></div>
    <button onclick="document.getElementById('ciOv').style.display='none'" style="display:block;margin:16px auto 0;padding:8px 24px;border-radius:10px;border:1px solid var(--border);background:var(--bg3);color:var(--t1);font-weight:600;cursor:pointer;font-size:12px;">Cerrar</button>
  </div>
</div>

<!-- â•â•â• APP â•â•â• -->
<div class="app">

  <!-- HEADER -->
  <div class="hdr">
    <div class="hdr-brand">
      <div class="hdr-logo">
        <svg viewBox="0 0 24 24" fill="none"><circle cx="12" cy="12" r="10" fill="#2D3277"/><text x="12" y="16" text-anchor="middle" fill="#FFE600" font-size="12" font-weight="900" font-family="Inter">M</text></svg>
      </div>
      <div class="hdr-titles">
        <div class="hdr-t1">mercado libre</div>
        <div class="hdr-t2">MATURE PUBLICACIONES</div>
      </div>
    </div>
    <div class="hdr-filters">
      <div class="fpills" id="fpills">
        <button class="fpill on" data-v="all" onclick="setFType(this,'all')">NPS</button>
        <button class="fpill" data-v="P" onclick="setFType(this,'P')">ğŸŸ¢ Promotor</button>
        <button class="fpill" data-v="N" onclick="setFType(this,'N')">ğŸŸ¡ Neutro</button>
        <button class="fpill" data-v="D" onclick="setFType(this,'D')">ğŸ”´ Detractor</button>
      </div>
      <select class="hdr-sel" id="fLider" onchange="setFLider(this.value)">
        <option value="all">LÃ­der Â·</option>
      </select>
      <select class="hdr-sel" id="fRep" onchange="setFRep(this.value)">
        <option value="all">Rep Â·</option>
      </select>
    </div>
  </div>

  <!-- NAV TABS -->
  <div class="nav-bar">
    <div class="nav-tab on" onclick="switchTab('rt')" id="tabRT">ğŸ“¡ REAL TIME</div>
    <div class="nav-tab" onclick="switchTab('sim')" id="tabSIM">ğŸ® SIMULADOR</div>
  </div>

  <div class="disclaimer">Los datos compartidos son ficticios para demostraciÃ³n. Las fuentes oficiales son las informadas en los bonos.</div>

  <!-- â•â•â•â•â•â•â•â•â•â•â• TAB: REAL TIME â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="tab-p on" id="panelRT">

    <div class="info-row">
      <div class="clock">â° <b id="clockD">--:--</b></div>
      <div class="info-pill" id="ayerVsHoy">Ayer a esta hora: <b>8 enc Â· 37.5%</b> â†’ Hoy: <b>0 enc</b></div>
      <div class="info-pill" id="nextCi">PrÃ³ximo cierre: 12:25 PM</div>
    </div>

    <!-- TRIO -->
    <div class="trio">
      <!-- LEFT: Ayer -->
      <div class="trio-col">
        <div class="trio-t">RESULTADOS AYER</div>
        <div class="enc-big"><div class="enc-big-label">Encuestas</div><div class="enc-big-val">25</div></div>
        <div class="nps-big"><div class="nps-big-label">Lineal Ayer</div><div class="nps-big-val" style="color:var(--green)">44.0 %</div></div>
        <div class="pills-row"><div class="pill p">16</div><div class="pill n">4</div><div class="pill d">5</div></div>
        <div class="tcard"><div class="tcard-t">TOP REPRESENTANTE AYER</div><div class="tcard-r"><span>REPRESENTANTE</span><span>ENCUESTAS ğŸ“Š</span><span>NPS ğŸ“ˆ</span></div><div class="tcard-r" style="margin-top:4px;"><span class="tcard-n">Valentina RÃ­os</span><span class="tcard-e">4</span><span class="tcard-nps" style="color:var(--green)">100 %</span></div></div>
        <div class="tcard"><div class="tcard-t">TOP EQUIPO AYER</div><div class="tcard-r"><span>LÃDER</span><span>ENCUESTAS ğŸ“Š</span><span>NPS ğŸ“ˆ</span></div><div class="tcard-r" style="margin-top:4px;"><span class="tcard-n">Lnocua</span><span class="tcard-e">1</span><span class="tcard-nps" style="color:var(--green)">100 %</span></div></div>
      </div>

      <!-- CENTER: Chart -->
      <div class="trio-col">
        <div class="trio-t">DESARROLLO DEL DÃA POR HORAS</div>
        <div class="chart-w"><canvas id="chartH"></canvas><div class="meta-label">META 36.6%</div></div>
      </div>

      <!-- RIGHT: NPS Hoy -->
      <div class="trio-col">
        <div class="live-hdr">
          <div class="trio-t" style="margin-bottom:0;">NPS REAL TIME</div>
          <div class="live-badge"><div class="live-dot"></div>LIVE</div>
        </div>
        <div class="enc-big"><div class="enc-big-label">Encuestas</div><div class="enc-big-val" id="hoyEnc">0</div></div>
        <div class="nps-big"><div class="nps-big-label">Lineal Hoy</div><div class="nps-big-val" id="hoyNps" style="color:var(--t3)">--%</div></div>
        <div class="pills-row"><div class="pill p" id="hoyP">0</div><div class="pill n" id="hoyN">0</div><div class="pill d" id="hoyD">0</div></div>
        <div class="tcard"><div class="tcard-t">TOP REPRESENTANTE HOY</div><div id="topRepHoy"><div class="tcard-r"><span style="color:var(--t3);font-size:10px">Esperando encuestas...</span></div></div></div>
        <div class="tcard"><div class="tcard-t">TOP EQUIPO HOY</div><div id="topEqHoy"><div class="tcard-r"><span style="color:var(--t3);font-size:10px">Esperando encuestas...</span></div></div></div>
      </div>
    </div>

    <!-- Thermo -->
    <div class="thermo" id="thermo">ğŸ§Š TermÃ³metro del equipo: <b>Sin actividad â€” Â¿QuiÃ©n serÃ¡ el primer promotor del dÃ­a? ğŸš€</b></div>

    <!-- NPS Bar -->
    <div class="nps-bar">
      <div class="nps-bar-h"><span class="nps-bar-l">NPS HOY</span><span class="nps-bar-v" id="barV" style="color:var(--t3)">--%</span></div>
      <div class="nps-track" style="position:relative"><div class="nps-fill" id="barF" style="width:50%;background:var(--t3)"></div><div class="nps-meta" style="left:68.3%"><span>Meta 36.6%</span></div></div>
    </div>

    <!-- Rachas Accordion -->
    <div class="accordion">
      <div class="acc-header" onclick="toggleAcc(this)">
        <div class="acc-title">ğŸ”¥ Rachas en Vivo <span class="acc-badge" id="rachaCount">0</span></div>
        <div class="acc-arrow">â–¼</div>
      </div>
      <div class="acc-body" id="accBody">
        <div class="acc-inner" id="rachasBox">
          <div class="empty"><div class="empty-e">ğŸš€</div><div class="empty-t">Â¿QuÃ© esperas?</div><div class="empty-s">SÃ© el primer promotor del dÃ­a</div></div>
        </div>
      </div>
    </div>

    <!-- Feed -->
    <div class="feed-wrap">
      <div class="feed-hdr"><div class="feed-title">ğŸ“¡ Feed en Tiempo Real</div></div>
      <div class="feed-scroll" id="feedBox">
        <div class="empty" style="padding:24px 10px;"><div class="empty-e" style="font-size:32px;">ğŸ“¡</div><div class="empty-t" style="font-size:14px;">Escuchando...</div><div class="empty-s" style="font-size:11px;">Alertas aparecerÃ¡n aquÃ­</div></div>
      </div>
    </div>

    <!-- Table -->
    <div class="tbl-wrap">
      <div class="tbl-hdr"><div class="tbl-title">ğŸ“‹ Encuestas del DÃ­a</div></div>
      <div class="tbl-scroll">
        <table class="etbl"><thead><tr><th>Fecha</th><th>Caso</th><th>LÃ­der</th><th>Representante</th><th>SoluciÃ³n</th><th>Comentario</th><th>NPS</th></tr></thead>
        <tbody id="tblBody"><tr><td colspan="7" style="text-align:center;padding:20px;color:var(--t3)">Sin encuestas aÃºn</td></tr></tbody></table>
      </div>
    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â• TAB: SIMULADOR â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="tab-p" id="panelSIM">
    <div class="sim-sec">
      <div style="font-size:12px;font-weight:700;text-transform:uppercase;letter-spacing:1px;color:var(--t2);margin-bottom:6px;display:flex;align-items:center;gap:6px;">ğŸ® Panel de SimulaciÃ³n</div>
      <p style="font-size:11px;color:var(--t2);margin-bottom:12px;line-height:1.5;">Los eventos se reflejan en <b>Real Time</b>. Â¡PruÃ©balos!</p>
      <div class="sgrid">
        <button class="sbtn gb" onclick="simP()"><span class="sbtn-i">ğŸŸ¢</span>Llega Promotor</button>
        <button class="sbtn rb" onclick="simD()"><span class="sbtn-i">ğŸ”´</span>Llega Detractor</button>
        <button class="sbtn yb" onclick="simN()"><span class="sbtn-i">ğŸŸ¡</span>Llega Neutro</button>
        <button class="sbtn ib" onclick="simCierre('am')"><span class="sbtn-i">ğŸŒ…</span>Cierre AM 12:25</button>
        <button class="sbtn ib" onclick="simCierre('pm')"><span class="sbtn-i">ğŸŒ‡</span>Cierre PM 6:30</button>
        <button class="sbtn pb" onclick="simLogro()"><span class="sbtn-i">ğŸ†</span>Logro</button>
        <button class="sbtn pb" onclick="simPatron()"><span class="sbtn-i">ğŸ§ </span>Alerta PatrÃ³n</button>
        <button class="sbtn" style="background:var(--glass);border-color:var(--border);color:var(--t2);" onclick="simAuto()"><span class="sbtn-i">âš¡</span>Auto-Play</button>
      </div>
    </div>
  </div>

  <div class="ftr">hecho por juan sebastian guerrero rodriguez, hecho con el ğŸ’›<br><span style="opacity:0.5">NPS Real Time Engine V3 Â· 2026</span></div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<!-- SCRIPT (PARTE 2) EN SIGUIENTE MENSAJE       -->
<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

  <script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DATA FICTICIA
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const LID=[
  {id:'lnocua',n:'Lnocua'},{id:'nimoreno',n:'Nimoreno'},{id:'marmendez',n:'Marmendez'},
  {id:'jpuyo',n:'Jpuyo'},{id:'lflorez',n:'Lflorez'}
];
const REPS=[
  {id:'pepitoperez',n:'Pepito PÃ©rez',av:'PP',c:'#536dfe',l:'marmendez'},
  {id:'mariagarcia',n:'MarÃ­a GarcÃ­a',av:'MG',c:'#00e676',l:'marmendez'},
  {id:'carlosruiz',n:'Carlos Ruiz',av:'CR',c:'#ff5252',l:'nimoreno'},
  {id:'anamoreno',n:'Ana Moreno',av:'AM',c:'#b388ff',l:'lnocua'},
  {id:'luisdiaz',n:'Luis DÃ­az',av:'LD',c:'#ffd600',l:'jpuyo'},
  {id:'sofialopez',n:'SofÃ­a LÃ³pez',av:'SL',c:'#00e5ff',l:'nimoreno'},
  {id:'diegotorres',n:'Diego Torres',av:'DT',c:'#ff9100',l:'lflorez'},
  {id:'valeriacast',n:'Valeria Castro',av:'VC',c:'#69f0ae',l:'jpuyo'},
  {id:'andresrios',n:'AndrÃ©s RÃ­os',av:'AR',c:'#ea80fc',l:'lflorez'},
  {id:'camilasan',n:'Camila SÃ¡nchez',av:'CS',c:'#ff80ab',l:'marmendez'},
  {id:'julianmart',n:'JuliÃ¡n MartÃ­nez',av:'JM',c:'#80d8ff',l:'lnocua'},
  {id:'laurabece',n:'Laura Becerra',av:'LB',c:'#ccff90',l:'jpuyo'}
];
const PROC=[
  'ReputaciÃ³n ME - Reclamo afecta la reputaciÃ³n','PR - Propiedad Intelectual - Denuncia',
  'GestiÃ³n de PublicaciÃ³n - Modificar variantes','Potenciador - Eventos comerciales T1, T2 y T3',
  'Calidad de Fotos - Mejorar fotos del producto','ReputaciÃ³n ME Ventas: LogÃ­stica Places - Excluimos',
  'Antes de Publicar - CorrecciÃ³n de catÃ¡logo','PR TÃ©cnica - Datos tÃ©cnicos del producto',
  'PR Art Prohib - ArtÃ­culos prohibidos','GestiÃ³n Pub - ModeraciÃ³n de publicaciÃ³n'
];
const SOL=[
  'Analizamos reputaciÃ³n y mantenemos impacto','Denuncia recibida - Procedemos anÃ¡lisis',
  'Modificar variantes, fotos y precio','Beneficios del potenciador explicados',
  'CatÃ¡logo - Sugerencia de correcciÃ³n','LogÃ­stica Places - Excluimos',
  'Fotos actualizadas correctamente','Datos tÃ©cnicos corregidos',
  'ArtÃ­culo restringido - Alternativas','PublicaciÃ³n moderada exitosamente'
];
const CP=['Pudieron solucionar mi problema, excelente','Muy buena ayuda, resolvieron rÃ¡pido','La asesora fue muy amable y clara','Fue buena, me explicaron todo','Excelente servicio, en pocos minutos resuelto','Me ayudaron perfecto con mi publicaciÃ³n','SÃºper rÃ¡pido y efectivo, gracias'];
const CD=['No me solucionaron el problema','No utilizan el criterio ni el sentido comÃºn','Tienen un speech prearmado y no se salen del texto','No terminÃ³ de ayudarme, me cortÃ³ la conversaciÃ³n','El vendedor siempre pierde dinero y tiempo','Tardaron demasiado y no resolvieron','Me pasaron de asesor en asesor sin soluciÃ³n'];
const CN=['Fue normal, ni bien ni mal','Resolvieron pero tardaron bastante','MÃ¡s o menos, esperaba algo mejor','AtenciÃ³n regular, el proceso es largo','No fue mala pero tampoco excelente'];
const LOGROS=[
  {e:'ğŸ’',t:'RACHA PERFECTA',d:'5 promotores seguidos sin parar'},
  {e:'ğŸ”¥',t:'EN LLAMAS',d:'3 promotores consecutivos'},
  {e:'ğŸ›¡ï¸',t:'RECUPERACIÃ“N Ã‰PICA',d:'Promotor despuÃ©s de detractor'},
  {e:'â­',t:'ESTRELLA DEL DÃA',d:'Mayor NPS con 5+ encuestas'},
  {e:'ğŸš€',t:'PRIMER PROMOTOR',d:'Â¡ArrancÃ³ el dÃ­a con todo!'},
  {e:'ğŸ‘‘',t:'INVICTO',d:'0 detractores en todo el dÃ­a'}
];
const WK=[{d:'Lun',e:14,p:8,n:2,dd:4},{d:'Mar',e:18,p:11,n:3,dd:4},{d:'MiÃ©',e:0,p:0,n:0,dd:0},{d:'Jue',e:0,p:0,n:0,dd:0},{d:'Vie',e:0,p:0,n:0,dd:0}];
const TI=2;

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let S={p:0,n:0,d:0,rachas:{},enc:[],feedOn:false,cN:436200000,hN:8,mN:5,selRep:null,fType:'all',fLid:'all',fRep:'all'};
REPS.forEach(r=>S.rachas[r.id]=[]);

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
(function(){
  // Particles
  const pc=document.getElementById('particles');
  const cols=['var(--green)','var(--indigo)','var(--purple)','var(--cyan)','var(--yellow)'];
  for(let i=0;i<20;i++){const p=document.createElement('div');p.className='ptc';const s=Math.random()*3+1.5;p.style.cssText=`width:${s}px;height:${s}px;left:${Math.random()*100}%;background:${cols[i%5]};animation-duration:${Math.random()*12+10}s;animation-delay:${Math.random()*8}s;`;pc.appendChild(p);}
  // Populate selects
  const ls=document.getElementById('fLider');
  LID.forEach(l=>{const o=document.createElement('option');o.value=l.id;o.textContent=l.n;ls.appendChild(o);});
  populateRepSel('all');
  // Clock
  updClock();setInterval(updClock,1000);
  // Chart
  initChart();
  // Pre-populate
  prePop();
  apply();
})();

function populateRepSel(lid){
  const s=document.getElementById('fRep');
  const reps=lid==='all'?REPS:REPS.filter(r=>r.l===lid);
  s.innerHTML='<option value="all">Rep Â·</option>'+reps.map(r=>`<option value="${r.id}">${r.n}</option>`).join('');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TABS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function switchTab(t){
  document.querySelectorAll('.nav-tab').forEach(e=>e.classList.remove('on'));
  document.querySelectorAll('.tab-p').forEach(e=>e.classList.remove('on'));
  document.getElementById(t==='rt'?'tabRT':'tabSIM').classList.add('on');
  document.getElementById(t==='rt'?'panelRT':'panelSIM').classList.add('on');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CLOCK
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function updClock(){
  const now=new Date();
  document.getElementById('clockD').textContent=now.toLocaleTimeString('es-CO',{hour:'2-digit',minute:'2-digit',second:'2-digit'});
  const h=now.getHours(),m=now.getMinutes();
  let nx='';
  if(h<12||(h===12&&m<25))nx=`PrÃ³ximo cierre: 12:25 PM`;
  else if(h<18||(h===18&&m<30))nx=`PrÃ³ximo cierre: 6:30 PM`;
  else nx='Cierres completados âœ…';
  document.getElementById('nextCi').textContent=nx;
  if(h===0&&m===0&&now.getSeconds()<2)autoReset();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FILTERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function setFType(btn,v){S.fType=v;document.querySelectorAll('.fpill').forEach(b=>b.classList.remove('on'));btn.classList.add('on');apply();}
function setFLider(v){S.fLid=v;S.fRep='all';populateRepSel(v);apply();}
function setFRep(v){S.fRep=v;apply();}
function gf(){return S.enc.filter(e=>{if(S.fType!=='all'&&e.t!==S.fType)return false;if(S.fLid!=='all'&&e.lid!==S.fLid)return false;if(S.fRep!=='all'&&e.rid!==S.fRep)return false;return true;});}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ACCORDION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function toggleAcc(el){
  const body=el.nextElementSibling;
  const arrow=el.querySelector('.acc-arrow');
  body.classList.toggle('open');
  arrow.style.transform=body.classList.contains('open')?'rotate(180deg)':'rotate(0)';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MAIN APPLY (re-renders everything)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function apply(){
  const f=gf();
  const pC=f.filter(e=>e.t==='P').length;
  const nC=f.filter(e=>e.t==='N').length;
  const dC=f.filter(e=>e.t==='D').length;
  const tot=f.length;
  const nps=tot>0?((pC-dC)/tot*100):null;

  // Hoy col
  document.getElementById('hoyEnc').textContent=tot;
  document.getElementById('hoyP').textContent=pC;
  document.getElementById('hoyN').textContent=nC;
  document.getElementById('hoyD').textContent=dC;

  const nE=document.getElementById('hoyNps');
  const bV=document.getElementById('barV');
  const bF=document.getElementById('barF');
  if(nps===null){
    nE.textContent='--%';nE.style.color='var(--t3)';
    bV.textContent='--%';bV.style.color='var(--t3)';
    bF.style.width='50%';bF.style.background='var(--t3)';
  } else {
    const c=nps>=36.6?'var(--green)':nps>=0?'var(--yellow)':'var(--red)';
    const pct=Math.max(2,Math.min(100,(nps+100)/200*100));
    nE.textContent=nps.toFixed(1)+' %';nE.style.color=c;
    bV.textContent=nps.toFixed(1)+'%';bV.style.color=c;
    bF.style.width=pct+'%';bF.style.background=`linear-gradient(90deg,${c}88,${c})`;
  }

  // Ayer vs hoy
  document.getElementById('ayerVsHoy').innerHTML=`Ayer a esta hora: <b>8 enc Â· 37.5%</b> â†’ Hoy: <b>${tot} enc Â· ${nps!==null?nps.toFixed(1)+'%':'--%'}</b>`;

  // Thermo
  updThermo(tot,nps);
  // Top
  updTopRep(f);
  updTopEq(f);
  // Table
  rendTable(f);
  // Chart
  updChart();
  // Rachas
  rendRachas();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// THERMO
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function updThermo(tot,nps){
  const el=document.getElementById('thermo');
  if(!tot){el.innerHTML='ğŸ§Š TermÃ³metro del equipo: <b>Sin actividad â€” Â¿QuiÃ©n serÃ¡ el primer promotor del dÃ­a? ğŸš€</b>';return;}
  let i,t;
  if(nps>=60){i='ğŸ”¥ğŸ”¥ğŸ”¥';t='Â¡EQUIPO EN LLAMAS! Rendimiento excepcional';}
  else if(nps>=36.6){i='ğŸ”¥ğŸ”¥';t='Â¡Sobre la meta! Equipo encendido';}
  else if(nps>=20){i='ğŸ”¥';t='Buen ritmo, cerquita de la meta';}
  else if(nps>=0){i='ğŸŒ¡ï¸';t='Tibio, hay que empujar un poco mÃ¡s';}
  else if(nps>=-30){i='ğŸ¥¶';t='FrÃ­o â€” necesitamos mÃ¡s promotores';}
  else{i='â„ï¸';t='Muy frÃ­o â€” momento de reagrupar';}
  el.innerHTML=`${i} TermÃ³metro del equipo: <b>${t}</b>`;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TOP REP / EQUIPO
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function updTopRep(f){
  const by={};
  f.forEach(e=>{if(!by[e.rid])by[e.rid]={p:0,n:0,d:0,t:0,nm:e.rn};by[e.rid][e.t.toLowerCase()]++;by[e.rid].t++;});
  let best=null,bn=-999;
  Object.values(by).forEach(v=>{const np=(v.p-v.d)/v.t*100;if(np>bn||(np===bn&&v.t>(best?best.t:0))){bn=np;best=v;}});
  const el=document.getElementById('topRepHoy');
  if(!best){el.innerHTML='<div class="tcard-r"><span style="color:var(--t3);font-size:10px">Esperando encuestas...</span></div>';return;}
  const c=bn>=36.6?'var(--green)':bn>=0?'var(--yellow)':'var(--red)';
  el.innerHTML=`<div class="tcard-r"><span>REPRESENTANTE</span><span>ENCUESTAS ğŸ“Š</span><span>NPS ğŸ“ˆ</span></div><div class="tcard-r" style="margin-top:4px"><span class="tcard-n">${best.nm}</span><span class="tcard-e">${best.t}</span><span class="tcard-nps" style="color:${c}">${bn.toFixed(0)} %</span></div>`;
}
function updTopEq(f){
  const by={};
  f.forEach(e=>{const k=e.lid;if(!by[k])by[k]={p:0,n:0,d:0,t:0,nm:LID.find(l=>l.id===k)?.n||k};by[k][e.t.toLowerCase()]++;by[k].t++;});
  let best=null,bn=-999;
  Object.values(by).forEach(v=>{const np=(v.p-v.d)/v.t*100;if(np>bn||(np===bn&&v.t>(best?best.t:0))){bn=np;best=v;}});
  const el=document.getElementById('topEqHoy');
  if(!best){el.innerHTML='<div class="tcard-r"><span style="color:var(--t3);font-size:10px">Esperando encuestas...</span></div>';return;}
  const c=bn>=36.6?'var(--green)':bn>=0?'var(--yellow)':'var(--red)';
  el.innerHTML=`<div class="tcard-r"><span>LÃDER</span><span>ENCUESTAS ğŸ“Š</span><span>NPS ğŸ“ˆ</span></div><div class="tcard-r" style="margin-top:4px"><span class="tcard-n">${best.nm}</span><span class="tcard-e">${best.t}</span><span class="tcard-nps" style="color:${c}">${bn.toFixed(0)} %</span></div>`;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CHART
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let chart=null;
function initChart(){
  const ctx=document.getElementById('chartH').getContext('2d');
  chart=new Chart(ctx,{
    type:'bar',
    data:{
      labels:['8h','9h','10h','11h','12h','13h','14h','15h','16h','17h','18h'],
      datasets:[
        {type:'bar',label:'Encuestas',data:Array(11).fill(0),backgroundColor:'rgba(83,109,254,0.25)',borderColor:'rgba(83,109,254,0.6)',borderWidth:1,borderRadius:3,yAxisID:'y1',order:2},
        {type:'line',label:'NPS',data:Array(11).fill(null),borderColor:'var(--green)',backgroundColor:'rgba(0,230,118,0.08)',borderWidth:2,pointRadius:3,pointBackgroundColor:'var(--green)',fill:true,tension:0.3,yAxisID:'y',order:1,spanGaps:true}
      ]
    },
    options:{
      responsive:true,maintainAspectRatio:false,
      interaction:{mode:'index',intersect:false},
      plugins:{legend:{display:true,position:'top',labels:{color:'#8b949e',font:{size:9,family:'Inter'},boxWidth:10,padding:6}}},
      scales:{
        x:{ticks:{color:'#484f58',font:{size:9}},grid:{color:'rgba(255,255,255,0.02)'}},
        y:{position:'left',min:-100,max:100,ticks:{color:'#484f58',font:{size:9},callback:v=>v+'%'},grid:{color:'rgba(255,255,255,0.03)'}},
        y1:{position:'right',min:0,ticks:{color:'#484f58',font:{size:9}},grid:{display:false}}
      }
    }
  });
}
function updChart(){
  if(!chart)return;
  const f=gf();
  const hrs={};
  f.forEach(e=>{const h=e.hr;if(!hrs[h])hrs[h]={p:0,n:0,d:0,t:0};hrs[h][e.t.toLowerCase()]++;hrs[h].t++;});
  const eD=[],nD=[];
  for(let h=8;h<=18;h++){
    if(hrs[h]&&hrs[h].t>0){eD.push(hrs[h].t);nD.push((hrs[h].p-hrs[h].d)/hrs[h].t*100);}
    else{eD.push(0);nD.push(null);}
  }
  chart.data.datasets[0].data=eD;
  chart.data.datasets[1].data=nD;
  chart.update('none');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RACHAS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function rendRachas(){
  const box=document.getElementById('rachasBox');
  let reps=[...REPS];
  if(S.fLid!=='all')reps=reps.filter(r=>r.l===S.fLid);
  if(S.fRep!=='all')reps=reps.filter(r=>r.id===S.fRep);
  const active=reps.filter(r=>(S.rachas[r.id]||[]).length>0).sort((a,b)=>(S.rachas[b.id]||[]).length-(S.rachas[a.id]||[]).length);

  document.getElementById('rachaCount').textContent=active.length;

  if(!active.length){
    box.innerHTML='<div class="empty"><div class="empty-e">ğŸš€</div><div class="empty-t">Â¿QuÃ© esperas?</div><div class="empty-s">SÃ© el primer promotor del dÃ­a</div></div>';
    return;
  }

  let html='';
  active.forEach(rep=>{
    const dots=S.rachas[rep.id]||[];
    const sk=calcSk(dots);
    const si=skInfo(sk);
    const pC=dots.filter(x=>x==='P').length,nC=dots.filter(x=>x==='N').length,dC=dots.filter(x=>x==='D').length;
    const sel=S.selRep===rep.id;

    html+=`<div class="rrow ${sel?'selected':''}" onclick="toggleRepDetail('${rep.id}')">
      <div class="rav" style="background:${rep.c}18;color:${rep.c};border:1px solid ${rep.c}28">${rep.av}</div>
      <div class="rinf">
        <div class="rnm">${rep.n} <span style="font-size:9px;color:var(--t3);font-weight:400">${LID.find(l=>l.id===rep.l)?.n||''}</span></div>
        <div class="rst">${dots.length} enc Â· ${pC}P ${nC}N ${dC}D</div>
        <div class="rdots">${dots.map((dd,i)=>{
          const dim=S.fType!=='all'&&dd!==S.fType?'opacity:0.2;':'';
          return `<div class="rd ${dd}" style="animation-delay:${i*0.03}s;${dim}">${dd}</div>`;
        }).join('')}</div>
      </div>
      <div class="rstrk" style="background:${si.bg};color:${si.c}">${si.i} ${sk.count}</div>
    </div>`;

    // Detail panel if selected
    if(sel){
      const repEncs=S.enc.filter(e=>e.rid===rep.id);
      if(S.fType!=='all') repEncs.filter(e=>e.t===S.fType);
      const filtered=S.fType==='all'?repEncs:repEncs.filter(e=>e.t===S.fType);
      const rP=repEncs.filter(e=>e.t==='P').length,rN=repEncs.filter(e=>e.t==='N').length,rD=repEncs.filter(e=>e.t==='D').length;
      const rNps=repEncs.length>0?((rP-rD)/repEncs.length*100):0;
      const rC=rNps>=36.6?'var(--green)':rNps>=0?'var(--yellow)':'var(--red)';

      html+=`<div class="rep-detail">
        <div class="rep-detail-h">
          <div class="rav" style="background:${rep.c}18;color:${rep.c};border:1px solid ${rep.c}28">${rep.av}</div>
          <div>
            <div class="rep-detail-name">${rep.n}</div>
            <div class="rep-detail-stats">
              <span>NPS: <b style="color:${rC}">${rNps.toFixed(1)}%</b></span>
              <span>Enc: <b>${repEncs.length}</b></span>
              <span style="color:var(--green)">P: <b>${rP}</b></span>
              <span style="color:var(--yellow)">N: <b>${rN}</b></span>
              <span style="color:var(--red)">D: <b>${rD}</b></span>
            </div>
          </div>
        </div>
        <div class="rep-enc-list">
          ${filtered.length?filtered.reverse().map(e=>{
            const nc=e.t==='P'?'var(--green)':e.t==='N'?'var(--yellow)':'var(--red)';
            const nv=e.t==='P'?'100%':e.t==='N'?'0%':'-100%';
            return `<div class="rep-enc-item">
              <span class="rep-enc-time">${e.ts}</span>
              <span style="color:var(--t3);min-width:70px">Caso ${e.cid}</span>
              <span class="rep-enc-proc">${e.proc}</span>
              <span class="rep-enc-nps" style="color:${nc}">${nv}</span>
            </div>`;
          }).join(''):'<div style="text-align:center;padding:12px;color:var(--t3);font-size:10px">Sin encuestas con este filtro</div>'}
        </div>
      </div>`;
    }
  });

  box.innerHTML=html;
}

function toggleRepDetail(id){
  S.selRep=S.selRep===id?null:id;
  rendRachas();
}

function calcSk(d){if(!d.length)return{type:null,count:0};let l=d[d.length-1],c=0;for(let i=d.length-1;i>=0;i--){if(d[i]===l)c++;else break;}return{type:l,count:c};}
function skInfo(s){if(!s.type)return{i:'',bg:'transparent',c:'var(--t3)'};return{P:{i:'ğŸ”¥',bg:'var(--greenBg)',c:'var(--green)'},N:{i:'ğŸ˜',bg:'var(--yellowBg)',c:'var(--yellow)'},D:{i:'âš ï¸',bg:'var(--redBg)',c:'var(--red)'}}[s.type];}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TABLE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function rendTable(f){
  const tb=document.getElementById('tblBody');
  if(!f||!f.length){tb.innerHTML='<tr><td colspan="7" style="text-align:center;padding:20px;color:var(--t3)">Sin encuestas aÃºn</td></tr>';return;}
  tb.innerHTML=[...f].reverse().map(e=>{
    const pc=e.t==='P'?'p':e.t==='N'?'n':'d';
    const nv=e.t==='P'?'100%':e.t==='N'?'0%':'-100%';
    return `<tr>
      <td>feb 11, ${e.ts}a.m.</td>
      <td>${e.cid}</td>
      <td>${LID.find(l=>l.id===e.lid)?.n||e.lid}</td>
      <td><b>${e.rn}</b></td>
      <td style="max-width:180px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis">${e.sol}</td>
      <td style="max-width:200px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;font-style:italic">${e.com}</td>
      <td><span class="npill ${pc}">${nv}</span></td>
    </tr>`;
  }).join('');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FEED
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function addFeed(html){
  const fb=document.getElementById('feedBox');
  if(!S.feedOn){fb.innerHTML='';S.feedOn=true;}
  fb.insertAdjacentHTML('afterbegin',html);
  while(fb.children.length>25)fb.removeChild(fb.lastChild);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TOAST (non-intrusive achievement)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showToast(emoji,title,desc){
  const c=document.getElementById('toasts');
  const t=document.createElement('div');
  t.className='toast';
  t.innerHTML=`<div class="toast-emoji">${emoji}</div><div class="toast-body"><div class="toast-title">ğŸ† Â¡${title}!</div><div class="toast-desc">${desc}</div><div class="toast-bar"><div class="toast-bar-fill"></div></div></div>`;
  c.appendChild(t);
  miniConfetti();
  // Feed card too
  addFeed(`<div class="fc" style="background:linear-gradient(135deg,rgba(179,136,255,0.08),rgba(0,229,255,0.04));border-color:rgba(179,136,255,0.15);"><div class="fch"><span class="fci">${emoji}</span><span class="fct" style="color:var(--purple)">Â¡Logro!</span></div><div class="fcb"><b>${title}</b> â€” ${desc}</div></div>`);
  setTimeout(()=>t.remove(),7500);
}

function miniConfetti(){
  const cols=['#b388ff','#00e5ff','#00e676','#ffc107','#536dfe'];
  for(let i=0;i<25;i++){
    const c=document.createElement('div');c.className='confetti';
    c.style.cssText=`left:${70+Math.random()*30}%;top:0;background:${cols[i%5]};width:${Math.random()*6+3}px;height:${Math.random()*6+3}px;border-radius:${Math.random()>0.5?'50%':'1px'};animation-duration:${Math.random()*1.5+1}s;animation-delay:${Math.random()*0.3}s;`;
    document.body.appendChild(c);setTimeout(()=>c.remove(),3000);
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// HELPERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function nxtC(){S.cN+=Math.floor(Math.random()*35)+5;return S.cN;}
function advT(){S.mN+=Math.floor(Math.random()*10)+2;if(S.mN>=60){S.mN-=60;S.hN=Math.min(18,S.hN+1);}return `${S.hN}:${String(S.mN).padStart(2,'0')}`;}
function rnd(a){return a[Math.floor(Math.random()*a.length)];}
function flash(c){const el=document.getElementById(c==='r'?'flR':'flG');el.classList.add('show');setTimeout(()=>el.classList.remove('show'),180);}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SIMULATORS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function simP(){
  const rep=rnd(REPS),pi=Math.floor(Math.random()*PROC.length),com=rnd(CP);
  const cid=nxtC(),ts=advT();
  const e={t:'P',rid:rep.id,rn:rep.n,lid:rep.l,proc:PROC[pi],sol:SOL[pi],com:com,cid:cid,ts:ts,hr:S.hN};
  S.enc.push(e);S.p++;S.rachas[rep.id].push('P');
  flash('g');

  const sk=calcSk(S.rachas[rep.id]);
  const prev=S.rachas[rep.id].length>=2?S.rachas[rep.id][S.rachas[rep.id].length-2]:null;

  addFeed(`<div class="fc pro"><div class="fch"><span class="fci">ğŸŸ¢</span><span class="fct" style="color:var(--green)">Promotor</span><span class="fctime">${ts} Â· ${cid}</span></div><div class="fcb"><b>${rep.n}</b> Â· ${PROC[pi]}<br><em>"${com}"</em></div></div>`);
  apply();

  if(sk.type==='P'&&sk.count===5)setTimeout(()=>showToast('ğŸ’','RACHA PERFECTA',`${rep.n} â€” 5 promotores seguidos`),400);
  else if(sk.type==='P'&&prev==='D')setTimeout(()=>showToast('ğŸ›¡ï¸','RECUPERACIÃ“N Ã‰PICA',`${rep.n} â€” Promotor despuÃ©s de detractor`),400);
  else if(S.p===1&&S.n===0&&S.d===0)setTimeout(()=>showToast('ğŸš€','PRIMER PROMOTOR',`${rep.n} â€” Â¡ArrancÃ³ el dÃ­a con todo!`),400);
}

function simD(){
  const rep=rnd(REPS),pi=Math.floor(Math.random()*PROC.length),com=rnd(CD);
  const cid=nxtC(),ts=advT();
  const e={t:'D',rid:rep.id,rn:rep.n,lid:rep.l,proc:PROC[pi],sol:SOL[pi],com:com,cid:cid,ts:ts,hr:S.hN};
  S.enc.push(e);S.d++;S.rachas[rep.id].push('D');
  flash('r');

  const detC=S.enc.filter(x=>x.rid===rep.id&&x.t==='D').length;
  const ref=REPS.filter(r=>r.id!==rep.id);
  const e1=rnd(ref),e2=rnd(ref.filter(r=>r.id!==e1.id));

  addFeed(`<div class="fc det"><div class="fch"><span class="fci">ğŸš¨</span><span class="fct" style="color:var(--red)">Detractor</span><span class="fctime">${ts} Â· ${cid}</span></div><div class="fcb"><b>${rep.n}</b> Â· ${PROC[pi]}<br>Sol: ${SOL[pi]}<br><em>"${com}"</em></div><div class="espejo"><div class="espejo-t">ğŸ’¡ Casos espejo â€” Promotor en menor tiempo</div><div class="espejo-i">âœ… ${cid-Math.floor(Math.random()*3000)-800} Â· <b>${e1.n}</b> Â· ${(Math.random()*6+12).toFixed(1)} min â†’ 100%</div><div class="espejo-i">âœ… ${cid-Math.floor(Math.random()*5000)-1500} Â· <b>${e2.n}</b> Â· ${(Math.random()*8+13).toFixed(1)} min â†’ 100%</div></div><div class="pbox"><div class="pbox-t">âš ï¸ Contexto histÃ³rico</div><div style="font-size:9px;color:var(--t2);line-height:1.4"><b>${rep.n}</b> lleva <b>${detC}</b> detractor${detC>1?'es':''} en <em>${PROC[pi].split(' - ')[0]}</em> este mes. Referente: <b>${rnd(ref).n}</b></div></div></div>`);
  apply();
}

function simN(){
  const rep=rnd(REPS),pi=Math.floor(Math.random()*PROC.length),com=rnd(CN);
  const cid=nxtC(),ts=advT();
  const e={t:'N',rid:rep.id,rn:rep.n,lid:rep.l,proc:PROC[pi],sol:SOL[pi],com:com,cid:cid,ts:ts,hr:S.hN};
  S.enc.push(e);S.n++;S.rachas[rep.id].push('N');

  addFeed(`<div class="fc neu"><div class="fch"><span class="fci">ğŸŸ¡</span><span class="fct" style="color:var(--yellow)">Neutro</span><span class="fctime">${ts} Â· ${cid}</span></div><div class="fcb"><b>${rep.n}</b> Â· ${PROC[pi]}<br><em>"${com}"</em></div></div>`);
  apply();
}

function simPatron(){
  const pr=rnd(PROC).split(' - ')[0],sb=rnd(SOL),sg=rnd(SOL);
  const pD=Math.floor(Math.random()*22)+65,pP=Math.floor(Math.random()*18)+60,at=(Math.random()*6+12).toFixed(1),hr=Math.floor(Math.random()*4)+14;
  addFeed(`<div class="fc pat"><div class="fch"><span class="fci">ğŸ§ </span><span class="fct" style="color:var(--indigo)">PatrÃ³n</span><span class="fctime">HistÃ³rico</span></div><div class="fcb"><b>${pr}</b> + <em>"${sb.substring(0,30)}..."</em><br>â†’ <b style="color:var(--red)">${pD}% detractores</b> este mes</div><div class="pbox"><div class="pbox-t">ğŸ’¡ Alternativa</div><div style="font-size:9px;color:var(--t2);line-height:1.4">Con <em>"${sg.substring(0,30)}..."</em> â†’ <b style="color:var(--green)">${pP}% promotor</b> Â· ${at} min<br>DespuÃ©s de las ${hr}:00 detractores +23%</div></div></div>`);
}

function simLogro(){
  const l=rnd(LOGROS),rep=rnd(REPS);
  showToast(l.e,l.t,`${rep.n} â€” ${l.d}`);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CIERRE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function simCierre(t){
  const am=t==='am';
  document.getElementById('ciTL').textContent=am?'CIERRE TURNO MAÃ‘ANA':'CIERRE TURNO TARDE';
  document.getElementById('ciHR').textContent=am?'ğŸ“Š 12:25 PM':'ğŸ“Š 6:30 PM';
  WK[TI]={d:'MiÃ©',e:S.p+S.n+S.d,p:S.p,n:S.n,dd:S.d};
  const wk=document.getElementById('ciWK');
  wk.innerHTML=WK.map((w,i)=>{
    const today=i===TI,future=i>TI;
    const nps=w.e>0?((w.p-w.dd)/w.e*100):null;
    const c=nps===null?'var(--t3)':nps>=36.6?'var(--green)':nps>=0?'var(--yellow)':'var(--red)';
    return `<div style="text-align:center;padding:10px 4px;border-radius:10px;background:${today?'var(--indigoBg)':'var(--bg3)'};border:1px solid ${today?'rgba(83,109,254,0.2)':'var(--border)'};opacity:${future?0.3:1}"><div style="font-size:9px;font-weight:700;color:var(--t3);text-transform:uppercase;margin-bottom:3px">${w.d}</div><div style="font-size:18px;font-weight:800">${future?'--':w.e||'--'}</div><div style="font-size:11px;font-weight:600;color:${future?'var(--t3)':c}">${future?'--':nps!==null?nps.toFixed(1)+'%':'--'}</div></div>`;
  }).join('');

  const wt=WK.reduce((a,w)=>({p:a.p+w.p,n:a.n+w.n,d:a.d+w.dd,e:a.e+w.e}),{p:0,n:0,d:0,e:0});
  const wN=wt.e>0?((wt.p-wt.d)/wt.e*100):null;
  const sn=document.getElementById('ciSN');
  sn.textContent=wN!==null?wN.toFixed(1)+'%':'--%';
  sn.style.color=wN===null?'var(--t3)':wN>=36.6?'var(--green)':wN>=0?'var(--yellow)':'var(--red)';

  const mg=document.getElementById('ciMG');
  if(am){
    mg.innerHTML=wN>=36.6?'Â¡Vamos por encima de la meta! ğŸ’ª Pueden caer mÃ¡s encuestas,<br>Â¡el equipo de maÃ±ana dejÃ³ la vara alta! ğŸ”¥':wN>=15?'Cerquita de la meta, aÃºn hay camino. ğŸ“ˆ<br>Â¡Esperemos que la tarde nos ayude a cerrar mejor! ğŸ’ª':'Semana retadora, cada encuesta cuenta. ğŸ›¤ï¸<br>Â¡Esperemos cerrar mejor al final del dÃ­a!';
  } else {
    mg.innerHTML=wN>=36.6?'Â¡Gran cierre! El equipo lo dio todo. ğŸ†<br>MaÃ±ana seguimos construyendo. Â¡A descansar! ğŸŒ™':wN>=15?'AsÃ­ cerramos hoy. Pueden caer mÃ¡s encuestas,<br>pero el equipo dio todo. Â¡MaÃ±ana seguimos! ğŸ”¥':'DÃ­a retador, cada dÃ­a es oportunidad nueva. ğŸŒ…<br>Â¡MaÃ±ana arrancamos con toda! ğŸ’ª';
  }
  document.getElementById('ciOv').style.display='flex';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// AUTO-PLAY
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let autoT=null;
function simAuto(){
  if(autoT){clearInterval(autoT);autoT=null;return;}
  switchTab('rt');
  const seq=['P','P','D','P','N','P','P','P','D','N','P','P','D','P','P','N','P','P','P','D'];
  let i=0;
  autoT=setInterval(()=>{
    if(i>=seq.length){clearInterval(autoT);autoT=null;setTimeout(simPatron,400);setTimeout(()=>simCierre('pm'),2200);return;}
    seq[i]==='P'?simP():seq[i]==='D'?simD():simN();
    i++;
  },700);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// AUTO RESET (midnight)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function autoReset(){
  S.p=0;S.n=0;S.d=0;S.feedOn=false;S.hN=8;S.mN=5;S.enc=[];S.selRep=null;S.fType='all';S.fLid='all';S.fRep='all';
  REPS.forEach(r=>S.rachas[r.id]=[]);
  WK[TI]={d:'MiÃ©',e:0,p:0,n:0,dd:0};
  document.getElementById('feedBox').innerHTML='<div class="empty" style="padding:24px 10px;"><div class="empty-e" style="font-size:32px;">ğŸ“¡</div><div class="empty-t" style="font-size:14px;">Escuchando...</div><div class="empty-s" style="font-size:11px;">Alertas aparecerÃ¡n aquÃ­</div></div>';
  document.querySelectorAll('.fpill').forEach(b=>b.classList.remove('on'));
  document.querySelector('.fpill[data-v="all"]').classList.add('on');
  document.getElementById('fLider').value='all';
  populateRepSel('all');
  apply();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PRE-POPULATE (Real Time tab with data)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function prePop(){
  const data=[
    {t:'P',r:0},{t:'P',r:1},{t:'D',r:2},{t:'P',r:3},{t:'N',r:4},
    {t:'P',r:5},{t:'P',r:0},{t:'D',r:6},{t:'P',r:7},{t:'P',r:1},
    {t:'N',r:8},{t:'P',r:9},{t:'D',r:10},{t:'P',r:11},{t:'P',r:3},
    {t:'P',r:5},{t:'N',r:7},{t:'P',r:0},{t:'D',r:2},{t:'P',r:9}
  ];
  data.forEach(d=>{
    const rep=REPS[d.r],pi=Math.floor(Math.random()*PROC.length);
    const com=d.t==='P'?rnd(CP):d.t==='D'?rnd(CD):rnd(CN);
    const cid=nxtC(),ts=advT();
    S.enc.push({t:d.t,rid:rep.id,rn:rep.n,lid:rep.l,proc:PROC[pi],sol:SOL[pi],com:com,cid:cid,ts:ts,hr:S.hN});
    if(d.t==='P')S.p++;else if(d.t==='D')S.d++;else S.n++;
    S.rachas[rep.id].push(d.t);
  });

  // Pre-populate feed
  S.feedOn=true;
  const fb=document.getElementById('feedBox');fb.innerHTML='';
  [...S.enc].reverse().slice(0,12).forEach(e=>{
    const cls=e.t==='P'?'pro':e.t==='D'?'det':'neu';
    const icon=e.t==='P'?'ğŸŸ¢':e.t==='D'?'ğŸš¨':'ğŸŸ¡';
    const lab=e.t==='P'?'Promotor':e.t==='D'?'Detractor':'Neutro';
    const col=e.t==='P'?'var(--green)':e.t==='D'?'var(--red)':'var(--yellow)';
    let extra='';
    if(e.t==='D'){
      const ref=REPS.filter(r=>r.id!==e.rid);
      extra=`<div class="espejo"><div class="espejo-t">ğŸ’¡ Casos espejo</div><div class="espejo-i">âœ… ${e.cid-1100} Â· <b>${rnd(ref).n}</b> Â· ${(Math.random()*5+13).toFixed(1)} min â†’ 100%</div></div><div class="pbox"><div class="pbox-t">âš ï¸ Contexto</div><div style="font-size:9px;color:var(--t2);line-height:1.4"><b>${e.rn}</b> lleva <b>${S.enc.filter(x=>x.rid===e.rid&&x.t==='D').length}</b> detractores en <em>${e.proc.split(' - ')[0]}</em>. Referente: <b>${rnd(ref).n}</b></div></div>`;
    }
    fb.insertAdjacentHTML('beforeend',`<div class="fc ${cls}" style="animation:none"><div class="fch"><span class="fci">${icon}</span><span class="fct" style="color:${col}">${lab}</span><span class="fctime">${e.ts} Â· ${e.cid}</span></div><div class="fcb"><b>${e.rn}</b> Â· ${e.proc}<br><em>"${e.com}"</em></div>${extra}</div>`);
  });
}
</script>
</body>
</html>
