<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NPS Real Time Engine</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Inter',system-ui,sans-serif;background:#f5f6f8;color:#1e2a3a;min-height:100vh}
::-webkit-scrollbar{width:4px}::-webkit-scrollbar-thumb{background:#ccc;border-radius:4px}

/* VARS */
:root{--g:#16a34a;--gB:#f0fdf4;--gD:#bbf7d0;--y:#b45309;--yB:#fffbeb;--yD:#fde68a;--r:#dc2626;--rB:#fef2f2;--rD:#fecaca;--i:#4f46e5;--iB:#eef2ff;--iD:#c7d2fe;--p:#7c3aed;--blue:#2D3277;--meliY:#FFE600;--card:#fff;--brd:#e5e7eb;--sh:0 1px 3px rgba(0,0,0,.05);--t1:#1e2a3a;--t2:#64748b;--t3:#94a3b8}

.wrap{max-width:1400px;margin:0 auto;padding:12px 16px}

/* === HEADER === */
.hdr{display:flex;align-items:center;gap:14px;padding:10px 18px;background:var(--blue);border-radius:12px 12px 0 0;color:#fff;flex-wrap:wrap}
.hdr-logo{width:36px;height:36px;border-radius:8px;background:var(--meliY);display:grid;place-items:center;font-size:18px;font-weight:900;color:var(--blue);flex-shrink:0}
.hdr-tx{flex-shrink:0}
.hdr-tx small{font-size:8px;text-transform:uppercase;letter-spacing:1.5px;opacity:.75;display:block}
.hdr-tx b{font-size:14px;letter-spacing:-.3px}
.hdr-f{display:flex;gap:6px;margin-left:auto;flex-wrap:wrap;align-items:center}
.fp{display:flex;gap:2px;background:rgba(255,255,255,.1);border-radius:6px;padding:2px}
.fp button{padding:4px 10px;border:none;border-radius:5px;font:600 10px/1 Inter;cursor:pointer;transition:.2s;background:0;color:rgba(255,255,255,.65)}
.fp button:hover{color:#fff}
.fp button.on{background:rgba(255,255,255,.18);color:#fff}
.fp button[data-v="P"].on{background:rgba(74,222,128,.25);color:#a7f3d0}
.fp button[data-v="N"].on{background:rgba(250,204,21,.25);color:#fef08a}
.fp button[data-v="D"].on{background:rgba(248,113,113,.25);color:#fecaca}
.hsel{padding:5px 24px 5px 8px;border-radius:6px;background:rgba(255,255,255,.1);border:1px solid rgba(255,255,255,.12);color:#fff;font:600 10px Inter;cursor:pointer;appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='8' height='5'%3E%3Cpath d='M0 0l4 5 4-5z' fill='rgba(255,255,255,.5)'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 6px center}
.hsel option{color:#1e2a3a;background:#fff}

/* === TABS === */
.tabs{display:flex;justify-content:center;background:var(--card);border-inline:1px solid var(--brd);border-bottom:1px solid var(--brd);border-radius:0 0 12px 12px;margin-bottom:10px}
.tabs div{padding:10px 24px;font:600 11px Inter;cursor:pointer;color:var(--t3);border-bottom:2px solid transparent;transition:.2s;display:flex;align-items:center;gap:4px}
.tabs div:hover{color:var(--t1)}
.tabs div.on{color:var(--i);border-color:var(--i)}
.pan{display:none}.pan.on{display:block}

/* === INFO BAR === */
.ibar{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;flex-wrap:wrap;gap:4px;padding:0 2px}
.ibar>*{font-size:10px;color:var(--t2)}
.ibar b{color:var(--t1)}
.ipill{background:var(--card);padding:4px 10px;border-radius:6px;border:1px solid var(--brd);box-shadow:var(--sh)}

/* === TRIO === */
.trio{display:grid;grid-template-columns:240px 1fr 240px;gap:10px;margin-bottom:10px}
.tcol{background:var(--card);border:1px solid var(--brd);border-radius:10px;padding:14px;box-shadow:var(--sh);display:flex;flex-direction:column}
.tcol-t{font:700 10px/1 Inter;text-transform:uppercase;letter-spacing:.8px;color:var(--t2);margin-bottom:10px}
.big-n{text-align:center;font-size:30px;font-weight:900;line-height:1.1}
.big-l{text-align:center;font-size:8px;font-weight:600;text-transform:uppercase;letter-spacing:1px;color:var(--t3);margin-bottom:2px}
.pills{display:flex;gap:4px;justify-content:center;margin:8px 0}
.pl{padding:4px 12px;border-radius:6px;font:800 14px Inter;min-width:40px;text-align:center}
.pl.p{background:var(--gB);color:var(--g);border:1px solid var(--gD)}
.pl.n{background:var(--yB);color:var(--y);border:1px solid var(--yD)}
.pl.d{background:var(--rB);color:var(--r);border:1px solid var(--rD)}
.tc{background:#f8fafc;border:1px solid var(--brd);border-radius:7px;padding:8px 10px;margin-top:6px;font-size:9px}
.tc-t{font:700 7px/1 Inter;text-transform:uppercase;letter-spacing:.8px;color:var(--t3);margin-bottom:4px}
.tc-r{display:flex;justify-content:space-between;color:var(--t2)}
.tc-r b{color:var(--t1)}

/* LIVE BADGE */
.lv{display:inline-flex;align-items:center;gap:4px;padding:2px 8px;border-radius:12px;background:var(--rB);border:1px solid var(--rD);font:700 8px Inter;color:var(--r)}
.lv i{width:6px;height:6px;border-radius:50%;background:var(--r);display:block;animation:pls 1.4s infinite}
@keyframes pls{0%,100%{box-shadow:0 0 0 0 rgba(220,38,38,.4)}50%{box-shadow:0 0 0 4px rgba(220,38,38,0)}}

/* CHART */
.chtW{flex:1;min-height:0;position:relative}
.chtW canvas{width:100%!important;height:100%!important}
.meta-tag{position:absolute;top:2px;right:2px;font:700 7px Inter;color:var(--y);background:var(--yB);padding:2px 5px;border-radius:3px;border:1px solid var(--yD)}

/* === THERMO === */
.thm{display:flex;align-items:center;gap:5px;justify-content:center;padding:6px 12px;border-radius:8px;background:var(--card);border:1px solid var(--brd);font:500 10px Inter;color:var(--t2);margin-bottom:8px;box-shadow:var(--sh)}
.thm b{color:var(--t1)}

/* === NPS BAR === */
.nbar{background:var(--card);border:1px solid var(--brd);border-radius:8px;padding:10px 14px;margin-bottom:8px;box-shadow:var(--sh)}
.nbar-h{display:flex;justify-content:space-between;align-items:center;margin-bottom:5px}
.nbar-l{font:600 10px Inter;color:var(--t2)}
.nbar-v{font:800 16px Inter}
.nbar-track{height:8px;background:#f1f5f9;border-radius:4px;position:relative;overflow:visible}
.nbar-fill{height:100%;border-radius:4px;transition:width .6s ease,background .3s}
.nbar-mark{position:absolute;top:-3px;bottom:-3px;width:2px;background:var(--y);border-radius:2px}
.nbar-mark span{position:absolute;top:-14px;left:50%;transform:translateX(-50%);font:700 7px Inter;color:var(--y);white-space:nowrap}

/* === ACCORDION === */
.acc{background:var(--card);border:1px solid var(--brd);border-radius:10px;margin-bottom:8px;box-shadow:var(--sh);overflow:hidden}
.acc-h{display:flex;align-items:center;justify-content:space-between;padding:10px 14px;cursor:pointer;user-select:none}
.acc-h:hover{background:#fafbfc}
.acc-ht{font:700 11px Inter;color:var(--t2);display:flex;align-items:center;gap:6px}
.acc-bg{font:700 9px Inter;padding:2px 6px;border-radius:4px;background:var(--iB);color:var(--i)}
.acc-ar{font-size:10px;color:var(--t3);transition:transform .3s}
.acc-b{max-height:0;overflow:hidden;transition:max-height .35s ease}
.acc-b.open{max-height:4000px}
.acc-in{padding:0 14px 12px}

/* REP ROW */
.rr{display:flex;align-items:center;gap:8px;padding:7px 8px;border-radius:7px;cursor:pointer;transition:.15s;border:1px solid transparent;margin-bottom:2px}
.rr:hover{background:#f8fafc;border-color:var(--brd)}
.rr.sel{background:var(--iB);border-color:var(--iD)}
.rr-av{width:28px;height:28px;border-radius:6px;display:grid;place-items:center;font:700 10px Inter;flex-shrink:0}
.rr-i{flex:1;min-width:0}
.rr-n{font:600 11px Inter;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.rr-s{font:400 9px Inter;color:var(--t3);margin-top:1px}
.rr-dots{display:flex;gap:2px;flex-wrap:wrap;margin-top:2px}
.dot{width:15px;height:15px;border-radius:3px;font:700 7px Inter;display:grid;place-items:center}
.dot.P{background:var(--gB);color:var(--g);border:1px solid var(--gD)}
.dot.N{background:var(--yB);color:var(--y);border:1px solid var(--yD)}
.dot.D{background:var(--rB);color:var(--r);border:1px solid var(--rD)}
.rr-sk{font:700 9px Inter;padding:2px 6px;border-radius:4px;white-space:nowrap}

/* REP DETAIL */
.rdtl{background:#f8fafc;border:1px solid var(--brd);border-radius:8px;margin:4px 0 8px;padding:10px;animation:fadeUp .25s ease}
@keyframes fadeUp{from{opacity:0;transform:translateY(-4px)}to{opacity:1;transform:translateY(0)}}
.rdtl-h{display:flex;align-items:center;gap:8px;margin-bottom:6px}
.rdtl-nm{font:700 12px Inter}
.rdtl-st{display:flex;gap:8px;font:400 9px Inter;color:var(--t2)}
.rdtl-st b{color:var(--t1)}
.rdtl-list{max-height:160px;overflow-y:auto}
.rdtl-li{display:flex;align-items:center;gap:5px;padding:4px 5px;font:400 9px Inter;color:var(--t2);border-bottom:1px solid #f1f5f9}
.rdtl-li:last-child{border:none}
.rdtl-li:hover{background:#f1f5f9}

/* === BOTTOM GRID === */
.bgrid{display:grid;grid-template-columns:1fr 320px;gap:8px;margin-bottom:8px}

/* TABLE */
.tblW{background:var(--card);border:1px solid var(--brd);border-radius:10px;box-shadow:var(--sh);overflow:hidden}
.tblW-h{padding:10px 14px;font:700 11px Inter;color:var(--t2)}
.tblW-s{max-height:240px;overflow-y:auto}
table{width:100%;border-collapse:collapse;font-size:9px}
th{text-align:left;padding:5px 8px;font:700 7px Inter;text-transform:uppercase;letter-spacing:.5px;color:var(--t3);border-bottom:1px solid var(--brd);position:sticky;top:0;background:var(--card)}
td{padding:4px 8px;border-bottom:1px solid #f8fafc;color:var(--t2)}
tr:hover td{background:#fafbfc}
.npil{padding:1px 6px;border-radius:3px;font:700 8px Inter}
.npil.p{background:var(--gB);color:var(--g)}
.npil.n{background:var(--yB);color:var(--y)}
.npil.d{background:var(--rB);color:var(--r)}

/* FEED */
.fdW{background:var(--card);border:1px solid var(--brd);border-radius:10px;box-shadow:var(--sh);overflow:hidden;display:flex;flex-direction:column}
.fdW-h{padding:10px 14px;font:700 11px Inter;color:var(--t2)}
.fdW-s{flex:1;max-height:240px;overflow-y:auto;padding:0 14px 10px}
.fd{padding:8px;border-radius:7px;margin-bottom:4px;border:1px solid;animation:slideR .35s ease}
@keyframes slideR{from{transform:translateX(20px);opacity:0}to{transform:translateX(0);opacity:1}}
.fd.pro{background:var(--gB);border-color:var(--gD)}
.fd.det{background:var(--rB);border-color:var(--rD)}
.fd.neu{background:var(--yB);border-color:var(--yD)}
.fd.pat{background:var(--iB);border-color:var(--iD)}
.fd.ach{background:#f5f3ff;border-color:#ddd6fe}
.fd-h{display:flex;align-items:center;gap:4px;margin-bottom:2px}
.fd-ic{font-size:12px}
.fd-tp{font:700 7px Inter;text-transform:uppercase;letter-spacing:.5px}
.fd-tm{font:400 7px Inter;color:var(--t3);margin-left:auto}
.fd-b{font:400 9px/1.4 Inter;color:var(--t2)}.fd-b b{color:var(--t1)}
.esp{margin-top:4px;padding:5px 7px;border-radius:5px;background:rgba(22,163,74,.03);border:1px solid var(--gD)}
.esp-t{font:700 7px Inter;color:var(--g);text-transform:uppercase;letter-spacing:.5px;margin-bottom:2px}
.esp-i{font:400 8px Inter;color:var(--t2)}
.pbx{margin-top:4px;padding:5px 7px;border-radius:5px;background:rgba(79,70,229,.03);border:1px solid var(--iD)}
.pbx-t{font:700 7px Inter;color:var(--i);text-transform:uppercase;letter-spacing:.5px;margin-bottom:2px}

/* TOAST */
.tst-c{position:fixed;top:12px;right:12px;z-index:1100;display:flex;flex-direction:column;gap:6px;pointer-events:none}
.tst{pointer-events:auto;display:flex;align-items:center;gap:8px;padding:10px 12px;border-radius:10px;background:var(--card);border:1px solid var(--iD);box-shadow:0 4px 20px rgba(0,0,0,.08);max-width:300px;animation:tIn .4s ease,tOut .3s ease 6.7s forwards}
@keyframes tIn{from{transform:translateX(100%);opacity:0}to{transform:translateX(0);opacity:1}}
@keyframes tOut{from{opacity:1;transform:translateX(0)}to{opacity:0;transform:translateX(100%)}}
.tst-e{font-size:24px;flex-shrink:0}
.tst-tt{font:800 10px Inter;color:var(--p)}
.tst-ds{font:400 9px Inter;color:var(--t2);margin-top:1px}
.tst-bar{height:2px;border-radius:1px;background:#f1f5f9;margin-top:4px;overflow:hidden}
.tst-bar div{height:100%;background:var(--p);border-radius:1px;animation:shrk 7s linear forwards}
@keyframes shrk{from{width:100%}to{width:0}}

/* EMPTY */
.emt{text-align:center;padding:28px 10px}
.emt-e{font-size:32px;margin-bottom:6px;animation:bnc 1s ease infinite alternate}
@keyframes bnc{to{transform:translateY(-5px)}}
.emt-t{font:700 14px Inter;margin-bottom:2px}
.emt-s{font:400 11px Inter;color:var(--t2);line-height:1.4}

/* SIM */
.sim{background:var(--card);border:1px solid var(--brd);border-radius:10px;padding:14px;margin-bottom:8px;box-shadow:var(--sh)}
.sim-g{display:grid;grid-template-columns:repeat(4,1fr);gap:6px}
.sb{padding:10px 6px;border-radius:8px;border:1px solid;font:600 10px Inter;cursor:pointer;transition:.2s;display:flex;flex-direction:column;align-items:center;gap:3px}
.sb:hover{transform:translateY(-1px);box-shadow:0 2px 8px rgba(0,0,0,.06)}
.sb:active{transform:scale(.97)}
.sb.gb{background:var(--gB);border-color:var(--gD);color:var(--g)}
.sb.rb{background:var(--rB);border-color:var(--rD);color:var(--r)}
.sb.yb{background:var(--yB);border-color:var(--yD);color:var(--y)}
.sb.ib{background:var(--iB);border-color:var(--iD);color:var(--i)}
.sb.pb{background:#f5f3ff;border-color:#ddd6fe;color:var(--p)}
.sb-i{font-size:18px}

/* CIERRE MODAL */
.cm-ov{position:fixed;inset:0;z-index:1000;background:rgba(0,0,0,.25);backdrop-filter:blur(3px);display:none;place-items:center}
.cm-ov.show{display:grid}
.cm{width:90%;max-width:500px;padding:24px;border-radius:16px;background:var(--card);border:1px solid var(--brd);box-shadow:0 16px 48px rgba(0,0,0,.08);animation:fadeUp .4s ease}
.cm-wk{display:grid;grid-template-columns:repeat(5,1fr);gap:6px;margin:14px 0}
.cm-d{text-align:center;padding:8px 4px;border-radius:7px;background:#f8fafc;border:1px solid var(--brd)}
.cm-d.today{background:var(--iB);border-color:var(--iD)}
.cm-d.future{opacity:.3}

/* FLASH */
.fl{position:fixed;inset:0;pointer-events:none;z-index:999;opacity:0;transition:opacity .1s}
.fl.r{background:rgba(220,38,38,.05)}.fl.g{background:rgba(22,163,74,.04)}
.fl.show{opacity:1}

/* CONFETTI */
.conf{position:fixed;z-index:1101;animation:cfl linear forwards;pointer-events:none}
@keyframes cfl{0%{transform:translateY(-10vh) rotate(0);opacity:1}100%{transform:translateY(110vh) rotate(720deg);opacity:0}}

.ftr{text-align:center;padding:12px;font:400 8px Inter;color:var(--t3)}

@media(max-width:1100px){.trio{grid-template-columns:1fr}.bgrid{grid-template-columns:1fr}}
@media(max-width:700px){.sim-g{grid-template-columns:repeat(2,1fr)}.hdr{gap:8px}.hdr-f{width:100%;justify-content:center}}
</style>
</head>
<body>
<div class="fl r" id="flR"></div>
<div class="fl g" id="flG"></div>
<div class="tst-c" id="toasts"></div>

<!-- CIERRE MODAL -->
<div class="cm-ov" id="cmOv">
<div class="cm">
  <div style="text-align:center;margin-bottom:4px">
    <div id="cmTL" style="font:700 9px Inter;text-transform:uppercase;letter-spacing:2px;color:var(--i)"></div>
    <div id="cmHR" style="font:800 20px Inter;margin-top:2px"></div>
  </div>
  <div class="cm-wk" id="cmWK"></div>
  <div style="text-align:center;padding:10px;border-radius:8px;background:#f8fafc;border:1px solid var(--brd);margin-bottom:10px">
    <div id="cmSN" style="font:800 24px Inter">--</div>
    <div style="font:400 9px Inter;color:var(--t2);margin-top:2px">NPS Semana Â· Meta 36.6%</div>
  </div>
  <div id="cmMG" style="text-align:center;font:italic 400 11px/1.6 Inter;color:var(--t2)"></div>
  <button onclick="document.getElementById('cmOv').classList.remove('show')" style="display:block;margin:12px auto 0;padding:6px 20px;border-radius:7px;border:1px solid var(--brd);background:#f8fafc;color:var(--t1);font:600 11px Inter;cursor:pointer">Cerrar</button>
</div>
</div>

<div class="wrap">

<!-- HEADER -->
<div class="hdr">
  <div class="hdr-logo">M</div>
  <div class="hdr-tx"><small>mercado libre</small><b>MATURE PUBLICACIONES</b></div>
  <div class="hdr-f">
    <div class="fp"><button class="on" data-v="all" onclick="setFT(this,'all')">NPS</button><button data-v="P" onclick="setFT(this,'P')">ğŸŸ¢ Promotor</button><button data-v="N" onclick="setFT(this,'N')">ğŸŸ¡ Neutro</button><button data-v="D" onclick="setFT(this,'D')">ğŸ”´ Detractor</button></div>
    <select class="hsel" id="fL" onchange="setFL(this.value)"><option value="all">LÃ­der Â·</option></select>
    <select class="hsel" id="fR" onchange="setFR(this.value)"><option value="all">Rep Â·</option></select>
  </div>
</div>
<div class="tabs"><div class="on" onclick="swT('rt')" id="tRT">ğŸ“¡ REAL TIME</div><div onclick="swT('sim')" id="tSIM">ğŸ® SIMULADOR</div></div>

<div style="text-align:center;font:italic 400 8px Inter;color:var(--t3);margin-bottom:8px">Los datos son ficticios para demostraciÃ³n. Las fuentes oficiales son las informadas en los bonos.</div>

<!-- ======= REAL TIME ======= -->
<div class="pan on" id="pRT">

<div class="ibar">
  <div>â° <b id="clk">--:--</b></div>
  <div class="ipill" id="avh">Ayer: <b>8 enc Â· 37.5%</b> â†’ Hoy: <b>0 enc</b></div>
  <div class="ipill" id="nxc">PrÃ³ximo cierre: 12:25 PM</div>
</div>

<!-- TRIO -->
<div class="trio">
  <!-- AYER -->
  <div class="tcol">
    <div class="tcol-t">RESULTADOS AYER</div>
    <div class="big-l">ENCUESTAS</div><div class="big-n">25</div>
    <div style="height:6px"></div>
    <div class="big-l">LINEAL AYER</div><div class="big-n" style="color:var(--g)">44.0 %</div>
    <div class="pills"><div class="pl p">16</div><div class="pl n">4</div><div class="pl d">5</div></div>
    <div class="tc"><div class="tc-t">TOP REPRESENTANTE AYER</div><div class="tc-r"><span>Valentina RÃ­os</span><span>4 enc</span><b style="color:var(--g)">100%</b></div></div>
    <div class="tc"><div class="tc-t">TOP EQUIPO AYER</div><div class="tc-r"><span>Lnocua</span><span>1 enc</span><b style="color:var(--g)">100%</b></div></div>
  </div>
  <!-- CHART -->
  <div class="tcol">
    <div class="tcol-t">DESARROLLO DEL DÃA POR HORAS</div>
    <div class="chtW"><canvas id="cht"></canvas><div class="meta-tag">META 36.6%</div></div>
  </div>
  <!-- HOY -->
  <div class="tcol">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px"><div class="tcol-t" style="margin:0">NPS REAL TIME</div><div class="lv"><i></i>LIVE</div></div>
    <div class="big-l">ENCUESTAS</div><div class="big-n" id="hE">0</div>
    <div style="height:6px"></div>
    <div class="big-l">LINEAL HOY</div><div class="big-n" id="hN" style="color:var(--t3)">-- %</div>
    <div class="pills"><div class="pl p" id="hP">0</div><div class="pl n" id="hNN">0</div><div class="pl d" id="hD">0</div></div>
    <div class="tc"><div class="tc-t">TOP REPRESENTANTE HOY</div><div id="trH"><div class="tc-r" style="color:var(--t3);font-size:8px">Esperando encuestas...</div></div></div>
    <div class="tc"><div class="tc-t">TOP EQUIPO HOY</div><div id="teH"><div class="tc-r" style="color:var(--t3);font-size:8px">Esperando encuestas...</div></div></div>
  </div>
</div>

<div class="thm" id="thm">ğŸ§Š TermÃ³metro: <b>Sin actividad â€” Â¿QuiÃ©n serÃ¡ el primer promotor del dÃ­a? ğŸš€</b></div>

<div class="nbar"><div class="nbar-h"><span class="nbar-l">NPS HOY</span><span class="nbar-v" id="bV" style="color:var(--t3)">-- %</span></div><div class="nbar-track"><div class="nbar-fill" id="bF" style="width:50%;background:var(--t3)"></div><div class="nbar-mark" style="left:68.3%"><span>Meta 36.6%</span></div></div></div>

<div class="acc"><div class="acc-h" onclick="togA(this)"><div class="acc-ht">ğŸ”¥ Rachas en Vivo <span class="acc-bg" id="rC">0</span></div><div class="acc-ar">â–¼</div></div><div class="acc-b" id="aB"><div class="acc-in" id="rBx"><div class="emt"><div class="emt-e">ğŸš€</div><div class="emt-t">Â¿QuÃ© esperas?</div><div class="emt-s">SÃ© el primer promotor del dÃ­a</div></div></div></div></div>

<div class="bgrid">
  <div class="tblW"><div class="tblW-h">ğŸ“‹ Encuestas del DÃ­a</div><div class="tblW-s"><table><thead><tr><th>Fecha</th><th>Caso</th><th>LÃ­der</th><th>Representante</th><th>SoluciÃ³n</th><th>Comentario</th><th>NPS</th></tr></thead><tbody id="tB"><tr><td colspan="7" style="text-align:center;padding:16px;color:var(--t3)">Sin encuestas</td></tr></tbody></table></div></div>
  <div class="fdW"><div class="fdW-h">ğŸ“¡ Feed en Tiempo Real</div><div class="fdW-s" id="fB"><div class="emt" style="padding:16px 6px"><div class="emt-e" style="font-size:24px">ğŸ“¡</div><div class="emt-t" style="font-size:12px">Escuchando...</div><div class="emt-s" style="font-size:9px">Alertas aparecerÃ¡n aquÃ­</div></div></div></div>
</div>
</div>

<!-- ======= SIMULADOR ======= -->
<div class="pan" id="pSIM">
<div class="sim">
  <div style="font:700 11px Inter;color:var(--t2);margin-bottom:3px">ğŸ® PANEL DE SIMULACIÃ“N</div>
  <p style="font:400 10px Inter;color:var(--t2);margin-bottom:8px">Cada botÃ³n simula un evento. Se refleja en la pestaÃ±a Real Time.</p>
  <div class="sim-g">
    <button class="sb gb" onclick="simP()"><span class="sb-i">ğŸŸ¢</span>Promotor</button>
    <button class="sb rb" onclick="simD()"><span class="sb-i">ğŸ”´</span>Detractor</button>
    <button class="sb yb" onclick="simN()"><span class="sb-i">ğŸŸ¡</span>Neutro</button>
    <button class="sb ib" onclick="simCi('am')"><span class="sb-i">ğŸŒ…</span>Cierre AM 12:25</button>
    <button class="sb ib" onclick="simCi('pm')"><span class="sb-i">ğŸŒ‡</span>Cierre PM 6:30</button>
    <button class="sb pb" onclick="simLg()"><span class="sb-i">ğŸ†</span>Logro</button>
    <button class="sb pb" onclick="simPa()"><span class="sb-i">ğŸ§ </span>PatrÃ³n</button>
    <button class="sb" style="background:#f8fafc;border-color:var(--brd);color:var(--t2)" onclick="simAuto()"><span class="sb-i">âš¡</span>Auto-Play</button>
  </div>
</div>
</div>

<div class="ftr">hecho por juan sebastian guerrero rodriguez, hecho con el ğŸ’›<br><span style="opacity:.4">NPS Real Time Engine Â· Simulador Demo Â· 2026</span></div>
</div>

<!-- ========= PARTE 2: SCRIPT ========= -->

  <script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DATA FICTICIA
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const LID=[{id:'lnocua',n:'Lnocua'},{id:'nimoreno',n:'Nimoreno'},{id:'marmendez',n:'Marmendez'},{id:'jpuyo',n:'Jpuyo'},{id:'lflorez',n:'Lflorez'}];
const REPS=[
{id:'pepitoperez',n:'Pepito PÃ©rez',av:'PP',c:'#4f46e5',l:'marmendez'},
{id:'mariagarcia',n:'MarÃ­a GarcÃ­a',av:'MG',c:'#16a34a',l:'marmendez'},
{id:'carlosruiz',n:'Carlos Ruiz',av:'CR',c:'#dc2626',l:'nimoreno'},
{id:'anamoreno',n:'Ana Moreno',av:'AM',c:'#7c3aed',l:'lnocua'},
{id:'luisdiaz',n:'Luis DÃ­az',av:'LD',c:'#b45309',l:'jpuyo'},
{id:'sofialopez',n:'SofÃ­a LÃ³pez',av:'SL',c:'#0891b2',l:'nimoreno'},
{id:'diegotorres',n:'Diego Torres',av:'DT',c:'#ea580c',l:'lflorez'},
{id:'valeriacast',n:'Valeria Castro',av:'VC',c:'#059669',l:'jpuyo'},
{id:'andresrios',n:'AndrÃ©s RÃ­os',av:'AR',c:'#9333ea',l:'lflorez'},
{id:'camilasan',n:'Camila SÃ¡nchez',av:'CS',c:'#e11d48',l:'marmendez'},
{id:'julianmart',n:'JuliÃ¡n MartÃ­nez',av:'JM',c:'#0284c7',l:'lnocua'},
{id:'laurabece',n:'Laura Becerra',av:'LB',c:'#65a30d',l:'jpuyo'}];
const PROC=['ReputaciÃ³n ME - Reclamo afecta reputaciÃ³n','PR - Propiedad Intelectual','GestiÃ³n PublicaciÃ³n - Modificar variantes','Potenciador - Eventos comerciales','Calidad Fotos - Mejorar fotos','Rep ME Ventas: LogÃ­stica Places - Excluimos','Antes de Publicar - CorrecciÃ³n catÃ¡logo','PR TÃ©cnica - Datos tÃ©cnicos','PR Art Prohib - ArtÃ­culos prohibidos','GestiÃ³n Pub - ModeraciÃ³n'];
const SOL=['Analizamos reputaciÃ³n, mantenemos impacto','Denuncia recibida, anÃ¡lisis en curso','Variantes, fotos y precio modificados','Beneficios potenciador explicados','Sugerencia correcciÃ³n enviada','LogÃ­stica Places - Excluimos','Fotos actualizadas correctamente','Datos tÃ©cnicos corregidos','ArtÃ­culo restringido, alternativas','PublicaciÃ³n moderada'];
const CP=['Pudieron solucionar mi problema, excelente','Muy buena ayuda, resolvieron rÃ¡pido','La asesora fue muy amable y clara','Me explicaron todo paso a paso','Excelente servicio, minutos resuelto','Me ayudaron perfecto con mi publicaciÃ³n','SÃºper rÃ¡pido y efectivo, gracias'];
const CD=['No me solucionaron el problema','No utilizan criterio ni sentido comÃºn','Speech prearmado, no se salen del texto','No terminÃ³ de ayudarme, me cortÃ³','El vendedor siempre pierde tiempo','Tardaron demasiado, no resolvieron','De asesor en asesor sin soluciÃ³n'];
const CN=['Fue normal, ni bien ni mal','Resolvieron pero tardaron','MÃ¡s o menos, esperaba mejor','AtenciÃ³n regular, proceso largo','No fue mala pero tampoco excelente'];
const LOGROS=[{e:'ğŸ’',t:'RACHA PERFECTA',d:'5 promotores seguidos'},{e:'ğŸ”¥',t:'EN LLAMAS',d:'3 promotores consecutivos'},{e:'ğŸ›¡ï¸',t:'RECUPERACIÃ“N',d:'Promotor despuÃ©s de detractor'},{e:'â­',t:'ESTRELLA DEL DÃA',d:'Mayor NPS con 5+ enc'},{e:'ğŸš€',t:'PRIMER PROMOTOR',d:'ArrancÃ³ el dÃ­a con todo'},{e:'ğŸ‘‘',t:'INVICTO',d:'0 detractores en el dÃ­a'}];
const WK=[{d:'Lun',e:14,p:8,n:2,dd:4},{d:'Mar',e:18,p:11,n:3,dd:4},{d:'MiÃ©',e:0,p:0,n:0,dd:0},{d:'Jue',e:0,p:0,n:0,dd:0},{d:'Vie',e:0,p:0,n:0,dd:0}];
const TDY=2;

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let S={p:0,n:0,d:0,rch:{},enc:[],fOn:false,cN:436200000,hN:8,mN:3,sel:null,ft:'all',fl:'all',fr:'all'};
REPS.forEach(r=>S.rch[r.id]=[]);

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// HELPERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const $=id=>document.getElementById(id);
const rnd=a=>a[Math.floor(Math.random()*a.length)];
function nxC(){S.cN+=Math.floor(Math.random()*30)+5;return S.cN}
function nxT(){S.mN+=Math.floor(Math.random()*7)+2;if(S.mN>=60){S.mN-=60;S.hN=Math.min(18,S.hN+1)}return S.hN+':'+String(S.mN).padStart(2,'0')}
function flash(c){const e=$(c==='r'?'flR':'flG');e.classList.add('show');setTimeout(()=>e.classList.remove('show'),150)}
function gf(){return S.enc.filter(e=>{if(S.ft!=='all'&&e.t!==S.ft)return false;if(S.fl!=='all'&&e.lid!==S.fl)return false;if(S.fr!=='all'&&e.rid!==S.fr)return false;return true})}
function cSk(d){if(!d.length)return{t:null,c:0};let l=d[d.length-1],c=0;for(let i=d.length-1;i>=0;i--){if(d[i]===l)c++;else break}return{t:l,c}}
function skI(s){if(!s.t)return{i:'',bg:'transparent',c:'var(--t3)'};return{P:{i:'ğŸ”¥',bg:'var(--gB)',c:'var(--g)'},N:{i:'ğŸ˜',bg:'var(--yB)',c:'var(--y)'},D:{i:'âš ï¸',bg:'var(--rB)',c:'var(--r)'}}[s.t]}
function npsC(v){return v>=36.6?'var(--g)':v>=0?'var(--y)':'var(--r)'}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
(function(){
  LID.forEach(l=>{const o=document.createElement('option');o.value=l.id;o.textContent=l.n;$('fL').appendChild(o)});
  popR('all');
  updClk();setInterval(updClk,1000);
  initCht();
  prePop();
  apply();
})();

function popR(lid){
  const s=$('fR'),r=lid==='all'?REPS:REPS.filter(x=>x.l===lid);
  s.innerHTML='<option value="all">Rep Â·</option>'+r.map(x=>'<option value="'+x.id+'">'+x.n+'</option>').join('');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TABS & FILTERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function swT(t){
  document.querySelectorAll('.tabs div').forEach(e=>e.classList.remove('on'));
  document.querySelectorAll('.pan').forEach(e=>e.classList.remove('on'));
  $(t==='rt'?'tRT':'tSIM').classList.add('on');
  $(t==='rt'?'pRT':'pSIM').classList.add('on');
}
function setFT(b,v){S.ft=v;document.querySelectorAll('.fp button').forEach(x=>x.classList.remove('on'));b.classList.add('on');apply()}
function setFL(v){S.fl=v;S.fr='all';popR(v);apply()}
function setFR(v){S.fr=v;apply()}
function togA(el){const b=el.nextElementSibling,a=el.querySelector('.acc-ar');b.classList.toggle('open');a.style.transform=b.classList.contains('open')?'rotate(180deg)':''}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CLOCK
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function updClk(){
  const now=new Date(),h=now.getHours(),m=now.getMinutes();
  $('clk').textContent=now.toLocaleTimeString('es-CO',{hour:'2-digit',minute:'2-digit',second:'2-digit'});
  $('nxc').textContent=h<12||(h===12&&m<25)?'PrÃ³ximo cierre: 12:25 PM':h<18||(h===18&&m<30)?'PrÃ³ximo cierre: 6:30 PM':'Cierres completados âœ…';
  if(h===0&&m===0&&now.getSeconds()<2)autoReset();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CHART
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let cht=null;
function initCht(){
  cht=new Chart($('cht').getContext('2d'),{
    type:'bar',
    data:{labels:['8h','9h','10h','11h','12h','13h','14h','15h','16h','17h','18h'],
    datasets:[
      {type:'bar',label:'Encuestas',data:Array(11).fill(0),backgroundColor:'rgba(79,70,229,.15)',borderColor:'rgba(79,70,229,.4)',borderWidth:1,borderRadius:3,yAxisID:'y1',order:2},
      {type:'line',label:'NPS %',data:Array(11).fill(null),borderColor:'#16a34a',backgroundColor:'rgba(22,163,74,.05)',borderWidth:2,pointRadius:3,pointBackgroundColor:'#16a34a',fill:true,tension:.3,yAxisID:'y',order:1,spanGaps:true}
    ]},
    options:{responsive:true,maintainAspectRatio:false,interaction:{mode:'index',intersect:false},
    plugins:{legend:{position:'top',labels:{color:'#64748b',font:{size:8,family:'Inter'},boxWidth:8,padding:5}}},
    scales:{
      x:{ticks:{color:'#94a3b8',font:{size:8}},grid:{color:'rgba(0,0,0,.03)'}},
      y:{position:'left',min:-100,max:100,ticks:{color:'#94a3b8',font:{size:8},callback:v=>v+'%'},grid:{color:'rgba(0,0,0,.04)'}},
      y1:{position:'right',min:0,ticks:{color:'#94a3b8',font:{size:8}},grid:{display:false}}
    }}
  });
}
function updCht(){
  if(!cht)return;const f=gf(),hrs={};
  f.forEach(e=>{const h=e.hr;if(!hrs[h])hrs[h]={p:0,n:0,d:0,t:0};if(e.t==='P')hrs[h].p++;else if(e.t==='N')hrs[h].n++;else hrs[h].d++;hrs[h].t++});
  const eD=[],nD=[];
  for(let h=8;h<=18;h++){const x=hrs[h];if(x&&x.t){eD.push(x.t);nD.push((x.p-x.d)/x.t*100)}else{eD.push(0);nD.push(null)}}
  cht.data.datasets[0].data=eD;cht.data.datasets[1].data=nD;cht.update('none');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MAIN APPLY
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function apply(){
  const f=gf(),pC=f.filter(e=>e.t==='P').length,nC=f.filter(e=>e.t==='N').length,dC=f.filter(e=>e.t==='D').length,tot=f.length;
  const nps=tot?((pC-dC)/tot*100):null;

  $('hE').textContent=tot;$('hP').textContent=pC;$('hNN').textContent=nC;$('hD').textContent=dC;

  if(nps===null){$('hN').textContent='-- %';$('hN').style.color='var(--t3)';$('bV').textContent='-- %';$('bV').style.color='var(--t3)';$('bF').style.width='50%';$('bF').style.background='var(--t3)'}
  else{const c=npsC(nps),pct=Math.max(2,Math.min(100,(nps+100)/200*100));$('hN').textContent=nps.toFixed(1)+' %';$('hN').style.color=c;$('bV').textContent=nps.toFixed(1)+'%';$('bV').style.color=c;$('bF').style.width=pct+'%';$('bF').style.background=c}

  $('avh').innerHTML='Ayer: <b>8 enc Â· 37.5%</b> â†’ Hoy: <b>'+tot+' enc Â· '+(nps!==null?nps.toFixed(1)+'%':'--')+'</b>';

  // Thermo
  const th=$('thm');
  if(!tot)th.innerHTML='ğŸ§Š TermÃ³metro: <b>Sin actividad â€” Â¿QuiÃ©n serÃ¡ el primer promotor? ğŸš€</b>';
  else if(nps>=60)th.innerHTML='ğŸ”¥ğŸ”¥ğŸ”¥ <b>Â¡EQUIPO EN LLAMAS!</b>';
  else if(nps>=36.6)th.innerHTML='ğŸ”¥ğŸ”¥ <b>Â¡Sobre la meta! Encendidos</b>';
  else if(nps>=20)th.innerHTML='ğŸ”¥ <b>Buen ritmo, cerquita de la meta</b>';
  else if(nps>=0)th.innerHTML='ğŸŒ¡ï¸ <b>Tibio, hay que empujar</b>';
  else if(nps>=-30)th.innerHTML='ğŸ¥¶ <b>FrÃ­o â€” mÃ¡s promotores</b>';
  else th.innerHTML='â„ï¸ <b>Muy frÃ­o â€” reagrupar</b>';

  updTop(f);updCht();rendRch();rendTbl(f);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TOP REP / EQUIPO
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function updTop(f){
  // Rep
  const br={};f.forEach(e=>{if(!br[e.rid])br[e.rid]={p:0,n:0,d:0,t:0,nm:e.rn};const o=br[e.rid];if(e.t==='P')o.p++;else if(e.t==='N')o.n++;else o.d++;o.t++});
  let bR=null,bRn=-999;Object.values(br).forEach(v=>{const np=(v.p-v.d)/v.t*100;if(np>bRn||(np===bRn&&v.t>(bR?bR.t:0))){bRn=np;bR=v}});
  $('trH').innerHTML=bR?'<div class="tc-r"><b>'+bR.nm+'</b><span>'+bR.t+' enc</span><b style="color:'+npsC(bRn)+'">'+bRn.toFixed(0)+'%</b></div>':'<div class="tc-r" style="color:var(--t3);font-size:8px">Esperando...</div>';
  // Eq
  const be={};f.forEach(e=>{const k=e.lid;if(!be[k])be[k]={p:0,n:0,d:0,t:0,nm:LID.find(l=>l.id===k)?.n||k};const o=be[k];if(e.t==='P')o.p++;else if(e.t==='N')o.n++;else o.d++;o.t++});
  let bE=null,bEn=-999;Object.values(be).forEach(v=>{const np=(v.p-v.d)/v.t*100;if(np>bEn||(np===bEn&&v.t>(bE?bE.t:0))){bEn=np;bE=v}});
  $('teH').innerHTML=bE?'<div class="tc-r"><b>'+bE.nm+'</b><span>'+bE.t+' enc</span><b style="color:'+npsC(bEn)+'">'+bEn.toFixed(0)+'%</b></div>':'<div class="tc-r" style="color:var(--t3);font-size:8px">Esperando...</div>';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RACHAS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function rendRch(){
  const bx=$('rBx');
  let rps=[...REPS];
  if(S.fl!=='all')rps=rps.filter(r=>r.l===S.fl);
  if(S.fr!=='all')rps=rps.filter(r=>r.id===S.fr);
  const act=rps.filter(r=>(S.rch[r.id]||[]).length>0).sort((a,b)=>(S.rch[b.id]||[]).length-(S.rch[a.id]||[]).length);
  $('rC').textContent=act.length;
  if(!act.length){bx.innerHTML='<div class="emt"><div class="emt-e">ğŸš€</div><div class="emt-t">Â¿QuÃ© esperas?</div><div class="emt-s">SÃ© el primer promotor del dÃ­a</div></div>';return}

  let h='';
  act.forEach(rep=>{
    const dots=S.rch[rep.id]||[],sk=cSk(dots),si=skI(sk);
    const pC=dots.filter(x=>x==='P').length,nC=dots.filter(x=>x==='N').length,dC=dots.filter(x=>x==='D').length;
    const sel=S.sel===rep.id;
    h+='<div class="rr'+(sel?' sel':'')+'" onclick="togRep(\''+rep.id+'\')"><div class="rr-av" style="background:'+rep.c+'12;color:'+rep.c+';border:1px solid '+rep.c+'28">'+rep.av+'</div><div class="rr-i"><div class="rr-n">'+rep.n+' <span style="font-size:7px;color:var(--t3)">'+( LID.find(l=>l.id===rep.l)?.n||'')+'</span></div><div class="rr-s">'+dots.length+' enc Â· '+pC+'P '+nC+'N '+dC+'D</div><div class="rr-dots">'+dots.map((dd,i)=>{const dim=S.ft!=='all'&&dd!==S.ft?'opacity:.2;':'';return'<div class="dot '+dd+'" style="'+dim+'">'+dd+'</div>'}).join('')+'</div></div><div class="rr-sk" style="background:'+si.bg+';color:'+si.c+'">'+si.i+' '+sk.c+'</div></div>';
    if(sel){
      const re=S.enc.filter(e=>e.rid===rep.id);
      const fl=S.ft==='all'?re:re.filter(e=>e.t===S.ft);
      const rP=re.filter(e=>e.t==='P').length,rD=re.filter(e=>e.t==='D').length,rN2=re.filter(e=>e.t==='N').length;
      const rNps=re.length?((rP-rD)/re.length*100):0;
      h+='<div class="rdtl"><div class="rdtl-h"><div class="rr-av" style="background:'+rep.c+'12;color:'+rep.c+';border:1px solid '+rep.c+'28;width:32px;height:32px">'+rep.av+'</div><div><div class="rdtl-nm">'+rep.n+'</div><div class="rdtl-st"><span>NPS: <b style="color:'+npsC(rNps)+'">'+rNps.toFixed(1)+'%</b></span><span>Enc: <b>'+re.length+'</b></span><span style="color:var(--g)">P:<b>'+rP+'</b></span><span style="color:var(--y)">N:<b>'+rN2+'</b></span><span style="color:var(--r)">D:<b>'+rD+'</b></span></div></div></div><div class="rdtl-list">';
      if(fl.length){[...fl].reverse().forEach(e=>{const nc=e.t==='P'?'var(--g)':e.t==='N'?'var(--y)':'var(--r)';const nv=e.t==='P'?'100%':e.t==='N'?'0%':'-100%';h+='<div class="rdtl-li"><span style="color:var(--t3);min-width:34px">'+e.ts+'</span><span style="color:var(--t3);min-width:60px">'+e.cid+'</span><span style="flex:1;white-space:nowrap;overflow:hidden;text-overflow:ellipsis">'+e.proc+'</span><span style="font-weight:700;color:'+nc+';min-width:34px;text-align:right">'+nv+'</span></div>'})}
      else h+='<div style="text-align:center;padding:8px;color:var(--t3);font-size:8px">Sin datos con este filtro</div>';
      h+='</div></div>';
    }
  });
  bx.innerHTML=h;
}
function togRep(id){S.sel=S.sel===id?null:id;rendRch()}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TABLE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function rendTbl(f){
  const tb=$('tB');
  if(!f||!f.length){tb.innerHTML='<tr><td colspan="7" style="text-align:center;padding:16px;color:var(--t3)">Sin encuestas</td></tr>';return}
  tb.innerHTML=[...f].reverse().map(e=>{
    const pc=e.t==='P'?'p':e.t==='N'?'n':'d';const nv=e.t==='P'?'100%':e.t==='N'?'0%':'-100%';
    return'<tr><td>feb 11, '+e.ts+'</td><td>'+e.cid+'</td><td>'+(LID.find(l=>l.id===e.lid)?.n||'')+'</td><td><b>'+e.rn+'</b></td><td style="max-width:140px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis">'+e.sol+'</td><td style="max-width:160px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;font-style:italic">"'+e.com+'"</td><td><span class="npil '+pc+'">'+nv+'</span></td></tr>'
  }).join('');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FEED
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function addF(h){const fb=$('fB');if(!S.fOn){fb.innerHTML='';S.fOn=true}fb.insertAdjacentHTML('afterbegin',h);while(fb.children.length>20)fb.removeChild(fb.lastChild)}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TOAST (7s, corner, non-intrusive)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function toast(em,tt,ds){
  const c=$('toasts'),t=document.createElement('div');t.className='tst';
  t.innerHTML='<div class="tst-e">'+em+'</div><div style="flex:1"><div class="tst-tt">ğŸ† Â¡'+tt+'!</div><div class="tst-ds">'+ds+'</div><div class="tst-bar"><div></div></div></div>';
  c.appendChild(t);mConf();
  addF('<div class="fd ach"><div class="fd-h"><span class="fd-ic">'+em+'</span><span class="fd-tp" style="color:var(--p)">Logro</span></div><div class="fd-b"><b>'+tt+'</b> â€” '+ds+'</div></div>');
  setTimeout(()=>t.remove(),7500);
}
function mConf(){const cols=['#4f46e5','#16a34a','#7c3aed','#0891b2','#b45309'];for(let i=0;i<18;i++){const c=document.createElement('div');c.className='conf';c.style.cssText='left:'+(72+Math.random()*26)+'%;background:'+cols[i%5]+';width:'+(Math.random()*5+3)+'px;height:'+(Math.random()*5+3)+'px;border-radius:'+(Math.random()>.5?'50%':'1px')+';animation-duration:'+(Math.random()*1.3+1)+'s;animation-delay:'+(Math.random()*.3)+'s';document.body.appendChild(c);setTimeout(()=>c.remove(),3000)}}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SIMULATORS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function simP(){
  const rep=rnd(REPS),pi=Math.floor(Math.random()*PROC.length),com=rnd(CP),cid=nxC(),ts=nxT();
  S.enc.push({t:'P',rid:rep.id,rn:rep.n,lid:rep.l,proc:PROC[pi],sol:SOL[pi],com,cid,ts,hr:S.hN});
  S.p++;S.rch[rep.id].push('P');flash('g');
  const sk=cSk(S.rch[rep.id]),prev=S.rch[rep.id].length>=2?S.rch[rep.id][S.rch[rep.id].length-2]:null;
  addF('<div class="fd pro"><div class="fd-h"><span class="fd-ic">ğŸŸ¢</span><span class="fd-tp" style="color:var(--g)">Promotor</span><span class="fd-tm">'+ts+' Â· '+cid+'</span></div><div class="fd-b"><b>'+rep.n+'</b> Â· '+PROC[pi]+'<br><em>"'+com+'"</em></div></div>');
  apply();
  if(sk.t==='P'&&sk.c===5)setTimeout(()=>toast('ğŸ’','RACHA PERFECTA',rep.n+' â€” 5 promotores seguidos'),400);
  else if(sk.t==='P'&&prev==='D')setTimeout(()=>toast('ğŸ›¡ï¸','RECUPERACIÃ“N',rep.n+' â€” Promotor despuÃ©s de detractor'),400);
  else if(S.p===1&&S.n===0&&S.d===0)setTimeout(()=>toast('ğŸš€','PRIMER PROMOTOR',rep.n+' â€” Â¡ArrancÃ³ con todo!'),400);
}

function simD(){
  const rep=rnd(REPS),pi=Math.floor(Math.random()*PROC.length),com=rnd(CD),cid=nxC(),ts=nxT();
  S.enc.push({t:'D',rid:rep.id,rn:rep.n,lid:rep.l,proc:PROC[pi],sol:SOL[pi],com,cid,ts,hr:S.hN});
  S.d++;S.rch[rep.id].push('D');flash('r');
  const detC=S.enc.filter(x=>x.rid===rep.id&&x.t==='D').length;
  const ref=REPS.filter(r=>r.id!==rep.id),e1=rnd(ref),e2=rnd(ref.filter(r=>r.id!==e1.id));
  addF('<div class="fd det"><div class="fd-h"><span class="fd-ic">ğŸš¨</span><span class="fd-tp" style="color:var(--r)">Detractor</span><span class="fd-tm">'+ts+' Â· '+cid+'</span></div><div class="fd-b"><b>'+rep.n+'</b> Â· '+PROC[pi]+'<br>Sol: '+SOL[pi]+'<br><em>"'+com+'"</em></div><div class="esp"><div class="esp-t">ğŸ’¡ Casos espejo â€” Promotor en menor tiempo</div><div class="esp-i">âœ… '+(cid-Math.floor(Math.random()*3000)-800)+' Â· <b>'+e1.n+'</b> Â· '+(Math.random()*6+12).toFixed(1)+' min â†’ 100%</div><div class="esp-i">âœ… '+(cid-Math.floor(Math.random()*5000)-1500)+' Â· <b>'+e2.n+'</b> Â· '+(Math.random()*8+13).toFixed(1)+' min â†’ 100%</div></div><div class="pbx"><div class="pbx-t">âš ï¸ Contexto histÃ³rico</div><div style="font:400 8px/1.4 Inter;color:var(--t2)"><b>'+rep.n+'</b> lleva <b>'+detC+'</b> det. en <em>'+PROC[pi].split(' - ')[0]+'</em> este mes. Referente: <b>'+rnd(ref).n+'</b></div></div></div>');
  apply();
}

function simN(){
  const rep=rnd(REPS),pi=Math.floor(Math.random()*PROC.length),com=rnd(CN),cid=nxC(),ts=nxT();
  S.enc.push({t:'N',rid:rep.id,rn:rep.n,lid:rep.l,proc:PROC[pi],sol:SOL[pi],com,cid,ts,hr:S.hN});
  S.n++;S.rch[rep.id].push('N');
  addF('<div class="fd neu"><div class="fd-h"><span class="fd-ic">ğŸŸ¡</span><span class="fd-tp" style="color:var(--y)">Neutro</span><span class="fd-tm">'+ts+' Â· '+cid+'</span></div><div class="fd-b"><b>'+rep.n+'</b> Â· '+PROC[pi]+'<br><em>"'+com+'"</em></div></div>');
  apply();
}

function simPa(){
  const pr=rnd(PROC).split(' - ')[0],sb=rnd(SOL),sg=rnd(SOL);
  const pD=Math.floor(Math.random()*20)+65,pP=Math.floor(Math.random()*18)+60,at=(Math.random()*6+12).toFixed(1),hr=Math.floor(Math.random()*4)+14;
  addF('<div class="fd pat"><div class="fd-h"><span class="fd-ic">ğŸ§ </span><span class="fd-tp" style="color:var(--i)">PatrÃ³n Detectado</span><span class="fd-tm">HistÃ³rico</span></div><div class="fd-b"><b>'+pr+'</b> + <em>"'+sb.substring(0,28)+'..."</em><br>â†’ <b style="color:var(--r)">'+pD+'% detractores</b> este mes</div><div class="pbx"><div class="pbx-t">ğŸ’¡ Alternativa con mejores resultados</div><div style="font:400 8px/1.4 Inter;color:var(--t2)">Con <em>"'+sg.substring(0,28)+'..."</em> â†’ <b style="color:var(--g)">'+pP+'% promotor</b> Â· '+at+' min<br>DespuÃ©s de las '+hr+':00 detractores suben +23%</div></div></div>');
}

function simLg(){const l=rnd(LOGROS),rep=rnd(REPS);toast(l.e,l.t,rep.n+' â€” '+l.d)}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CIERRE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function simCi(t){
  const am=t==='am';
  $('cmTL').textContent=am?'CIERRE TURNO MAÃ‘ANA':'CIERRE TURNO TARDE';
  $('cmHR').textContent=am?'ğŸ“Š 12:25 PM':'ğŸ“Š 6:30 PM';
  WK[TDY]={d:'MiÃ©',e:S.p+S.n+S.d,p:S.p,n:S.n,dd:S.d};
  $('cmWK').innerHTML=WK.map((w,i)=>{
    const today=i===TDY,future=i>TDY,nps=w.e?((w.p-w.dd)/w.e*100):null;
    const c=nps===null?'var(--t3)':npsC(nps);
    return'<div class="cm-d'+(today?' today':'')+(future?' future':'')+'"><div style="font:700 8px Inter;color:var(--t3);margin-bottom:2px">'+w.d+'</div><div style="font:800 16px Inter">'+(future?'--':(w.e||'--'))+'</div><div style="font:600 10px Inter;color:'+c+'">'+(future?'--':nps!==null?nps.toFixed(1)+'%':'--')+'</div></div>'
  }).join('');
  const wt=WK.reduce((a,w)=>({p:a.p+w.p,n:a.n+w.n,d:a.d+w.dd,e:a.e+w.e}),{p:0,n:0,d:0,e:0});
  const wN=wt.e?((wt.p-wt.d)/wt.e*100):null;
  $('cmSN').textContent=wN!==null?wN.toFixed(1)+'%':'--';
  $('cmSN').style.color=wN===null?'var(--t3)':npsC(wN);
  $('cmMG').innerHTML=am?(wN>=36.6?'Â¡Por encima de la meta! ğŸ’ª Pueden caer mÃ¡s encuestas,<br>Â¡el turno maÃ±ana dejÃ³ la vara alta! ğŸ”¥':wN>=15?'Cerquita de la meta ğŸ“ˆ<br>Â¡Esperemos que la tarde ayude a cerrar mejor! ğŸ’ª':'Semana retadora, cada encuesta cuenta ğŸ›¤ï¸<br>Â¡Esperemos cerrar mejor al final del dÃ­a!'):(wN>=36.6?'Â¡Gran cierre! El equipo lo dio todo ğŸ†<br>MaÃ±ana seguimos construyendo. Â¡A descansar! ğŸŒ™':wN>=15?'AsÃ­ cerramos hoy. Pueden caer mÃ¡s encuestas,<br>pero el equipo dio todo. Â¡MaÃ±ana seguimos! ğŸ”¥':'DÃ­a retador, cada dÃ­a es oportunidad nueva ğŸŒ…<br>Â¡MaÃ±ana arrancamos con toda! ğŸ’ª');
  $('cmOv').classList.add('show');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// AUTO-PLAY
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let autoI=null;
function simAuto(){
  if(autoI){clearInterval(autoI);autoI=null;return}
  swT('rt');
  const seq=['P','P','D','P','N','P','P','P','D','N','P','P','D','P','P','N','P','P','P','D'];
  let i=0;
  autoI=setInterval(()=>{
    if(i>=seq.length){clearInterval(autoI);autoI=null;setTimeout(simPa,300);setTimeout(()=>simCi('pm'),1800);return}
    seq[i]==='P'?simP():seq[i]==='D'?simD():simN();i++;
  },600);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// AUTO RESET (midnight)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function autoReset(){
  S={p:0,n:0,d:0,rch:{},enc:[],fOn:false,cN:436200000,hN:8,mN:3,sel:null,ft:'all',fl:'all',fr:'all'};
  REPS.forEach(r=>S.rch[r.id]=[]);WK[TDY]={d:'MiÃ©',e:0,p:0,n:0,dd:0};
  $('fB').innerHTML='<div class="emt" style="padding:16px 6px"><div class="emt-e" style="font-size:24px">ğŸ“¡</div><div class="emt-t" style="font-size:12px">Escuchando...</div><div class="emt-s" style="font-size:9px">Alertas aparecerÃ¡n aquÃ­</div></div>';
  document.querySelectorAll('.fp button').forEach(b=>b.classList.remove('on'));
  document.querySelector('.fp button[data-v="all"]').classList.add('on');
  $('fL').value='all';popR('all');apply();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PRE-POPULATE (20 encuestas al abrir)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function prePop(){
  const data=[
    {t:'P',r:0},{t:'P',r:1},{t:'D',r:2},{t:'P',r:3},{t:'N',r:4},
    {t:'P',r:5},{t:'P',r:0},{t:'D',r:6},{t:'P',r:7},{t:'P',r:1},
    {t:'N',r:8},{t:'P',r:9},{t:'D',r:10},{t:'P',r:11},{t:'P',r:3},
    {t:'P',r:5},{t:'N',r:7},{t:'P',r:0},{t:'D',r:2},{t:'P',r:9}
  ];
  data.forEach(d=>{
    const rep=REPS[d.r],pi=Math.floor(Math.random()*PROC.length);
    const com=d.t==='P'?rnd(CP):d.t==='D'?rnd(CD):rnd(CN);
    const cid=nxC(),ts=nxT();
    S.enc.push({t:d.t,rid:rep.id,rn:rep.n,lid:rep.l,proc:PROC[pi],sol:SOL[pi],com,cid,ts,hr:S.hN});
    if(d.t==='P')S.p++;else if(d.t==='D')S.d++;else S.n++;
    S.rch[rep.id].push(d.t);
  });
  // Feed pre-populated
  S.fOn=true;const fb=$('fB');fb.innerHTML='';
  [...S.enc].reverse().slice(0,10).forEach(e=>{
    const cls=e.t==='P'?'pro':e.t==='D'?'det':'neu';
    const icon=e.t==='P'?'ğŸŸ¢':e.t==='D'?'ğŸš¨':'ğŸŸ¡';
    const lab=e.t==='P'?'Promotor':e.t==='D'?'Detractor':'Neutro';
    const col=e.t==='P'?'var(--g)':e.t==='D'?'var(--r)':'var(--y)';
    let ext='';
    if(e.t==='D'){const ref=REPS.filter(r=>r.id!==e.rid);ext='<div class="esp"><div class="esp-t">ğŸ’¡ Casos espejo</div><div class="esp-i">âœ… '+(e.cid-900)+' Â· <b>'+rnd(ref).n+'</b> Â· '+(Math.random()*5+13).toFixed(1)+' min â†’ 100%</div></div><div class="pbx"><div class="pbx-t">âš ï¸ Contexto</div><div style="font:400 8px/1.3 Inter;color:var(--t2)"><b>'+e.rn+'</b> lleva <b>'+S.enc.filter(x=>x.rid===e.rid&&x.t==='D').length+'</b> det. en <em>'+e.proc.split(' - ')[0]+'</em>. Ref: <b>'+rnd(ref).n+'</b></div></div>'}
    fb.insertAdjacentHTML('beforeend','<div class="fd '+cls+'" style="animation:none"><div class="fd-h"><span class="fd-ic">'+icon+'</span><span class="fd-tp" style="color:'+col+'">'+lab+'</span><span class="fd-tm">'+e.ts+' Â· '+e.cid+'</span></div><div class="fd-b"><b>'+e.rn+'</b> Â· '+e.proc+'<br><em>"'+e.com+'"</em></div>'+ext+'</div>');
  });
}
</script>
</body>
</html>

