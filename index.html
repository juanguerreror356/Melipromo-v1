<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NPS Real Time Engine</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<style>
:root {
  --bg: #f5f6f8;
  --card: #ffffff;
  --brd: #e2e8f0;
  --sh: 0 1px 4px rgba(0,0,0,0.06);
  --t1: #1a1a2e;
  --t2: #64748b;
  --t3: #94a3b8;
  --green: #16a34a;
  --green-bg: #f0fdf4;
  --green-bd: #bbf7d0;
  --yellow: #b45309;
  --yellow-bg: #fffbeb;
  --yellow-bd: #fde68a;
  --red: #dc2626;
  --red-bg: #fef2f2;
  --red-bd: #fecaca;
  --indigo: #4f46e5;
  --indigo-bg: #eef2ff;
  --indigo-bd: #c7d2fe;
  --purple: #7c3aed;
  --cyan: #0891b2;
  --blue: #2D3277;
  --meliY: #FFE600;
}
* { margin:0; padding:0; box-sizing:border-box; }
body { font-family:'Inter',sans-serif; background:var(--bg); color:var(--t1); min-height:100vh; overflow-x:hidden; }
::-webkit-scrollbar{width:5px}::-webkit-scrollbar-thumb{background:#cbd5e1;border-radius:4px}

/* â•â•â•â•â•â• PARTICLES â•â•â•â•â•â• */
#particles { position:fixed; inset:0; pointer-events:none; z-index:0; overflow:hidden; }
.particle { position:absolute; border-radius:50%; opacity:0.12; animation:floatP linear infinite; }
@keyframes floatP {
  0%{transform:translateY(100vh) scale(0);opacity:0}
  10%{opacity:0.12}90%{opacity:0.12}
  100%{transform:translateY(-10vh) scale(1);opacity:0}
}

.app { position:relative; z-index:1; max-width:1440px; margin:0 auto; padding:14px 18px; }

/* â•â•â•â•â•â• HEADER (MeLi style) â•â•â•â•â•â• */
.header {
  display:flex; align-items:center; gap:14px; padding:12px 20px;
  background:var(--blue); border-radius:14px 14px 0 0; color:#fff; flex-wrap:wrap;
}
.header-logo { width:38px; height:38px; border-radius:8px; background:var(--meliY); display:grid; place-items:center; font:900 18px Inter; color:var(--blue); flex-shrink:0; }
.header-titles small { font-size:8px; text-transform:uppercase; letter-spacing:1.5px; opacity:.75; display:block; }
.header-titles b { font-size:14px; }
.header-right { display:flex; gap:6px; margin-left:auto; align-items:center; flex-wrap:wrap; }
.fpills { display:flex; gap:2px; background:rgba(255,255,255,.1); border-radius:7px; padding:2px; }
.fpill { padding:4px 10px; border:none; border-radius:5px; font:600 10px Inter; cursor:pointer; transition:.2s; background:0; color:rgba(255,255,255,.6); }
.fpill:hover { color:#fff; }
.fpill.on { background:rgba(255,255,255,.18); color:#fff; }
.fpill[data-v="P"].on { background:rgba(74,222,128,.3); color:#bbf7d0; }
.fpill[data-v="N"].on { background:rgba(250,204,21,.3); color:#fef08a; }
.fpill[data-v="D"].on { background:rgba(248,113,113,.3); color:#fecaca; }
.hsel { padding:5px 24px 5px 8px; border-radius:6px; background:rgba(255,255,255,.1); border:1px solid rgba(255,255,255,.12); color:#fff; font:600 10px Inter; cursor:pointer; appearance:none; background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='8' height='5'%3E%3Cpath d='M0 0l4 5 4-5z' fill='rgba(255,255,255,.5)'/%3E%3C/svg%3E"); background-repeat:no-repeat; background-position:right 6px center; }
.hsel option { color:var(--t1); background:#fff; }

/* â•â•â•â•â•â• TABS â•â•â•â•â•â• */
.tabs-bar { display:flex; justify-content:center; background:var(--card); border-left:1px solid var(--brd); border-right:1px solid var(--brd); border-bottom:1px solid var(--brd); border-radius:0 0 14px 14px; margin-bottom:10px; }
.tab-btn { padding:10px 24px; font:600 11px Inter; cursor:pointer; color:var(--t3); border-bottom:2px solid transparent; transition:.2s; display:flex; align-items:center; gap:5px; }
.tab-btn:hover { color:var(--t1); }
.tab-btn.on { color:var(--indigo); border-bottom-color:var(--indigo); }
.tab-panel { display:none; }
.tab-panel.on { display:block; }

.disclaimer { text-align:center; font:italic 400 8px Inter; color:var(--t3); margin-bottom:8px; }

/* â•â•â•â•â•â• INFO ROW â•â•â•â•â•â• */
.info-row { display:flex; justify-content:space-between; align-items:center; margin-bottom:8px; flex-wrap:wrap; gap:4px; }
.info-item { font:500 10px Inter; color:var(--t2); }
.info-item b { color:var(--t1); }
.info-chip { background:var(--card); padding:4px 10px; border-radius:6px; border:1px solid var(--brd); box-shadow:var(--sh); }

/* â•â•â•â•â•â• TRIO LAYOUT â•â•â•â•â•â• */
.trio { display:grid; grid-template-columns:250px 1fr 250px; gap:10px; margin-bottom:10px; }
.trio-col { background:var(--card); border:1px solid var(--brd); border-radius:12px; padding:14px; box-shadow:var(--sh); }
.trio-title { font:700 10px Inter; text-transform:uppercase; letter-spacing:.8px; color:var(--t2); margin-bottom:10px; }
.big-val { text-align:center; font:900 32px Inter; line-height:1.1; }
.big-label { text-align:center; font:600 8px Inter; text-transform:uppercase; letter-spacing:1px; color:var(--t3); margin-bottom:2px; }
.pills { display:flex; gap:5px; justify-content:center; margin:8px 0; }
.pill { padding:4px 12px; border-radius:6px; font:800 14px Inter; min-width:38px; text-align:center; }
.pill.p { background:var(--green-bg); color:var(--green); border:1px solid var(--green-bd); }
.pill.n { background:var(--yellow-bg); color:var(--yellow); border:1px solid var(--yellow-bd); }
.pill.d { background:var(--red-bg); color:var(--red); border:1px solid var(--red-bd); }
.top-box { background:#f8fafc; border:1px solid var(--brd); border-radius:7px; padding:8px 10px; margin-top:6px; }
.top-box-t { font:700 7px Inter; text-transform:uppercase; letter-spacing:.8px; color:var(--t3); margin-bottom:4px; }
.top-box-r { display:flex; justify-content:space-between; font:500 10px Inter; color:var(--t2); }
.top-box-r b { color:var(--t1); }
.live-hdr { display:flex; justify-content:space-between; align-items:center; margin-bottom:10px; }
.live-badge { display:inline-flex; align-items:center; gap:5px; padding:3px 8px; border-radius:14px; background:var(--red-bg); border:1px solid var(--red-bd); font:700 8px Inter; color:var(--red); }
.live-dot { width:7px; height:7px; border-radius:50%; background:var(--red); animation:pulse-dot 1.5s ease-in-out infinite; }
@keyframes pulse-dot { 0%,100%{box-shadow:0 0 0 0 rgba(220,38,38,.4)} 50%{box-shadow:0 0 0 5px rgba(220,38,38,0)} }

/* CHART */
.chart-wrap { position:relative; flex:1; min-height:180px; }
.chart-wrap canvas { width:100%!important; height:100%!important; }
.meta-tag { position:absolute; top:2px; right:2px; font:700 7px Inter; color:var(--yellow); background:var(--yellow-bg); padding:2px 5px; border-radius:3px; border:1px solid var(--yellow-bd); }

/* â•â•â•â•â•â• THERMO â•â•â•â•â•â• */
.thermo { display:flex; align-items:center; gap:5px; justify-content:center; padding:6px 12px; border-radius:8px; background:var(--card); border:1px solid var(--brd); font:500 10px Inter; color:var(--t2); margin-bottom:8px; box-shadow:var(--sh); }
.thermo b { color:var(--t1); }

/* â•â•â•â•â•â• STAT CARDS (from V1) â•â•â•â•â•â• */
.stats-row { display:grid; grid-template-columns:repeat(4,1fr); gap:8px; margin-bottom:10px; }
.stat-card { background:var(--card); border:1px solid var(--brd); border-radius:10px; padding:12px; text-align:center; transition:all .3s; box-shadow:var(--sh); }
.stat-card:hover { transform:translateY(-2px); box-shadow:0 4px 12px rgba(0,0,0,.08); }
.stat-card.ga { border-left:3px solid var(--green); }
.stat-card.ya { border-left:3px solid var(--yellow); }
.stat-card.ra { border-left:3px solid var(--red); }
.stat-card.ia { border-left:3px solid var(--indigo); }
.stat-label { font:600 9px Inter; text-transform:uppercase; letter-spacing:.8px; color:var(--t3); margin-bottom:4px; }
.stat-value { font:800 28px Inter; letter-spacing:-1px; line-height:1; transition:transform .3s; }
.stat-value.g { color:var(--green); }
.stat-value.y { color:var(--yellow); }
.stat-value.r { color:var(--red); }
.stat-value.i { color:var(--indigo); }

/* â•â•â•â•â•â• NPS BAR (from V1 with shimmer) â•â•â•â•â•â• */
.nps-section { background:var(--card); border:1px solid var(--brd); border-radius:10px; padding:10px 14px; margin-bottom:8px; box-shadow:var(--sh); }
.nps-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:6px; }
.nps-label { font:600 11px Inter; color:var(--t2); }
.nps-val { font:800 18px Inter; }
.nps-track { height:10px; background:#f1f5f9; border-radius:6px; overflow:hidden; position:relative; }
.nps-fill { height:100%; border-radius:6px; transition:width .8s cubic-bezier(.16,1,.3,1), background .5s; position:relative; }
.nps-fill::after { content:''; position:absolute; inset:0; background:linear-gradient(90deg,transparent,rgba(255,255,255,.3),transparent); animation:shimmer 2s infinite; }
@keyframes shimmer { 0%{transform:translateX(-100%)} 100%{transform:translateX(100%)} }
.nps-meta { position:absolute; top:-4px; bottom:-4px; width:2px; background:var(--yellow); border-radius:2px; z-index:2; }
.nps-meta span { position:absolute; top:-15px; transform:translateX(-50%); font:700 7px Inter; color:var(--yellow); white-space:nowrap; }

/* â•â•â•â•â•â• ACCORDION â•â•â•â•â•â• */
.accordion { background:var(--card); border:1px solid var(--brd); border-radius:10px; margin-bottom:8px; overflow:hidden; box-shadow:var(--sh); }
.acc-header { display:flex; align-items:center; justify-content:space-between; padding:10px 14px; cursor:pointer; user-select:none; }
.acc-header:hover { background:#fafbfc; }
.acc-title { font:700 11px Inter; color:var(--t2); display:flex; align-items:center; gap:6px; }
.acc-badge { font:700 9px Inter; padding:2px 6px; border-radius:4px; background:var(--indigo-bg); color:var(--indigo); }
.acc-arrow { font-size:10px; color:var(--t3); transition:transform .3s; }
.acc-body { max-height:0; overflow:hidden; transition:max-height .4s ease; }
.acc-body.open { max-height:5000px; }
.acc-inner { padding:0 14px 12px; }

/* REP ROW */
.rep-row { display:flex; align-items:center; gap:8px; padding:8px; border-radius:7px; cursor:pointer; transition:.15s; border:1px solid transparent; margin-bottom:2px; }
.rep-row:hover { background:#f8fafc; border-color:var(--brd); }
.rep-row.sel { background:var(--indigo-bg); border-color:var(--indigo-bd); }
.rep-av { width:30px; height:30px; border-radius:7px; display:grid; place-items:center; font:700 10px Inter; flex-shrink:0; }
.rep-info { flex:1; min-width:0; }
.rep-nm { font:600 11px Inter; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
.rep-st { font:400 9px Inter; color:var(--t3); margin-top:1px; }
.rep-dots { display:flex; gap:2px; flex-wrap:wrap; margin-top:2px; }
.dot { width:16px; height:16px; border-radius:4px; font:700 8px Inter; display:grid; place-items:center; animation:dotIn .3s cubic-bezier(.34,1.56,.64,1) backwards; }
@keyframes dotIn { from{transform:scale(0)} to{transform:scale(1)} }
.dot.P { background:var(--green-bg); color:var(--green); border:1px solid var(--green-bd); }
.dot.N { background:var(--yellow-bg); color:var(--yellow); border:1px solid var(--yellow-bd); }
.dot.D { background:var(--red-bg); color:var(--red); border:1px solid var(--red-bd); }
.rep-streak { font:700 9px Inter; padding:2px 7px; border-radius:5px; white-space:nowrap; }

/* REP DETAIL */
.rep-detail { background:#f8fafc; border:1px solid var(--brd); border-radius:8px; margin:4px 0 8px; padding:10px; animation:slideUp .3s ease; }
@keyframes slideUp { from{opacity:0;transform:translateY(-4px)} to{opacity:1;transform:translateY(0)} }
.rep-d-header { display:flex; align-items:center; gap:8px; margin-bottom:6px; }
.rep-d-name { font:700 12px Inter; }
.rep-d-stats { display:flex; gap:8px; font:400 9px Inter; color:var(--t2); }
.rep-d-stats b { color:var(--t1); }
.rep-d-list { max-height:160px; overflow-y:auto; }
.rep-d-item { display:flex; align-items:center; gap:5px; padding:4px 5px; font:400 9px Inter; color:var(--t2); border-bottom:1px solid #f1f5f9; }
.rep-d-item:last-child { border:none; }
.rep-d-item:hover { background:#f1f5f9; }

/* â•â•â•â•â•â• BOTTOM GRID â•â•â•â•â•â• */
.bottom-grid { display:grid; grid-template-columns:1fr 340px; gap:8px; margin-bottom:8px; }

/* TABLE */
.tbl-card { background:var(--card); border:1px solid var(--brd); border-radius:10px; box-shadow:var(--sh); overflow:hidden; }
.tbl-header { padding:10px 14px; font:700 11px Inter; color:var(--t2); }
.tbl-scroll { max-height:240px; overflow-y:auto; }
.tbl { width:100%; border-collapse:collapse; font-size:9px; }
.tbl th { text-align:left; padding:5px 8px; font:700 7px Inter; text-transform:uppercase; letter-spacing:.5px; color:var(--t3); border-bottom:1px solid var(--brd); position:sticky; top:0; background:var(--card); }
.tbl td { padding:4px 8px; border-bottom:1px solid #f8fafc; color:var(--t2); }
.tbl tr:hover td { background:#fafbfc; }
.nps-pill { padding:1px 6px; border-radius:3px; font:700 8px Inter; }
.nps-pill.p { background:var(--green-bg); color:var(--green); }
.nps-pill.n { background:var(--yellow-bg); color:var(--yellow); }
.nps-pill.d { background:var(--red-bg); color:var(--red); }

/* FEED */
.feed-card { background:var(--card); border:1px solid var(--brd); border-radius:10px; box-shadow:var(--sh); overflow:hidden; display:flex; flex-direction:column; }
.feed-header { padding:10px 14px; font:700 11px Inter; color:var(--t2); }
.feed-scroll { flex:1; max-height:240px; overflow-y:auto; padding:0 14px 10px; }
.alert { padding:10px; border-radius:8px; margin-bottom:5px; border:1px solid; animation:alertIn .4s cubic-bezier(.16,1,.3,1); }
@keyframes alertIn { from{transform:translateX(30px);opacity:0} to{transform:translateX(0);opacity:1} }
.alert.pro { background:var(--green-bg); border-color:var(--green-bd); }
.alert.det { background:var(--red-bg); border-color:var(--red-bd); }
.alert.neu { background:var(--yellow-bg); border-color:var(--yellow-bd); }
.alert.pat { background:var(--indigo-bg); border-color:var(--indigo-bd); }
.alert.ach { background:#f5f3ff; border-color:#ddd6fe; }
.alert-h { display:flex; align-items:center; gap:4px; margin-bottom:3px; }
.alert-ic { font-size:13px; }
.alert-tp { font:700 8px Inter; text-transform:uppercase; letter-spacing:.5px; }
.alert-tm { font:400 7px Inter; color:var(--t3); margin-left:auto; }
.alert-b { font:400 9px/1.5 Inter; color:var(--t2); }
.alert-b b { color:var(--t1); }
.espejo { margin-top:5px; padding:6px 8px; border-radius:6px; background:rgba(22,163,74,.03); border:1px solid var(--green-bd); }
.espejo-t { font:700 7px Inter; color:var(--green); text-transform:uppercase; letter-spacing:.5px; margin-bottom:2px; }
.espejo-i { font:400 8px Inter; color:var(--t2); }
.pbox { margin-top:5px; padding:6px 8px; border-radius:6px; background:rgba(79,70,229,.03); border:1px solid var(--indigo-bd); }
.pbox-t { font:700 7px Inter; color:var(--indigo); text-transform:uppercase; letter-spacing:.5px; margin-bottom:2px; }

/* â•â•â•â•â•â• TOAST (non-intrusive logro, 7s) â•â•â•â•â•â• */
.toast-zone { position:fixed; top:12px; right:12px; z-index:1100; display:flex; flex-direction:column; gap:6px; pointer-events:none; }
.toast { pointer-events:auto; display:flex; align-items:center; gap:8px; padding:10px 14px; border-radius:10px; background:var(--card); border:1px solid var(--indigo-bd); box-shadow:0 6px 24px rgba(0,0,0,.1); max-width:310px; animation:tIn .4s ease, tOut .3s ease 6.7s forwards; }
@keyframes tIn { from{transform:translateX(110%);opacity:0} to{transform:translateX(0);opacity:1} }
@keyframes tOut { from{opacity:1;transform:translateX(0)} to{opacity:0;transform:translateX(110%)} }
.toast-emoji { font-size:26px; flex-shrink:0; }
.toast-title { font:800 10px Inter; color:var(--purple); }
.toast-desc { font:400 9px Inter; color:var(--t2); margin-top:1px; }
.toast-bar { height:2px; border-radius:1px; background:#f1f5f9; margin-top:4px; overflow:hidden; }
.toast-bar-fill { height:100%; background:var(--purple); border-radius:1px; animation:barShrink 7s linear forwards; }
@keyframes barShrink { from{width:100%} to{width:0} }

/* â•â•â•â•â•â• CIERRE MODAL â•â•â•â•â•â• */
.cierre-ov { position:fixed; inset:0; z-index:1000; background:rgba(0,0,0,.25); backdrop-filter:blur(3px); display:none; place-items:center; }
.cierre-ov.show { display:grid; }
.cierre-box { width:90%; max-width:520px; padding:26px; border-radius:16px; background:var(--card); border:1px solid var(--brd); box-shadow:0 16px 48px rgba(0,0,0,.1); animation:slideUp .4s ease; }
.cierre-day { text-align:center; padding:8px 4px; border-radius:7px; background:#f8fafc; border:1px solid var(--brd); }
.cierre-day.today { background:var(--indigo-bg); border-color:var(--indigo-bd); }
.cierre-day.future { opacity:.3; }

/* â•â•â•â•â•â• SIM BUTTONS (from V1 with glow) â•â•â•â•â•â• */
.sim-card { background:var(--card); border:1px solid var(--brd); border-radius:12px; padding:16px; margin-bottom:8px; box-shadow:var(--sh); }
.sim-grid { display:grid; grid-template-columns:repeat(4,1fr); gap:8px; }
.sim-btn { padding:12px 8px; border-radius:10px; border:1px solid; font:600 10px Inter; cursor:pointer; transition:all .3s; display:flex; flex-direction:column; align-items:center; gap:4px; text-align:center; }
.sim-btn:hover { transform:translateY(-2px); }
.sim-btn:active { transform:scale(.96); }
.sim-btn.gb { background:var(--green-bg); border-color:var(--green-bd); color:var(--green); }
.sim-btn.gb:hover { box-shadow:0 4px 16px rgba(22,163,74,.2); }
.sim-btn.rb { background:var(--red-bg); border-color:var(--red-bd); color:var(--red); }
.sim-btn.rb:hover { box-shadow:0 4px 16px rgba(220,38,38,.2); }
.sim-btn.yb { background:var(--yellow-bg); border-color:var(--yellow-bd); color:var(--yellow); }
.sim-btn.yb:hover { box-shadow:0 4px 16px rgba(180,83,9,.2); }
.sim-btn.ib { background:var(--indigo-bg); border-color:var(--indigo-bd); color:var(--indigo); }
.sim-btn.ib:hover { box-shadow:0 4px 16px rgba(79,70,229,.2); }
.sim-btn.pb { background:#f5f3ff; border-color:#ddd6fe; color:var(--purple); }
.sim-btn.pb:hover { box-shadow:0 4px 16px rgba(124,58,237,.2); }
.sim-btn-icon { font-size:20px; }

/* EMPTY STATE */
.empty { text-align:center; padding:28px 10px; }
.empty-e { font-size:36px; margin-bottom:6px; animation:bnc 1s ease infinite alternate; }
@keyframes bnc { to{transform:translateY(-5px)} }
.empty-t { font:700 14px Inter; margin-bottom:2px; }
.empty-s { font:400 11px Inter; color:var(--t2); line-height:1.4; }

/* FLASH */
.flash-ov { position:fixed; inset:0; pointer-events:none; z-index:999; opacity:0; transition:opacity .1s; }
.flash-ov.red { background:rgba(220,38,38,.06); }
.flash-ov.green { background:rgba(22,163,74,.04); }
.flash-ov.show { opacity:1; }

/* CONFETTI */
.confetti { position:fixed; z-index:1101; animation:confFall linear forwards; pointer-events:none; }
@keyframes confFall { 0%{transform:translateY(-10vh) rotate(0);opacity:1} 100%{transform:translateY(110vh) rotate(720deg);opacity:0} }

/* FOOTER */
.footer { text-align:center; padding:12px; font:400 8px Inter; color:var(--t3); }

@keyframes shake { 0%,100%{transform:translateX(0)} 15%,45%,75%{transform:translateX(-3px)} 30%,60%,90%{transform:translateX(3px)} }

@media(max-width:1100px) { .trio{grid-template-columns:1fr} .bottom-grid{grid-template-columns:1fr} }
@media(max-width:700px) { .sim-grid{grid-template-columns:repeat(2,1fr)} .stats-row{grid-template-columns:repeat(2,1fr)} .header{flex-wrap:wrap} .header-right{width:100%;justify-content:center} }
</style>
</head>
<body>

<!-- PARTICLES -->
<div id="particles"></div>
<!-- FLASH -->
<div class="flash-ov red" id="flashRed"></div>
<div class="flash-ov green" id="flashGreen"></div>
<!-- TOASTS -->
<div class="toast-zone" id="toastZone"></div>

<!-- CIERRE MODAL -->
<div class="cierre-ov" id="cierreOv">
  <div class="cierre-box">
    <div style="text-align:center;margin-bottom:4px">
      <div id="ciTL" style="font:700 9px Inter;text-transform:uppercase;letter-spacing:2px;color:var(--indigo)"></div>
      <div id="ciHR" style="font:800 20px Inter;margin-top:2px"></div>
    </div>
    <div id="ciWK" style="display:grid;grid-template-columns:repeat(5,1fr);gap:6px;margin:12px 0"></div>
    <div style="text-align:center;padding:12px;border-radius:10px;background:#f8fafc;border:1px solid var(--brd);margin-bottom:10px">
      <div id="ciSN" style="font:800 24px Inter">--</div>
      <div style="font:400 9px Inter;color:var(--t2);margin-top:2px">NPS Semana Â· Meta 36.6%</div>
    </div>
    <div id="ciMG" style="text-align:center;font:italic 400 11px/1.6 Inter;color:var(--t2)"></div>
    <button onclick="document.getElementById('cierreOv').classList.remove('show')" style="display:block;margin:12px auto 0;padding:6px 20px;border-radius:7px;border:1px solid var(--brd);background:#f8fafc;color:var(--t1);font:600 11px Inter;cursor:pointer">Cerrar</button>
  </div>
</div>

<div class="app">

  <!-- HEADER -->
  <div class="header">
    <div class="header-logo">M</div>
    <div class="header-titles"><small>mercado libre</small><b>MATURE PUBLICACIONES</b></div>
    <div class="header-right">
      <div class="fpills">
        <button class="fpill on" data-v="all" onclick="setFT(this,'all')">NPS</button>
        <button class="fpill" data-v="P" onclick="setFT(this,'P')">ğŸŸ¢ Promotor</button>
        <button class="fpill" data-v="N" onclick="setFT(this,'N')">ğŸŸ¡ Neutro</button>
        <button class="fpill" data-v="D" onclick="setFT(this,'D')">ğŸ”´ Detractor</button>
      </div>
      <select class="hsel" id="fL" onchange="setFL(this.value)"><option value="all">LÃ­der Â·</option></select>
      <select class="hsel" id="fR" onchange="setFR(this.value)"><option value="all">Rep Â·</option></select>
    </div>
  </div>

  <!-- TABS -->
  <div class="tabs-bar">
    <div class="tab-btn on" onclick="swTab('rt')" id="tabRT">ğŸ“¡ REAL TIME</div>
    <div class="tab-btn" onclick="swTab('sim')" id="tabSIM">ğŸ® SIMULADOR</div>
  </div>
  <div class="disclaimer">Los datos compartidos son ficticios para demostraciÃ³n. Las fuentes oficiales son las informadas en los bonos.</div>

  <!-- â•â•â•â•â•â• TAB: REAL TIME â•â•â•â•â•â• -->
  <div class="tab-panel on" id="panRT">

    <div class="info-row">
      <div class="info-item">â° <b id="clock">--:--</b></div>
      <div class="info-item info-chip" id="ayerHoy">Ayer: <b>8 enc Â· 37.5%</b> â†’ Hoy: <b>0 enc</b></div>
      <div class="info-item info-chip" id="nextCi">PrÃ³ximo cierre: 12:25 PM</div>
    </div>

    <!-- TRIO -->
    <div class="trio">
      <div class="trio-col">
        <div class="trio-title">RESULTADOS AYER</div>
        <div class="big-label">ENCUESTAS</div><div class="big-val">25</div>
        <div style="height:4px"></div>
        <div class="big-label">LINEAL AYER</div><div class="big-val" style="color:var(--green)">44.0 %</div>
        <div class="pills"><div class="pill p">16</div><div class="pill n">4</div><div class="pill d">5</div></div>
        <div class="top-box"><div class="top-box-t">TOP REPRESENTANTE AYER</div><div class="top-box-r"><b>Valentina RÃ­os</b><span>4 enc</span><b style="color:var(--green)">100%</b></div></div>
        <div class="top-box"><div class="top-box-t">TOP EQUIPO AYER</div><div class="top-box-r"><b>Lnocua</b><span>1 enc</span><b style="color:var(--green)">100%</b></div></div>
      </div>
      <div class="trio-col" style="display:flex;flex-direction:column">
        <div class="trio-title">DESARROLLO DEL DÃA POR HORAS</div>
        <div class="chart-wrap"><canvas id="chartH"></canvas><div class="meta-tag">META 36.6%</div></div>
      </div>
      <div class="trio-col">
        <div class="live-hdr"><div class="trio-title" style="margin:0">NPS REAL TIME</div><div class="live-badge"><div class="live-dot"></div>LIVE</div></div>
        <div class="big-label">ENCUESTAS</div><div class="big-val" id="hoyEnc">0</div>
        <div style="height:4px"></div>
        <div class="big-label">LINEAL HOY</div><div class="big-val" id="hoyNps" style="color:var(--t3)">-- %</div>
        <div class="pills"><div class="pill p" id="hoyP">0</div><div class="pill n" id="hoyN">0</div><div class="pill d" id="hoyD">0</div></div>
        <div class="top-box"><div class="top-box-t">TOP REPRESENTANTE HOY</div><div id="topRH"><div class="top-box-r" style="color:var(--t3);font-size:8px">Esperando...</div></div></div>
        <div class="top-box"><div class="top-box-t">TOP EQUIPO HOY</div><div id="topEH"><div class="top-box-r" style="color:var(--t3);font-size:8px">Esperando...</div></div></div>
      </div>
    </div>

    <!-- STAT CARDS (from V1) -->
    <div class="stats-row">
      <div class="stat-card ga"><div class="stat-label">Promotores</div><div class="stat-value g" id="cntP">0</div></div>
      <div class="stat-card ya"><div class="stat-label">Neutros</div><div class="stat-value y" id="cntN">0</div></div>
      <div class="stat-card ra"><div class="stat-label">Detractores</div><div class="stat-value r" id="cntD">0</div></div>
      <div class="stat-card ia"><div class="stat-label">Encuestas</div><div class="stat-value i" id="cntT">0</div></div>
    </div>

    <!-- THERMO -->
    <div class="thermo" id="thermo">ğŸ§Š TermÃ³metro: <b>Sin actividad â€” Â¿QuiÃ©n serÃ¡ el primer promotor? ğŸš€</b></div>

    <!-- NPS BAR (with shimmer) -->
    <div class="nps-section">
      <div class="nps-header"><span class="nps-label">NPS HOY</span><span class="nps-val" id="barV" style="color:var(--t3)">-- %</span></div>
      <div class="nps-track" style="position:relative"><div class="nps-fill" id="barF" style="width:50%;background:var(--t3)"></div><div class="nps-meta" style="left:68.3%"><span>Meta 36.6%</span></div></div>
    </div>

    <!-- RACHAS ACCORDION -->
    <div class="accordion">
      <div class="acc-header" onclick="togAcc(this)">
        <div class="acc-title">ğŸ”¥ Rachas en Vivo <span class="acc-badge" id="rCnt">0</span></div>
        <div class="acc-arrow">â–¼</div>
      </div>
      <div class="acc-body" id="accBody"><div class="acc-inner" id="rachasBox"><div class="empty"><div class="empty-e">ğŸš€</div><div class="empty-t">Â¿QuÃ© esperas?</div><div class="empty-s">SÃ© el primer promotor del dÃ­a</div></div></div></div>
    </div>

    <!-- TABLE + FEED -->
    <div class="bottom-grid">
      <div class="tbl-card">
        <div class="tbl-header">ğŸ“‹ Encuestas del DÃ­a</div>
        <div class="tbl-scroll"><table class="tbl"><thead><tr><th>Fecha</th><th>Caso</th><th>LÃ­der</th><th>Representante</th><th>SoluciÃ³n</th><th>Comentario</th><th>NPS</th></tr></thead><tbody id="tblBody"><tr><td colspan="7" style="text-align:center;padding:16px;color:var(--t3)">Sin encuestas</td></tr></tbody></table></div>
      </div>
      <div class="feed-card">
        <div class="feed-header">ğŸ“¡ Feed en Tiempo Real</div>
        <div class="feed-scroll" id="feedBox"><div class="empty" style="padding:16px 6px"><div class="empty-e" style="font-size:24px">ğŸ“¡</div><div class="empty-t" style="font-size:12px">Escuchando...</div><div class="empty-s" style="font-size:9px">Alertas aparecerÃ¡n aquÃ­</div></div></div>
      </div>
    </div>
  </div>

  <!-- â•â•â•â•â•â• TAB: SIMULADOR â•â•â•â•â•â• -->
  <div class="tab-panel" id="panSIM">
    <div class="sim-card">
      <div style="font:700 11px Inter;color:var(--t2);margin-bottom:3px">ğŸ® PANEL DE SIMULACIÃ“N</div>
      <p style="font:400 10px Inter;color:var(--t2);margin-bottom:10px">Cada botÃ³n simula un evento en tiempo real. Se refleja en la pestaÃ±a Real Time.</p>
      <div class="sim-grid">
        <button class="sim-btn gb" onclick="simP()"><span class="sim-btn-icon">ğŸŸ¢</span>Llega Promotor</button>
        <button class="sim-btn rb" onclick="simD()"><span class="sim-btn-icon">ğŸ”´</span>Llega Detractor</button>
        <button class="sim-btn yb" onclick="simN()"><span class="sim-btn-icon">ğŸŸ¡</span>Llega Neutro</button>
        <button class="sim-btn ib" onclick="simCierre('am')"><span class="sim-btn-icon">ğŸŒ…</span>Cierre AM 12:25</button>
        <button class="sim-btn ib" onclick="simCierre('pm')"><span class="sim-btn-icon">ğŸŒ‡</span>Cierre PM 6:30</button>
        <button class="sim-btn pb" onclick="simLogro()"><span class="sim-btn-icon">ğŸ†</span>Logro</button>
        <button class="sim-btn pb" onclick="simPatron()"><span class="sim-btn-icon">ğŸ§ </span>Alerta PatrÃ³n</button>
        <button class="sim-btn" style="background:#f8fafc;border-color:var(--brd);color:var(--t2)" onclick="simAuto()"><span class="sim-btn-icon">âš¡</span>Auto-Play</button>
      </div>
    </div>
  </div>

  <div class="footer">hecho por juan sebastian guerrero rodriguez, hecho con el ğŸ’›<br><span style="opacity:.4">NPS Real Time Engine Â· Simulador Demo Â· 2026</span></div>
</div>

<!-- PARTE 2: SCRIPT EN SIGUIENTE MENSAJE -->

  <script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DATA FICTICIA
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const LID=[{id:'lnocua',n:'Lnocua'},{id:'nimoreno',n:'Nimoreno'},{id:'marmendez',n:'Marmendez'},{id:'jpuyo',n:'Jpuyo'},{id:'lflorez',n:'Lflorez'}];
const REPS=[
  {id:'pepitoperez',n:'Pepito PÃ©rez',av:'PP',c:'#4f46e5',l:'marmendez'},
  {id:'mariagarcia',n:'MarÃ­a GarcÃ­a',av:'MG',c:'#16a34a',l:'marmendez'},
  {id:'carlosruiz',n:'Carlos Ruiz',av:'CR',c:'#dc2626',l:'nimoreno'},
  {id:'anamoreno',n:'Ana Moreno',av:'AM',c:'#7c3aed',l:'lnocua'},
  {id:'luisdiaz',n:'Luis DÃ­az',av:'LD',c:'#b45309',l:'jpuyo'},
  {id:'sofialopez',n:'SofÃ­a LÃ³pez',av:'SL',c:'#0891b2',l:'nimoreno'},
  {id:'diegotorres',n:'Diego Torres',av:'DT',c:'#ea580c',l:'lflorez'},
  {id:'valeriacast',n:'Valeria Castro',av:'VC',c:'#059669',l:'jpuyo'},
  {id:'andresrios',n:'AndrÃ©s RÃ­os',av:'AR',c:'#9333ea',l:'lflorez'},
  {id:'camilasan',n:'Camila SÃ¡nchez',av:'CS',c:'#e11d48',l:'marmendez'},
  {id:'julianmart',n:'JuliÃ¡n MartÃ­nez',av:'JM',c:'#0284c7',l:'lnocua'},
  {id:'laurabece',n:'Laura Becerra',av:'LB',c:'#65a30d',l:'jpuyo'}
];
const PROC=['ReputaciÃ³n ME - Reclamo afecta reputaciÃ³n','PR - Propiedad Intelectual','GestiÃ³n PublicaciÃ³n - Modificar variantes','Potenciador - Eventos comerciales T1 T2 T3','Calidad Fotos - Mejorar fotos','Rep ME Ventas: LogÃ­stica Places - Excluimos','Antes de Publicar - CorrecciÃ³n catÃ¡logo','PR TÃ©cnica - Datos tÃ©cnicos','PR Art Prohib - ArtÃ­culos prohibidos','GestiÃ³n Pub - ModeraciÃ³n publicaciÃ³n'];
const SOL=['Analizamos reputaciÃ³n, mantenemos impacto','Denuncia recibida, anÃ¡lisis en curso','Variantes fotos y precio modificados','Beneficios potenciador explicados','Sugerencia correcciÃ³n enviada','LogÃ­stica Places - Excluimos','Fotos actualizadas correctamente','Datos tÃ©cnicos corregidos','ArtÃ­culo restringido, alternativas','PublicaciÃ³n moderada'];
const CP=['Pudieron solucionar mi problema, excelente','Muy buena ayuda, resolvieron rÃ¡pido','La asesora fue muy amable y clara','Me explicaron todo paso a paso','Excelente servicio, minutos resuelto','Me ayudaron perfecto con mi publicaciÃ³n','SÃºper rÃ¡pido y efectivo, gracias'];
const CD=['No me solucionaron el problema','No utilizan criterio ni sentido comÃºn','Speech prearmado, no se salen del texto','No terminÃ³ de ayudarme, me cortÃ³','El vendedor siempre pierde tiempo','Tardaron demasiado, no resolvieron','De asesor en asesor sin soluciÃ³n'];
const CN=['Fue normal, ni bien ni mal','Resolvieron pero tardaron','MÃ¡s o menos, esperaba mejor','AtenciÃ³n regular, proceso largo','No fue mala pero tampoco excelente'];
const LOGROS=[{e:'ğŸ’',t:'RACHA PERFECTA',d:'5 promotores seguidos sin parar'},{e:'ğŸ”¥',t:'EN LLAMAS',d:'3 promotores consecutivos'},{e:'ğŸ›¡ï¸',t:'RECUPERACIÃ“N Ã‰PICA',d:'Promotor despuÃ©s de detractor'},{e:'â­',t:'ESTRELLA DEL DÃA',d:'Mayor NPS con 5+ encuestas'},{e:'ğŸš€',t:'PRIMER PROMOTOR',d:'ArrancÃ³ el dÃ­a con todo'},{e:'ğŸ‘‘',t:'INVICTO',d:'0 detractores en el dÃ­a'}];
const WK=[{d:'Lun',e:14,p:8,n:2,dd:4},{d:'Mar',e:18,p:11,n:3,dd:4},{d:'MiÃ©',e:0,p:0,n:0,dd:0},{d:'Jue',e:0,p:0,n:0,dd:0},{d:'Vie',e:0,p:0,n:0,dd:0}];
const TDY=2;

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let S={p:0,n:0,d:0,rch:{},enc:[],fOn:false,cN:436200000,hN:8,mN:3,sel:null,ft:'all',fl:'all',fr:'all'};
REPS.forEach(r=>S.rch[r.id]=[]);

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// HELPERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const $=id=>document.getElementById(id);
const rnd=a=>a[Math.floor(Math.random()*a.length)];
function nxC(){S.cN+=Math.floor(Math.random()*30)+5;return S.cN}
function nxT(){S.mN+=Math.floor(Math.random()*7)+2;if(S.mN>=60){S.mN-=60;S.hN=Math.min(18,S.hN+1)}return S.hN+':'+String(S.mN).padStart(2,'0')}
function npsCol(v){return v>=36.6?'var(--green)':v>=0?'var(--yellow)':'var(--red)'}
function cSk(d){if(!d.length)return{t:null,c:0};let l=d[d.length-1],c=0;for(let i=d.length-1;i>=0;i--){if(d[i]===l)c++;else break}return{t:l,c}}
function skI(s){if(!s.t)return{i:'',bg:'transparent',c:'var(--t3)'};return{P:{i:'ğŸ”¥',bg:'var(--green-bg)',c:'var(--green)'},N:{i:'ğŸ˜',bg:'var(--yellow-bg)',c:'var(--yellow)'},D:{i:'âš ï¸',bg:'var(--red-bg)',c:'var(--red)'}}[s.t]}
function gf(){return S.enc.filter(e=>{if(S.ft!=='all'&&e.t!==S.ft)return false;if(S.fl!=='all'&&e.lid!==S.fl)return false;if(S.fr!=='all'&&e.rid!==S.fr)return false;return true})}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PARTICLES (from V1)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function initParticles(){
  const c=$('particles');
  const cols=['#4f46e5','#16a34a','#7c3aed','#0891b2','#b45309','#dc2626'];
  for(let i=0;i<25;i++){
    const p=document.createElement('div');p.className='particle';
    const sz=Math.random()*3+1.5;
    p.style.cssText='width:'+sz+'px;height:'+sz+'px;left:'+Math.random()*100+'%;background:'+cols[i%cols.length]+';animation-duration:'+(Math.random()*14+10)+'s;animation-delay:'+(Math.random()*8)+'s;';
    c.appendChild(p);
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FLASH (from V1)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function flash(color){
  const el=$(color==='red'?'flashRed':'flashGreen');
  el.classList.add('show');setTimeout(()=>el.classList.remove('show'),200);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CONFETTI (from V1 â€” big burst)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function launchConfetti(){
  const cols=['#4f46e5','#16a34a','#7c3aed','#0891b2','#b45309','#dc2626','#059669','#e11d48'];
  for(let i=0;i<50;i++){
    const c=document.createElement('div');c.className='confetti';
    c.style.cssText='left:'+Math.random()*100+'%;background:'+cols[Math.floor(Math.random()*cols.length)]+';width:'+(Math.random()*7+4)+'px;height:'+(Math.random()*7+4)+'px;border-radius:'+(Math.random()>.5?'50%':'2px')+';animation-duration:'+(Math.random()*2+1.5)+'s;animation-delay:'+(Math.random()*.5)+'s;';
    document.body.appendChild(c);setTimeout(()=>c.remove(),4000);
  }
}
function miniConfetti(){
  const cols=['#4f46e5','#7c3aed','#0891b2','#16a34a','#b45309'];
  for(let i=0;i<20;i++){
    const c=document.createElement('div');c.className='confetti';
    c.style.cssText='left:'+(72+Math.random()*26)+'%;background:'+cols[i%5]+';width:'+(Math.random()*5+3)+'px;height:'+(Math.random()*5+3)+'px;border-radius:'+(Math.random()>.5?'50%':'1px')+';animation-duration:'+(Math.random()*1.3+1)+'s;animation-delay:'+(Math.random()*.3)+'s;';
    document.body.appendChild(c);setTimeout(()=>c.remove(),3000);
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// COUNT ANIMATION (from V1)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function animCount(id,target){
  const el=$(id);const cur=parseInt(el.textContent)||0;
  if(cur===target)return;
  const step=target>cur?1:-1;let val=cur;
  const iv=setInterval(()=>{val+=step;el.textContent=val;if(val===target)clearInterval(iv)},40);
  el.style.transform='scale(1.15)';el.style.transition='transform .3s';
  setTimeout(()=>{el.style.transform='scale(1)'},300);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
(function(){
  initParticles();
  LID.forEach(l=>{const o=document.createElement('option');o.value=l.id;o.textContent=l.n;$('fL').appendChild(o)});
  popRSel('all');
  updClock();setInterval(updClock,1000);
  initChart();
  prePop();
  apply();
})();

function popRSel(lid){
  const s=$('fR'),r=lid==='all'?REPS:REPS.filter(x=>x.l===lid);
  s.innerHTML='<option value="all">Rep Â·</option>'+r.map(x=>'<option value="'+x.id+'">'+x.n+'</option>').join('');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TABS & FILTERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function swTab(t){
  document.querySelectorAll('.tab-btn').forEach(e=>e.classList.remove('on'));
  document.querySelectorAll('.tab-panel').forEach(e=>e.classList.remove('on'));
  $(t==='rt'?'tabRT':'tabSIM').classList.add('on');
  $(t==='rt'?'panRT':'panSIM').classList.add('on');
}
function setFT(b,v){S.ft=v;document.querySelectorAll('.fpill').forEach(x=>x.classList.remove('on'));b.classList.add('on');apply()}
function setFL(v){S.fl=v;S.fr='all';popRSel(v);apply()}
function setFR(v){S.fr=v;apply()}
function togAcc(el){const b=el.nextElementSibling,a=el.querySelector('.acc-arrow');b.classList.toggle('open');a.style.transform=b.classList.contains('open')?'rotate(180deg)':''}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CLOCK
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function updClock(){
  const now=new Date(),h=now.getHours(),m=now.getMinutes();
  $('clock').textContent=now.toLocaleTimeString('es-CO',{hour:'2-digit',minute:'2-digit',second:'2-digit'});
  $('nextCi').textContent=h<12||(h===12&&m<25)?'PrÃ³ximo cierre: 12:25 PM':h<18||(h===18&&m<30)?'PrÃ³ximo cierre: 6:30 PM':'Cierres completados âœ…';
  if(h===0&&m===0&&now.getSeconds()<2)autoReset();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CHART
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let chart=null;
function initChart(){
  chart=new Chart($('chartH').getContext('2d'),{
    type:'bar',
    data:{labels:['8h','9h','10h','11h','12h','13h','14h','15h','16h','17h','18h'],datasets:[
      {type:'bar',label:'Encuestas',data:Array(11).fill(0),backgroundColor:'rgba(79,70,229,.15)',borderColor:'rgba(79,70,229,.4)',borderWidth:1,borderRadius:3,yAxisID:'y1',order:2},
      {type:'line',label:'NPS %',data:Array(11).fill(null),borderColor:'#16a34a',backgroundColor:'rgba(22,163,74,.05)',borderWidth:2,pointRadius:3,pointBackgroundColor:'#16a34a',fill:true,tension:.3,yAxisID:'y',order:1,spanGaps:true}
    ]},
    options:{responsive:true,maintainAspectRatio:false,interaction:{mode:'index',intersect:false},
      plugins:{legend:{position:'top',labels:{color:'#64748b',font:{size:8,family:'Inter'},boxWidth:8,padding:5}}},
      scales:{
        x:{ticks:{color:'#94a3b8',font:{size:8}},grid:{color:'rgba(0,0,0,.03)'}},
        y:{position:'left',min:-100,max:100,ticks:{color:'#94a3b8',font:{size:8},callback:v=>v+'%'},grid:{color:'rgba(0,0,0,.04)'}},
        y1:{position:'right',min:0,ticks:{color:'#94a3b8',font:{size:8}},grid:{display:false}}
      }}
  });
}
function updChart(){
  if(!chart)return;const f=gf(),hrs={};
  f.forEach(e=>{const h=e.hr;if(!hrs[h])hrs[h]={p:0,n:0,d:0,t:0};if(e.t==='P')hrs[h].p++;else if(e.t==='N')hrs[h].n++;else hrs[h].d++;hrs[h].t++});
  const eD=[],nD=[];
  for(let h=8;h<=18;h++){const x=hrs[h];if(x&&x.t){eD.push(x.t);nD.push((x.p-x.d)/x.t*100)}else{eD.push(0);nD.push(null)}}
  chart.data.datasets[0].data=eD;chart.data.datasets[1].data=nD;chart.update('none');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MAIN APPLY (re-renders everything)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function apply(){
  const f=gf();
  const pC=f.filter(e=>e.t==='P').length,nC=f.filter(e=>e.t==='N').length,dC=f.filter(e=>e.t==='D').length,tot=f.length;
  const nps=tot?((pC-dC)/tot*100):null;

  // Trio HOY
  $('hoyEnc').textContent=tot;$('hoyP').textContent=pC;$('hoyN').textContent=nC;$('hoyD').textContent=dC;
  const hN=$('hoyNps');
  if(nps===null){hN.textContent='-- %';hN.style.color='var(--t3)'}
  else{hN.textContent=nps.toFixed(1)+' %';hN.style.color=npsCol(nps)}

  // Stat cards (animated)
  animCount('cntP',pC);animCount('cntN',nC);animCount('cntD',dC);animCount('cntT',tot);

  // NPS Bar (with shimmer from V1)
  const bV=$('barV'),bF=$('barF');
  if(nps===null){bV.textContent='-- %';bV.style.color='var(--t3)';bF.style.width='50%';bF.style.background='var(--t3)'}
  else{const c=npsCol(nps),pct=Math.max(2,Math.min(100,(nps+100)/200*100));bV.textContent=nps.toFixed(1)+'%';bV.style.color=c;bF.style.width=pct+'%';bF.style.background=c}

  // Ayer vs Hoy
  $('ayerHoy').innerHTML='Ayer: <b>8 enc Â· 37.5%</b> â†’ Hoy: <b>'+tot+' enc Â· '+(nps!==null?nps.toFixed(1)+'%':'--')+'</b>';

  // Thermo
  const th=$('thermo');
  if(!tot)th.innerHTML='ğŸ§Š TermÃ³metro: <b>Sin actividad â€” Â¿QuiÃ©n serÃ¡ el primer promotor? ğŸš€</b>';
  else if(nps>=60)th.innerHTML='ğŸ”¥ğŸ”¥ğŸ”¥ <b>Â¡EQUIPO EN LLAMAS! Rendimiento excepcional</b>';
  else if(nps>=36.6)th.innerHTML='ğŸ”¥ğŸ”¥ <b>Â¡Sobre la meta! Equipo encendido</b>';
  else if(nps>=20)th.innerHTML='ğŸ”¥ <b>Buen ritmo, cerquita de la meta</b>';
  else if(nps>=0)th.innerHTML='ğŸŒ¡ï¸ <b>Tibio, hay que empujar un poco mÃ¡s</b>';
  else if(nps>=-30)th.innerHTML='ğŸ¥¶ <b>FrÃ­o â€” necesitamos mÃ¡s promotores</b>';
  else th.innerHTML='â„ï¸ <b>Muy frÃ­o â€” momento de reagrupar</b>';

  // Tops
  updTopR(f);updTopE(f);
  // Chart
  updChart();
  // Rachas
  rendRachas();
  // Table
  rendTable(f);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TOP REP / EQUIPO
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function updTopR(f){
  const by={};f.forEach(e=>{if(!by[e.rid])by[e.rid]={p:0,n:0,d:0,t:0,nm:e.rn};const o=by[e.rid];if(e.t==='P')o.p++;else if(e.t==='N')o.n++;else o.d++;o.t++});
  let best=null,bn=-999;Object.values(by).forEach(v=>{const np=(v.p-v.d)/v.t*100;if(np>bn||(np===bn&&v.t>(best?best.t:0))){bn=np;best=v}});
  $('topRH').innerHTML=best?'<div class="top-box-r"><b>'+best.nm+'</b><span>'+best.t+' enc</span><b style="color:'+npsCol(bn)+'">'+bn.toFixed(0)+'%</b></div>':'<div class="top-box-r" style="color:var(--t3);font-size:8px">Esperando...</div>';
}
function updTopE(f){
  const by={};f.forEach(e=>{const k=e.lid;if(!by[k])by[k]={p:0,n:0,d:0,t:0,nm:LID.find(l=>l.id===k)?.n||k};const o=by[k];if(e.t==='P')o.p++;else if(e.t==='N')o.n++;else o.d++;o.t++});
  let best=null,bn=-999;Object.values(by).forEach(v=>{const np=(v.p-v.d)/v.t*100;if(np>bn||(np===bn&&v.t>(best?best.t:0))){bn=np;best=v}});
  $('topEH').innerHTML=best?'<div class="top-box-r"><b>'+best.nm+'</b><span>'+best.t+' enc</span><b style="color:'+npsCol(bn)+'">'+bn.toFixed(0)+'%</b></div>':'<div class="top-box-r" style="color:var(--t3);font-size:8px">Esperando...</div>';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RACHAS (accordion + click to detail)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function rendRachas(){
  const bx=$('rachasBox');
  let rps=[...REPS];
  if(S.fl!=='all')rps=rps.filter(r=>r.l===S.fl);
  if(S.fr!=='all')rps=rps.filter(r=>r.id===S.fr);
  const act=rps.filter(r=>(S.rch[r.id]||[]).length>0).sort((a,b)=>(S.rch[b.id]||[]).length-(S.rch[a.id]||[]).length);
  $('rCnt').textContent=act.length;
  if(!act.length){bx.innerHTML='<div class="empty"><div class="empty-e">ğŸš€</div><div class="empty-t">Â¿QuÃ© esperas?</div><div class="empty-s">SÃ© el primer promotor del dÃ­a</div></div>';return}

  let h='';
  act.forEach(rep=>{
    const dots=S.rch[rep.id]||[],sk=cSk(dots),si=skI(sk);
    const pC=dots.filter(x=>x==='P').length,nC=dots.filter(x=>x==='N').length,dC=dots.filter(x=>x==='D').length;
    const sel=S.sel===rep.id;
    h+='<div class="rep-row'+(sel?' sel':'')+'" onclick="togRep(\''+rep.id+'\')"><div class="rep-av" style="background:'+rep.c+'12;color:'+rep.c+';border:1px solid '+rep.c+'28">'+rep.av+'</div><div class="rep-info"><div class="rep-nm">'+rep.n+' <span style="font:400 7px Inter;color:var(--t3)">'+(LID.find(l=>l.id===rep.l)?.n||'')+'</span></div><div class="rep-st">'+dots.length+' enc Â· '+pC+'P '+nC+'N '+dC+'D</div><div class="rep-dots">'+dots.map((dd,i)=>{const dim=S.ft!=='all'&&dd!==S.ft?'opacity:.2;':'';return'<div class="dot '+dd+'" style="animation-delay:'+i*0.04+'s;'+dim+'">'+dd+'</div>'}).join('')+'</div></div><div class="rep-streak" style="background:'+si.bg+';color:'+si.c+'">'+si.i+' '+sk.c+'</div></div>';

    if(sel){
      const re=S.enc.filter(e=>e.rid===rep.id);
      const fl=S.ft==='all'?re:re.filter(e=>e.t===S.ft);
      const rP=re.filter(e=>e.t==='P').length,rD=re.filter(e=>e.t==='D').length,rN2=re.filter(e=>e.t==='N').length;
      const rNps=re.length?((rP-rD)/re.length*100):0;
      h+='<div class="rep-detail"><div class="rep-d-header"><div class="rep-av" style="background:'+rep.c+'12;color:'+rep.c+';border:1px solid '+rep.c+'28;width:34px;height:34px;font-size:12px">'+rep.av+'</div><div><div class="rep-d-name">'+rep.n+'</div><div class="rep-d-stats"><span>NPS: <b style="color:'+npsCol(rNps)+'">'+rNps.toFixed(1)+'%</b></span><span>Enc: <b>'+re.length+'</b></span><span style="color:var(--green)">P:<b>'+rP+'</b></span><span style="color:var(--yellow)">N:<b>'+rN2+'</b></span><span style="color:var(--red)">D:<b>'+rD+'</b></span></div></div></div><div class="rep-d-list">';
      if(fl.length){[...fl].reverse().forEach(e=>{const nc=e.t==='P'?'var(--green)':e.t==='N'?'var(--yellow)':'var(--red)';const nv=e.t==='P'?'100%':e.t==='N'?'0%':'-100%';h+='<div class="rep-d-item"><span style="color:var(--t3);min-width:36px">'+e.ts+'</span><span style="color:var(--t3);min-width:60px">'+e.cid+'</span><span style="flex:1;white-space:nowrap;overflow:hidden;text-overflow:ellipsis">'+e.proc+'</span><span style="font-weight:700;color:'+nc+';min-width:34px;text-align:right">'+nv+'</span></div>'})}
      else h+='<div style="text-align:center;padding:8px;color:var(--t3);font:400 9px Inter">Sin datos con este filtro</div>';
      h+='</div></div>';
    }
  });
  bx.innerHTML=h;
}
function togRep(id){S.sel=S.sel===id?null:id;rendRachas()}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TABLE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function rendTable(f){
  const tb=$('tblBody');
  if(!f||!f.length){tb.innerHTML='<tr><td colspan="7" style="text-align:center;padding:16px;color:var(--t3)">Sin encuestas</td></tr>';return}
  tb.innerHTML=[...f].reverse().map(e=>{
    const pc=e.t==='P'?'p':e.t==='N'?'n':'d';const nv=e.t==='P'?'100%':e.t==='N'?'0%':'-100%';
    return'<tr><td>feb 11, '+e.ts+'</td><td>'+e.cid+'</td><td>'+(LID.find(l=>l.id===e.lid)?.n||'')+'</td><td><b>'+e.rn+'</b></td><td style="max-width:140px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis">'+e.sol+'</td><td style="max-width:160px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;font-style:italic">"'+e.com+'"</td><td><span class="nps-pill '+pc+'">'+nv+'</span></td></tr>'
  }).join('');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FEED
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function addFeed(html){
  const fb=$('feedBox');
  if(!S.fOn){fb.innerHTML='';S.fOn=true}
  fb.insertAdjacentHTML('afterbegin',html);
  while(fb.children.length>20)fb.removeChild(fb.lastChild);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TOAST (7s, corner, non-intrusive)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showToast(emoji,title,desc){
  const c=$('toastZone'),t=document.createElement('div');t.className='toast';
  t.innerHTML='<div class="toast-emoji">'+emoji+'</div><div style="flex:1"><div class="toast-title">ğŸ† Â¡'+title+'!</div><div class="toast-desc">'+desc+'</div><div class="toast-bar"><div class="toast-bar-fill"></div></div></div>';
  c.appendChild(t);miniConfetti();
  addFeed('<div class="alert ach"><div class="alert-h"><span class="alert-ic">'+emoji+'</span><span class="alert-tp" style="color:var(--purple)">Â¡Logro!</span></div><div class="alert-b"><b>'+title+'</b> â€” '+desc+'</div></div>');
  setTimeout(()=>t.remove(),7500);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SIMULATORS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function simP(){
  const rep=rnd(REPS),pi=Math.floor(Math.random()*PROC.length),com=rnd(CP),cid=nxC(),ts=nxT();
  S.enc.push({t:'P',rid:rep.id,rn:rep.n,lid:rep.l,proc:PROC[pi],sol:SOL[pi],com,cid,ts,hr:S.hN});
  S.p++;S.rch[rep.id].push('P');flash('green');
  const sk=cSk(S.rch[rep.id]),prev=S.rch[rep.id].length>=2?S.rch[rep.id][S.rch[rep.id].length-2]:null;
  addFeed('<div class="alert pro"><div class="alert-h"><span class="alert-ic">ğŸŸ¢</span><span class="alert-tp" style="color:var(--green)">Promotor</span><span class="alert-tm">'+ts+' Â· Caso '+cid+'</span></div><div class="alert-b"><b>'+rep.n+'</b> Â· '+PROC[pi]+'<br><em>"'+com+'"</em></div></div>');
  apply();
  if(sk.t==='P'&&sk.c===5)setTimeout(()=>showToast('ğŸ’','RACHA PERFECTA',rep.n+' â€” 5 promotores seguidos sin parar'),500);
  else if(sk.t==='P'&&prev==='D')setTimeout(()=>showToast('ğŸ›¡ï¸','RECUPERACIÃ“N Ã‰PICA',rep.n+' â€” Promotor despuÃ©s de un detractor'),500);
  else if(S.p===1&&S.n===0&&S.d===0)setTimeout(()=>showToast('ğŸš€','PRIMER PROMOTOR',rep.n+' â€” Â¡ArrancÃ³ el dÃ­a con todo!'),500);
}

function simD(){
  const rep=rnd(REPS),pi=Math.floor(Math.random()*PROC.length),com=rnd(CD),cid=nxC(),ts=nxT();
  S.enc.push({t:'D',rid:rep.id,rn:rep.n,lid:rep.l,proc:PROC[pi],sol:SOL[pi],com,cid,ts,hr:S.hN});
  S.d++;S.rch[rep.id].push('D');flash('red');
  // Shake detractor card (from V1)
  const rc=document.querySelectorAll('.stat-card')[2];
  rc.style.animation='none';rc.offsetHeight;rc.style.animation='shake .5s ease';

  const detC=S.enc.filter(x=>x.rid===rep.id&&x.t==='D').length;
  const ref=REPS.filter(r=>r.id!==rep.id),e1=rnd(ref),e2=rnd(ref.filter(r=>r.id!==e1.id));

  addFeed('<div class="alert det"><div class="alert-h"><span class="alert-ic">ğŸš¨</span><span class="alert-tp" style="color:var(--red)">Detractor Detectado</span><span class="alert-tm">'+ts+' Â· Caso '+cid+'</span></div><div class="alert-b"><b>'+rep.n+'</b> Â· '+PROC[pi]+'<br>Sol: '+SOL[pi]+'<br><em>"'+com+'"</em></div><div class="espejo"><div class="espejo-t">ğŸ’¡ Casos espejo â€” Promotor en menor tiempo</div><div class="espejo-i">âœ… Caso '+(cid-Math.floor(Math.random()*3000)-800)+' Â· <b>'+e1.n+'</b> Â· '+(Math.random()*6+12).toFixed(1)+' min â†’ 100%</div><div class="espejo-i">âœ… Caso '+(cid-Math.floor(Math.random()*5000)-1500)+' Â· <b>'+e2.n+'</b> Â· '+(Math.random()*8+13).toFixed(1)+' min â†’ 100%</div></div><div class="pbox"><div class="pbox-t">âš ï¸ Contexto histÃ³rico</div><div style="font:400 8px/1.4 Inter;color:var(--t2)"><b>'+rep.n+'</b> lleva <b>'+detC+'</b> detractor'+(detC>1?'es':'')+' en <em>'+PROC[pi].split(' - ')[0]+'</em> este mes.<br>Referente del equipo: <b>'+rnd(ref).n+'</b></div></div></div>');
  apply();
}

function simN(){
  const rep=rnd(REPS),pi=Math.floor(Math.random()*PROC.length),com=rnd(CN),cid=nxC(),ts=nxT();
  S.enc.push({t:'N',rid:rep.id,rn:rep.n,lid:rep.l,proc:PROC[pi],sol:SOL[pi],com,cid,ts,hr:S.hN});
  S.n++;S.rch[rep.id].push('N');
  addFeed('<div class="alert neu"><div class="alert-h"><span class="alert-ic">ğŸŸ¡</span><span class="alert-tp" style="color:var(--yellow)">Neutro</span><span class="alert-tm">'+ts+' Â· Caso '+cid+'</span></div><div class="alert-b"><b>'+rep.n+'</b> Â· '+PROC[pi]+'<br><em>"'+com+'"</em></div></div>');
  apply();
}

function simPatron(){
  const pr=rnd(PROC).split(' - ')[0],sb=rnd(SOL),sg=rnd(SOL);
  const pD=Math.floor(Math.random()*20)+65,pP=Math.floor(Math.random()*18)+60,at=(Math.random()*6+12).toFixed(1),hr=Math.floor(Math.random()*4)+14;
  addFeed('<div class="alert pat"><div class="alert-h"><span class="alert-ic">ğŸ§ </span><span class="alert-tp" style="color:var(--indigo)">PatrÃ³n Detectado</span><span class="alert-tm">AnÃ¡lisis histÃ³rico</span></div><div class="alert-b"><b>'+pr+'</b> + soluciÃ³n <em>"'+sb.substring(0,35)+'..."</em><br>â†’ <b style="color:var(--red)">'+pD+'% detractores</b> este mes en el equipo</div><div class="pbox"><div class="pbox-t">ğŸ’¡ Alternativa con mejores resultados</div><div style="font:400 8px/1.5 Inter;color:var(--t2)">Con <em>"'+sg.substring(0,35)+'..."</em><br>â†’ <b style="color:var(--green)">'+pP+'% promotor</b> Â· Tiempo promedio: <b>'+at+' min</b><br>ğŸ“Š DespuÃ©s de las <b>'+hr+':00</b> los detractores suben un 23% (fatiga de turno)</div></div></div>');
}

function simLogro(){const l=rnd(LOGROS),rep=rnd(REPS);showToast(l.e,l.t,rep.n+' â€” '+l.d)}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CIERRE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function simCierre(t){
  const am=t==='am';
  $('ciTL').textContent=am?'CIERRE TURNO MAÃ‘ANA':'CIERRE TURNO TARDE';
  $('ciHR').textContent=am?'ğŸ“Š 12:25 PM':'ğŸ“Š 6:30 PM';
  WK[TDY]={d:'MiÃ©',e:S.p+S.n+S.d,p:S.p,n:S.n,dd:S.d};
  $('ciWK').innerHTML=WK.map((w,i)=>{
    const today=i===TDY,future=i>TDY,nps=w.e?((w.p-w.dd)/w.e*100):null;
    const c=nps===null?'var(--t3)':npsCol(nps);
    return'<div class="cierre-day'+(today?' today':'')+(future?' future':'')+'"><div style="font:700 8px Inter;color:var(--t3);margin-bottom:2px">'+w.d+'</div><div style="font:800 16px Inter">'+(future?'--':(w.e||'--'))+'</div><div style="font:600 10px Inter;color:'+c+'">'+(future?'--':nps!==null?nps.toFixed(1)+'%':'--')+'</div></div>'
  }).join('');
  const wt=WK.reduce((a,w)=>({p:a.p+w.p,n:a.n+w.n,d:a.d+w.dd,e:a.e+w.e}),{p:0,n:0,d:0,e:0});
  const wN=wt.e?((wt.p-wt.d)/wt.e*100):null;
  $('ciSN').textContent=wN!==null?wN.toFixed(1)+'%':'--';
  $('ciSN').style.color=wN===null?'var(--t3)':npsCol(wN);
  $('ciMG').innerHTML=am?(wN>=36.6?'Â¡Vamos por encima de la meta! ğŸ’ª Pueden caer mÃ¡s encuestas en la tarde,<br>Â¡pero el equipo de maÃ±ana dejÃ³ la vara alta! ğŸ”¥':wN>=15?'Vamos cerquita de la meta, aÃºn hay camino. ğŸ“ˆ<br>Â¡Esperemos que la tarde nos ayude a cerrar aÃºn mejor! ğŸ’ª':'Semana retadora, cada encuesta cuenta. ğŸ›¤ï¸<br>Â¡Esperemos poder cerrar mejor al final del dÃ­a!'):(wN>=36.6?'Â¡Gran cierre de dÃ­a! El equipo lo dio todo. ğŸ†<br>MaÃ±ana seguimos construyendo sobre esta base. Â¡A descansar! ğŸŒ™':wN>=15?'AsÃ­ cerramos el panorama de hoy. AÃºn pueden caer encuestas,<br>pero el equipo dio todo. Â¡MaÃ±ana seguimos construyendo! ğŸ”¥':'DÃ­a retador, pero cada dÃ­a es una oportunidad nueva. ğŸŒ…<br>MaÃ±ana arrancamos con toda. Â¡El equipo tiene con quÃ©! ğŸ’ª');
  $('cierreOv').classList.add('show');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// AUTO-PLAY
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let autoI=null;
function simAuto(){
  if(autoI){clearInterval(autoI);autoI=null;return}
  swTab('rt');
  const seq=['P','P','D','P','N','P','P','P','D','N','P','P','D','P','P','N','P','P','P','D'];
  let i=0;
  autoI=setInterval(()=>{
    if(i>=seq.length){clearInterval(autoI);autoI=null;setTimeout(simPatron,400);setTimeout(()=>simCierre('pm'),2200);return}
    seq[i]==='P'?simP():seq[i]==='D'?simD():simN();i++;
  },650);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// AUTO RESET (midnight)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function autoReset(){
  S={p:0,n:0,d:0,rch:{},enc:[],fOn:false,cN:436200000,hN:8,mN:3,sel:null,ft:'all',fl:'all',fr:'all'};
  REPS.forEach(r=>S.rch[r.id]=[]);WK[TDY]={d:'MiÃ©',e:0,p:0,n:0,dd:0};
  $('feedBox').innerHTML='<div class="empty" style="padding:16px 6px"><div class="empty-e" style="font-size:24px">ğŸ“¡</div><div class="empty-t" style="font-size:12px">Escuchando...</div><div class="empty-s" style="font-size:9px">Alertas aparecerÃ¡n aquÃ­</div></div>';
  document.querySelectorAll('.fpill').forEach(b=>b.classList.remove('on'));
  document.querySelector('.fpill[data-v="all"]').classList.add('on');
  $('fL').value='all';popRSel('all');apply();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PRE-POPULATE (20 encuestas al abrir)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function prePop(){
  const data=[
    {t:'P',r:0},{t:'P',r:1},{t:'D',r:2},{t:'P',r:3},{t:'N',r:4},
    {t:'P',r:5},{t:'P',r:0},{t:'D',r:6},{t:'P',r:7},{t:'P',r:1},
    {t:'N',r:8},{t:'P',r:9},{t:'D',r:10},{t:'P',r:11},{t:'P',r:3},
    {t:'P',r:5},{t:'N',r:7},{t:'P',r:0},{t:'D',r:2},{t:'P',r:9}
  ];
  data.forEach(d=>{
    const rep=REPS[d.r],pi=Math.floor(Math.random()*PROC.length);
    const com=d.t==='P'?rnd(CP):d.t==='D'?rnd(CD):rnd(CN);
    const cid=nxC(),ts=nxT();
    S.enc.push({t:d.t,rid:rep.id,rn:rep.n,lid:rep.l,proc:PROC[pi],sol:SOL[pi],com,cid,ts,hr:S.hN});
    if(d.t==='P')S.p++;else if(d.t==='D')S.d++;else S.n++;
    S.rch[rep.id].push(d.t);
  });

  // Pre-populate feed
  S.fOn=true;const fb=$('feedBox');fb.innerHTML='';
  [...S.enc].reverse().slice(0,12).forEach(e=>{
    const cls=e.t==='P'?'pro':e.t==='D'?'det':'neu';
    const icon=e.t==='P'?'ğŸŸ¢':e.t==='D'?'ğŸš¨':'ğŸŸ¡';
    const lab=e.t==='P'?'Promotor':e.t==='D'?'Detractor Detectado':'Neutro';
    const col=e.t==='P'?'var(--green)':e.t==='D'?'var(--red)':'var(--yellow)';
    let ext='';
    if(e.t==='D'){
      const ref=REPS.filter(r=>r.id!==e.rid);
      ext='<div class="espejo"><div class="espejo-t">ğŸ’¡ Casos espejo â€” Promotor en menor tiempo</div><div class="espejo-i">âœ… Caso '+(e.cid-900)+' Â· <b>'+rnd(ref).n+'</b> Â· '+(Math.random()*5+13).toFixed(1)+' min â†’ 100%</div><div class="espejo-i">âœ… Caso '+(e.cid-2300)+' Â· <b>'+rnd(ref).n+'</b> Â· '+(Math.random()*7+14).toFixed(1)+' min â†’ 100%</div></div><div class="pbox"><div class="pbox-t">âš ï¸ Contexto histÃ³rico</div><div style="font:400 8px/1.4 Inter;color:var(--t2)"><b>'+e.rn+'</b> lleva <b>'+S.enc.filter(x=>x.rid===e.rid&&x.t==='D').length+'</b> detractores en <em>'+e.proc.split(' - ')[0]+'</em> este mes.<br>Referente: <b>'+rnd(ref).n+'</b></div></div>';
    }
    fb.insertAdjacentHTML('beforeend','<div class="alert '+cls+'" style="animation:none"><div class="alert-h"><span class="alert-ic">'+icon+'</span><span class="alert-tp" style="color:'+col+'">'+lab+'</span><span class="alert-tm">'+e.ts+' Â· Caso '+e.cid+'</span></div><div class="alert-b"><b>'+e.rn+'</b> Â· '+e.proc+'<br><em>"'+e.com+'"</em></div>'+ext+'</div>');
  });
}
</script>
</body>
</html>
