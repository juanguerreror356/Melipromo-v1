<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NPS Real Time Engine</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<style>
:root{
  --bg:#ffffff;--bg2:#f8f9fa;--bg3:#f1f3f5;--bg4:#e9ecef;
  --card:#ffffff;--card-border:#e2e6ea;--card-shadow:0 1px 3px rgba(0,0,0,0.06);
  --t1:#1a1a2e;--t2:#5a5f7a;--t3:#9ca3b4;
  --green:#16a34a;--greenBg:#f0fdf4;--greenBd:#bbf7d0;
  --yellow:#ca8a04;--yellowBg:#fefce8;--yellowBd:#fef08a;
  --red:#dc2626;--redBg:#fef2f2;--redBd:#fecaca;
  --indigo:#4f46e5;--indigoBg:#eef2ff;--indigoBd:#c7d2fe;
  --purple:#7c3aed;--cyan:#0891b2;
  --meli-yellow:#FFE600;--meli-blue:#2D3277;
}
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:'Inter',sans-serif;background:var(--bg2);color:var(--t1);min-height:100vh;}
::-webkit-scrollbar{width:5px;}
::-webkit-scrollbar-thumb{background:#d1d5db;border-radius:4px;}

.app{max-width:1460px;margin:0 auto;padding:14px 18px;}

/* â•â•â• HEADER â•â•â• */
.hdr{display:flex;align-items:center;gap:16px;padding:12px 20px;background:var(--meli-blue);border-radius:14px 14px 0 0;color:#fff;}
.hdr-logo{width:38px;height:38px;border-radius:8px;background:var(--meli-yellow);display:flex;align-items:center;justify-content:center;font-size:18px;font-weight:900;color:var(--meli-blue);}
.hdr-t1{font-size:9px;font-weight:600;text-transform:uppercase;letter-spacing:2px;opacity:0.8;}
.hdr-t2{font-size:15px;font-weight:800;letter-spacing:-0.3px;}
.hdr-filters{display:flex;align-items:center;gap:8px;margin-left:auto;flex-wrap:wrap;}

/* Filter pills */
.fpills{display:flex;gap:2px;background:rgba(255,255,255,0.12);border-radius:8px;padding:3px;}
.fpill{padding:5px 11px;border-radius:6px;border:none;font-family:Inter;font-size:10px;font-weight:600;cursor:pointer;transition:all 0.2s;background:transparent;color:rgba(255,255,255,0.7);}
.fpill:hover{color:#fff;background:rgba(255,255,255,0.1);}
.fpill.on{color:#fff;background:rgba(255,255,255,0.2);}
.fpill[data-v="P"].on{background:rgba(0,200,83,0.3);color:#a7f3d0;}
.fpill[data-v="N"].on{background:rgba(255,214,0,0.3);color:#fef08a;}
.fpill[data-v="D"].on{background:rgba(239,68,68,0.3);color:#fecaca;}

.hdr-sel{padding:6px 28px 6px 10px;border-radius:7px;background:rgba(255,255,255,0.1);border:1px solid rgba(255,255,255,0.15);color:#fff;font-family:Inter;font-size:11px;font-weight:600;cursor:pointer;appearance:none;-webkit-appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='6'%3E%3Cpath d='M0 0l5 6 5-6z' fill='rgba(255,255,255,0.6)'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 8px center;}
.hdr-sel option{color:#1a1a2e;background:#fff;}

/* â•â•â• NAV â•â•â• */
.nav{display:flex;justify-content:center;gap:0;background:var(--card);border-left:1px solid var(--card-border);border-right:1px solid var(--card-border);border-bottom:1px solid var(--card-border);border-radius:0 0 14px 14px;margin-bottom:12px;}
.nav-t{padding:11px 28px;font-size:12px;font-weight:600;cursor:pointer;color:var(--t3);transition:all 0.2s;border-bottom:2px solid transparent;display:flex;align-items:center;gap:5px;}
.nav-t:hover{color:var(--t1);}
.nav-t.on{color:var(--indigo);border-bottom-color:var(--indigo);}
.tab-p{display:none;}.tab-p.on{display:block;}

.disclaimer{text-align:center;font-size:9px;color:var(--t3);margin-bottom:10px;font-style:italic;}

/* â•â•â• INFO ROW â•â•â• */
.info-row{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px;flex-wrap:wrap;gap:6px;}
.clock{font-size:12px;color:var(--t2);display:flex;align-items:center;gap:4px;}
.clock b{color:var(--t1);font-size:13px;}
.info-pill{font-size:10px;color:var(--t2);background:var(--card);padding:5px 12px;border-radius:8px;border:1px solid var(--card-border);box-shadow:var(--card-shadow);}
.info-pill b{color:var(--t1);}

/* â•â•â• TRIO â•â•â• */
.trio{display:grid;grid-template-columns:260px 1fr 260px;gap:12px;margin-bottom:12px;}
.trio-col{background:var(--card);border:1px solid var(--card-border);border-radius:12px;padding:16px;box-shadow:var(--card-shadow);}
.trio-t{font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:1px;color:var(--t2);margin-bottom:12px;}

.enc-big{text-align:center;margin-bottom:6px;}
.enc-big-l{font-size:9px;color:var(--t3);font-weight:600;text-transform:uppercase;letter-spacing:1px;}
.enc-big-v{font-size:34px;font-weight:900;line-height:1.1;color:var(--t1);}
.nps-big{text-align:center;margin-bottom:10px;}
.nps-big-l{font-size:9px;color:var(--t3);font-weight:600;text-transform:uppercase;letter-spacing:1px;}
.nps-big-v{font-size:36px;font-weight:900;line-height:1.1;}
.pills-row{display:flex;gap:6px;justify-content:center;margin-bottom:10px;}
.pill{padding:5px 14px;border-radius:8px;font-size:15px;font-weight:800;min-width:44px;text-align:center;}
.pill.p{background:var(--greenBg);color:var(--green);border:1px solid var(--greenBd);}
.pill.n{background:var(--yellowBg);color:var(--yellow);border:1px solid var(--yellowBd);}
.pill.d{background:var(--redBg);color:var(--red);border:1px solid var(--redBd);}

.tcard{background:var(--bg2);border:1px solid var(--card-border);border-radius:8px;padding:10px 12px;margin-bottom:6px;}
.tcard-t{font-size:8px;font-weight:700;text-transform:uppercase;letter-spacing:1px;color:var(--t3);margin-bottom:6px;}
.tcard-r{display:flex;align-items:center;justify-content:space-between;font-size:10px;color:var(--t2);}
.tcard-n{font-weight:600;color:var(--t1);}
.tcard-nps{font-weight:700;}

.live-hdr{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px;}
.live-badge{display:flex;align-items:center;gap:5px;padding:3px 9px;border-radius:16px;background:var(--redBg);border:1px solid var(--redBd);font-size:9px;font-weight:700;color:var(--red);}
.live-dot{width:7px;height:7px;border-radius:50%;background:var(--red);animation:pd 1.5s ease-in-out infinite;}
@keyframes pd{0%,100%{box-shadow:0 0 0 0 rgba(220,38,38,0.4)}50%{box-shadow:0 0 0 5px rgba(220,38,38,0)}}

.chart-w{position:relative;height:100%;min-height:190px;}
.meta-lbl{position:absolute;top:4px;right:4px;font-size:8px;color:var(--yellow);font-weight:700;background:var(--yellowBg);padding:2px 6px;border-radius:4px;border:1px solid var(--yellowBd);}

/* â•â•â• THERMO â•â•â• */
.thermo{display:flex;align-items:center;gap:6px;justify-content:center;margin-bottom:10px;padding:7px 14px;border-radius:10px;background:var(--card);border:1px solid var(--card-border);font-size:11px;font-weight:500;color:var(--t2);box-shadow:var(--card-shadow);}
.thermo b{color:var(--t1);}

/* â•â•â• NPS BAR â•â•â• */
.nps-bar{margin-bottom:12px;background:var(--card);border:1px solid var(--card-border);border-radius:10px;padding:12px 16px;box-shadow:var(--card-shadow);}
.nps-bar-h{display:flex;justify-content:space-between;align-items:center;margin-bottom:6px;}
.nps-bar-l{font-size:11px;font-weight:600;color:var(--t2);}
.nps-bar-v{font-size:18px;font-weight:800;}
.nps-track{height:10px;background:var(--bg3);border-radius:6px;overflow:hidden;position:relative;}
.nps-fill{height:100%;border-radius:6px;transition:width 0.7s cubic-bezier(0.16,1,0.3,1),background 0.4s;}
.nps-meta{position:absolute;top:-4px;bottom:-4px;width:2px;background:var(--yellow);border-radius:2px;z-index:2;}
.nps-meta span{position:absolute;top:-16px;transform:translateX(-50%);font-size:8px;font-weight:700;color:var(--yellow);white-space:nowrap;}

/* â•â•â• ACCORDION â•â•â• */
.accordion{background:var(--card);border:1px solid var(--card-border);border-radius:12px;margin-bottom:12px;overflow:hidden;box-shadow:var(--card-shadow);}
.acc-hdr{display:flex;align-items:center;justify-content:space-between;padding:12px 16px;cursor:pointer;transition:background 0.2s;user-select:none;}
.acc-hdr:hover{background:var(--bg2);}
.acc-t{font-size:12px;font-weight:700;color:var(--t2);display:flex;align-items:center;gap:8px;}
.acc-badge{font-size:10px;padding:2px 7px;border-radius:5px;background:var(--indigoBg);color:var(--indigo);font-weight:700;}
.acc-arr{font-size:12px;color:var(--t3);transition:transform 0.3s;}
.acc-body{max-height:0;overflow:hidden;transition:max-height 0.4s cubic-bezier(0.16,1,0.3,1);}
.acc-body.open{max-height:3000px;}
.acc-inner{padding:0 16px 14px;}

.rrow{display:flex;align-items:center;gap:10px;padding:9px 10px;border-radius:8px;margin-bottom:3px;cursor:pointer;transition:all 0.2s;border:1px solid transparent;}
.rrow:hover{background:var(--bg2);border-color:var(--card-border);}
.rrow.sel{background:var(--indigoBg);border-color:var(--indigoBd);}
.rav{width:30px;height:30px;border-radius:7px;display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:700;flex-shrink:0;}
.rinf{flex:1;min-width:0;}
.rnm{font-size:11px;font-weight:600;color:var(--t1);}
.rst{font-size:9px;color:var(--t3);margin-top:1px;}
.rdots{display:flex;gap:2px;flex-wrap:wrap;margin-top:3px;}
.rd{width:16px;height:16px;border-radius:4px;font-size:8px;display:flex;align-items:center;justify-content:center;font-weight:700;animation:di 0.3s cubic-bezier(0.34,1.56,0.64,1) backwards;}
@keyframes di{from{transform:scale(0)}to{transform:scale(1)}}
.rd.P{background:var(--greenBg);color:var(--green);border:1px solid var(--greenBd);}
.rd.N{background:var(--yellowBg);color:var(--yellow);border:1px solid var(--yellowBd);}
.rd.D{background:var(--redBg);color:var(--red);border:1px solid var(--redBd);}
.rstrk{font-size:10px;font-weight:700;padding:2px 7px;border-radius:5px;white-space:nowrap;}

/* Rep detail */
.rep-det{background:var(--bg2);border:1px solid var(--card-border);border-radius:10px;margin:6px 0 10px;padding:12px;animation:si 0.3s ease;}
@keyframes si{from{opacity:0;transform:translateY(-6px)}to{opacity:1;transform:translateY(0)}}
.rep-det-h{display:flex;align-items:center;gap:10px;margin-bottom:8px;}
.rep-det-nm{font-size:13px;font-weight:700;}
.rep-det-st{display:flex;gap:10px;font-size:10px;color:var(--t2);}
.rep-det-st b{color:var(--t1);}
.rep-enc-list{max-height:180px;overflow-y:auto;}
.rep-enc-i{display:flex;align-items:center;gap:6px;padding:5px 6px;border-radius:5px;font-size:9px;color:var(--t2);border-bottom:1px solid var(--bg3);}
.rep-enc-i:last-child{border:none;}
.rep-enc-i:hover{background:var(--bg3);}

/* â•â•â• MAIN GRID â•â•â• */
.mgrid{display:grid;grid-template-columns:1fr 340px;gap:12px;margin-bottom:12px;}

/* â•â•â• FEED â•â•â• */
.feed-w{background:var(--card);border:1px solid var(--card-border);border-radius:12px;overflow:hidden;box-shadow:var(--card-shadow);}
.feed-hdr{padding:12px 16px;}
.feed-t{font-size:12px;font-weight:700;color:var(--t2);display:flex;align-items:center;gap:6px;}
.feed-s{max-height:360px;overflow-y:auto;padding:0 16px 12px;}
.fc{padding:10px;border-radius:8px;margin-bottom:5px;border:1px solid;animation:fci 0.4s cubic-bezier(0.16,1,0.3,1);}
@keyframes fci{from{transform:translateX(30px);opacity:0}to{transform:translateX(0);opacity:1}}
.fc.pro{background:var(--greenBg);border-color:var(--greenBd);}
.fc.det{background:var(--redBg);border-color:var(--redBd);}
.fc.neu{background:var(--yellowBg);border-color:var(--yellowBd);}
.fc.pat{background:var(--indigoBg);border-color:var(--indigoBd);}
.fch{display:flex;align-items:center;gap:4px;margin-bottom:3px;}
.fci-i{font-size:13px;}
.fct{font-size:8px;font-weight:700;text-transform:uppercase;letter-spacing:0.6px;}
.fctime{font-size:8px;color:var(--t3);margin-left:auto;}
.fcb{font-size:9px;line-height:1.5;color:var(--t2);}
.fcb b{color:var(--t1);}
.espejo{margin-top:5px;padding:6px 8px;border-radius:6px;background:rgba(22,163,74,0.04);border:1px solid var(--greenBd);}
.espejo-t{font-size:7px;font-weight:700;color:var(--green);text-transform:uppercase;letter-spacing:0.6px;margin-bottom:2px;}
.espejo-i{font-size:8px;color:var(--t2);}
.pbox{margin-top:5px;padding:6px 8px;border-radius:6px;background:rgba(79,70,229,0.04);border:1px solid var(--indigoBd);}
.pbox-t{font-size:7px;font-weight:700;color:var(--indigo);text-transform:uppercase;letter-spacing:0.6px;margin-bottom:2px;}

/* â•â•â• TABLE â•â•â• */
.tbl-w{background:var(--card);border:1px solid var(--card-border);border-radius:12px;overflow:hidden;box-shadow:var(--card-shadow);margin-bottom:12px;}
.tbl-hdr{padding:12px 16px;}
.tbl-t{font-size:12px;font-weight:700;color:var(--t2);}
.tbl-s{max-height:260px;overflow-y:auto;}
.etbl{width:100%;border-collapse:collapse;font-size:10px;}
.etbl th{text-align:left;padding:6px 10px;font-size:8px;font-weight:700;text-transform:uppercase;letter-spacing:0.6px;color:var(--t3);border-bottom:1px solid var(--card-border);position:sticky;top:0;background:var(--card);}
.etbl td{padding:5px 10px;border-bottom:1px solid var(--bg3);color:var(--t2);}
.etbl tr:hover td{background:var(--bg2);}
.npill{padding:2px 7px;border-radius:4px;font-weight:700;font-size:9px;}
.npill.p{background:var(--greenBg);color:var(--green);}
.npill.n{background:var(--yellowBg);color:var(--yellow);}
.npill.d{background:var(--redBg);color:var(--red);}

/* â•â•â• TOAST â•â•â• */
.toast-c{position:fixed;top:14px;right:14px;z-index:1100;display:flex;flex-direction:column;gap:6px;pointer-events:none;}
.toast{pointer-events:auto;display:flex;align-items:center;gap:8px;padding:10px 14px;border-radius:10px;background:var(--card);border:1px solid var(--indigoBd);box-shadow:0 6px 24px rgba(0,0,0,0.1);animation:toastIn 0.4s ease,toastOut 0.3s ease 6.7s forwards;max-width:320px;}
@keyframes toastIn{from{transform:translateX(110%);opacity:0}to{transform:translateX(0);opacity:1}}
@keyframes toastOut{from{opacity:1;transform:translateX(0)}to{opacity:0;transform:translateX(110%)}}
.toast-e{font-size:26px;flex-shrink:0;}
.toast-bd{flex:1;}
.toast-tt{font-size:10px;font-weight:800;color:var(--purple);}
.toast-ds{font-size:9px;color:var(--t2);margin-top:1px;}
.toast-bar{height:2px;border-radius:2px;background:var(--bg3);margin-top:5px;overflow:hidden;}
.toast-bar-f{height:100%;background:var(--purple);border-radius:2px;animation:shrink 7s linear forwards;}
@keyframes shrink{from{width:100%}to{width:0%}}

/* â•â•â• EMPTY â•â•â• */
.empty{text-align:center;padding:36px 14px;}
.empty-e{font-size:40px;margin-bottom:8px;animation:bounce 1s ease infinite alternate;}
@keyframes bounce{from{transform:translateY(0)}to{transform:translateY(-6px)}}
.empty-t{font-size:15px;font-weight:700;color:var(--t1);margin-bottom:3px;}
.empty-s{font-size:11px;color:var(--t2);line-height:1.5;}

/* â•â•â• SIM â•â•â• */
.sim-sec{background:var(--card);border:1px solid var(--card-border);border-radius:12px;padding:16px;margin-bottom:12px;box-shadow:var(--card-shadow);}
.sgrid{display:grid;grid-template-columns:repeat(4,1fr);gap:6px;}
.sbtn{padding:10px 6px;border-radius:8px;border:1px solid;font-family:Inter;font-size:10px;font-weight:600;cursor:pointer;transition:all 0.2s;display:flex;flex-direction:column;align-items:center;gap:3px;}
.sbtn:hover{transform:translateY(-1px);box-shadow:0 3px 10px rgba(0,0,0,0.08);}
.sbtn:active{transform:scale(0.97);}
.sbtn.gb{background:var(--greenBg);border-color:var(--greenBd);color:var(--green);}
.sbtn.rb{background:var(--redBg);border-color:var(--redBd);color:var(--red);}
.sbtn.yb{background:var(--yellowBg);border-color:var(--yellowBd);color:var(--yellow);}
.sbtn.ib{background:var(--indigoBg);border-color:var(--indigoBd);color:var(--indigo);}
.sbtn.pb{background:#f5f3ff;border-color:#ddd6fe;color:var(--purple);}
.sbtn-i{font-size:18px;}

/* â•â•â• CIERRE MODAL â•â•â• */
.ci-ov{position:fixed;inset:0;z-index:1000;background:rgba(0,0,0,0.3);backdrop-filter:blur(4px);display:none;align-items:center;justify-content:center;}
.ci-ov.show{display:flex;}
.ci-box{width:90%;max-width:540px;padding:28px;border-radius:18px;background:var(--card);border:1px solid var(--card-border);box-shadow:0 20px 60px rgba(0,0,0,0.1);animation:si 0.4s ease;}
.ci-day{text-align:center;padding:10px 4px;border-radius:8px;background:var(--bg2);border:1px solid var(--card-border);}
.ci-day.today{background:var(--indigoBg);border-color:var(--indigoBd);}
.ci-day.future{opacity:0.3;}

/* â•â•â• FLASH â•â•â• */
.flash{position:fixed;inset:0;pointer-events:none;z-index:999;opacity:0;transition:opacity 0.1s;}
.flash.r{background:rgba(220,38,38,0.06);}
.flash.g{background:rgba(22,163,74,0.04);}
.flash.show{opacity:1;}

/* â•â•â• CONFETTI â•â•â• */
.confetti{position:fixed;z-index:1101;animation:cf linear forwards;pointer-events:none;}
@keyframes cf{0%{transform:translateY(-10vh) rotate(0);opacity:1}100%{transform:translateY(110vh) rotate(720deg);opacity:0}}

.ftr{text-align:center;padding:14px;font-size:9px;color:var(--t3);}

@media(max-width:1100px){.trio{grid-template-columns:1fr;}.mgrid{grid-template-columns:1fr;}}
@media(max-width:700px){.sgrid{grid-template-columns:repeat(2,1fr);}.hdr{flex-wrap:wrap;}.hdr-filters{width:100%;justify-content:center;}.pills-row{flex-wrap:wrap;}}
</style>
</head>
<body>
<div class="flash r" id="flR"></div>
<div class="flash g" id="flG"></div>
<div class="toast-c" id="toasts"></div>

<!-- CIERRE -->
<div class="ci-ov" id="ciOv">
  <div class="ci-box">
    <div style="text-align:center;margin-bottom:16px;">
      <div id="ciTL" style="font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:2px;color:var(--indigo);margin-bottom:3px;"></div>
      <div id="ciHR" style="font-size:22px;font-weight:800;"></div>
    </div>
    <div id="ciWK" style="display:grid;grid-template-columns:repeat(5,1fr);gap:6px;margin-bottom:16px;"></div>
    <div style="text-align:center;padding:12px;border-radius:10px;background:var(--bg2);border:1px solid var(--card-border);margin-bottom:12px;">
      <div id="ciSN" style="font-size:26px;font-weight:800;">--</div>
      <div style="font-size:9px;color:var(--t2);margin-top:2px;">NPS Semana Â· Meta 36.6%</div>
    </div>
    <div id="ciMG" style="text-align:center;font-size:12px;color:var(--t2);line-height:1.6;font-style:italic;"></div>
    <button onclick="document.getElementById('ciOv').classList.remove('show')" style="display:block;margin:14px auto 0;padding:7px 22px;border-radius:8px;border:1px solid var(--card-border);background:var(--bg2);color:var(--t1);font-weight:600;cursor:pointer;font-size:11px;">Cerrar</button>
  </div>
</div>

<div class="app">
  <!-- HEADER -->
  <div class="hdr">
    <div class="hdr-logo">M</div>
    <div><div class="hdr-t1">mercado libre</div><div class="hdr-t2">MATURE PUBLICACIONES</div></div>
    <div class="hdr-filters">
      <div class="fpills">
        <button class="fpill on" data-v="all" onclick="setFT(this,'all')">NPS</button>
        <button class="fpill" data-v="P" onclick="setFT(this,'P')">ğŸŸ¢ Promotor</button>
        <button class="fpill" data-v="N" onclick="setFT(this,'N')">ğŸŸ¡ Neutro</button>
        <button class="fpill" data-v="D" onclick="setFT(this,'D')">ğŸ”´ Detractor</button>
      </div>
      <select class="hdr-sel" id="fLider" onchange="setFL(this.value)"><option value="all">LÃ­der Â·</option></select>
      <select class="hdr-sel" id="fRep" onchange="setFR(this.value)"><option value="all">Rep Â·</option></select>
    </div>
  </div>

  <!-- NAV -->
  <div class="nav">
    <div class="nav-t on" onclick="swTab('rt')" id="tabRT">ğŸ“¡ REAL TIME</div>
    <div class="nav-t" onclick="swTab('sim')" id="tabSIM">ğŸ® SIMULADOR</div>
  </div>
  <div class="disclaimer">Los datos compartidos son ficticios para demostraciÃ³n. Las fuentes oficiales son las informadas en los bonos.</div>

  <!-- â•â•â• REAL TIME â•â•â• -->
  <div class="tab-p on" id="panelRT">
    <div class="info-row">
      <div class="clock">â° <b id="clockD">--:--</b></div>
      <div class="info-pill" id="ayerVsHoy">Ayer a esta hora: <b>8 enc Â· 37.5%</b> â†’ Hoy: <b>0 enc</b></div>
      <div class="info-pill" id="nextCi">PrÃ³ximo cierre: 12:25 PM</div>
    </div>

    <div class="trio">
      <div class="trio-col">
        <div class="trio-t">RESULTADOS AYER</div>
        <div class="enc-big"><div class="enc-big-l">Encuestas</div><div class="enc-big-v">25</div></div>
        <div class="nps-big"><div class="nps-big-l">Lineal Ayer</div><div class="nps-big-v" style="color:var(--green)">44.0 %</div></div>
        <div class="pills-row"><div class="pill p">16</div><div class="pill n">4</div><div class="pill d">5</div></div>
        <div class="tcard"><div class="tcard-t">TOP REPRESENTANTE AYER</div><div class="tcard-r"><span>REPRESENTANTE</span><span>ENC ğŸ“Š</span><span>NPS ğŸ“ˆ</span></div><div class="tcard-r" style="margin-top:3px"><span class="tcard-n">Valentina RÃ­os</span><span style="color:var(--t2)">4</span><span class="tcard-nps" style="color:var(--green)">100%</span></div></div>
        <div class="tcard"><div class="tcard-t">TOP EQUIPO AYER</div><div class="tcard-r"><span>LÃDER</span><span>ENC ğŸ“Š</span><span>NPS ğŸ“ˆ</span></div><div class="tcard-r" style="margin-top:3px"><span class="tcard-n">Lnocua</span><span style="color:var(--t2)">1</span><span class="tcard-nps" style="color:var(--green)">100%</span></div></div>
      </div>
      <div class="trio-col">
        <div class="trio-t">DESARROLLO DEL DÃA POR HORAS</div>
        <div class="chart-w"><canvas id="chartH"></canvas><div class="meta-lbl">META 36.6%</div></div>
      </div>
      <div class="trio-col">
        <div class="live-hdr"><div class="trio-t" style="margin:0">NPS REAL TIME</div><div class="live-badge"><div class="live-dot"></div>LIVE</div></div>
        <div class="enc-big"><div class="enc-big-l">Encuestas</div><div class="enc-big-v" id="hoyEnc">0</div></div>
        <div class="nps-big"><div class="nps-big-l">Lineal Hoy</div><div class="nps-big-v" id="hoyNps" style="color:var(--t3)">--%</div></div>
        <div class="pills-row"><div class="pill p" id="hoyP">0</div><div class="pill n" id="hoyN">0</div><div class="pill d" id="hoyD">0</div></div>
        <div class="tcard"><div class="tcard-t">TOP REPRESENTANTE HOY</div><div id="topRH"><div class="tcard-r"><span style="color:var(--t3);font-size:9px">Esperando...</span></div></div></div>
        <div class="tcard"><div class="tcard-t">TOP EQUIPO HOY</div><div id="topEH"><div class="tcard-r"><span style="color:var(--t3);font-size:9px">Esperando...</span></div></div></div>
      </div>
    </div>

    <div class="thermo" id="thermo">ğŸ§Š TermÃ³metro: <b>Sin actividad â€” Â¿QuiÃ©n serÃ¡ el primer promotor del dÃ­a? ğŸš€</b></div>

    <div class="nps-bar">
      <div class="nps-bar-h"><span class="nps-bar-l">NPS HOY</span><span class="nps-bar-v" id="barV" style="color:var(--t3)">--%</span></div>
      <div class="nps-track" style="position:relative"><div class="nps-fill" id="barF" style="width:50%;background:var(--t3)"></div><div class="nps-meta" style="left:68.3%"><span>Meta 36.6%</span></div></div>
    </div>

    <div class="accordion">
      <div class="acc-hdr" onclick="togAcc(this)">
        <div class="acc-t">ğŸ”¥ Rachas en Vivo <span class="acc-badge" id="rCnt">0</span></div>
        <div class="acc-arr">â–¼</div>
      </div>
      <div class="acc-body" id="accB"><div class="acc-inner" id="rBox"><div class="empty"><div class="empty-e">ğŸš€</div><div class="empty-t">Â¿QuÃ© esperas?</div><div class="empty-s">SÃ© el primer promotor del dÃ­a</div></div></div></div>
    </div>

    <div class="mgrid">
      <div class="tbl-w">
        <div class="tbl-hdr"><div class="tbl-t">ğŸ“‹ Encuestas del DÃ­a</div></div>
        <div class="tbl-s"><table class="etbl"><thead><tr><th>Fecha</th><th>Caso</th><th>LÃ­der</th><th>Representante</th><th>SoluciÃ³n</th><th>Comentario</th><th>NPS</th></tr></thead><tbody id="tblB"><tr><td colspan="7" style="text-align:center;padding:18px;color:var(--t3)">Sin encuestas</td></tr></tbody></table></div>
      </div>
      <div class="feed-w">
        <div class="feed-hdr"><div class="feed-t">ğŸ“¡ Feed en Tiempo Real</div></div>
        <div class="feed-s" id="feedB"><div class="empty" style="padding:20px 8px"><div class="empty-e" style="font-size:28px">ğŸ“¡</div><div class="empty-t" style="font-size:13px">Escuchando...</div><div class="empty-s" style="font-size:10px">Alertas aparecerÃ¡n aquÃ­</div></div></div>
      </div>
    </div>
  </div>

  <!-- â•â•â• SIMULADOR â•â•â• -->
  <div class="tab-p" id="panelSIM">
    <div class="sim-sec">
      <div style="font-size:11px;font-weight:700;color:var(--t2);margin-bottom:4px;">ğŸ® PANEL DE SIMULACIÃ“N</div>
      <p style="font-size:10px;color:var(--t2);margin-bottom:10px;">Los eventos se reflejan en Real Time. Â¡PruÃ©balos!</p>
      <div class="sgrid">
        <button class="sbtn gb" onclick="simP()"><span class="sbtn-i">ğŸŸ¢</span>Promotor</button>
        <button class="sbtn rb" onclick="simD()"><span class="sbtn-i">ğŸ”´</span>Detractor</button>
        <button class="sbtn yb" onclick="simN()"><span class="sbtn-i">ğŸŸ¡</span>Neutro</button>
        <button class="sbtn ib" onclick="simCi('am')"><span class="sbtn-i">ğŸŒ…</span>Cierre AM</button>
        <button class="sbtn ib" onclick="simCi('pm')"><span class="sbtn-i">ğŸŒ‡</span>Cierre PM</button>
        <button class="sbtn pb" onclick="simLog()"><span class="sbtn-i">ğŸ†</span>Logro</button>
        <button class="sbtn pb" onclick="simPat()"><span class="sbtn-i">ğŸ§ </span>PatrÃ³n</button>
        <button class="sbtn" style="background:var(--bg2);border-color:var(--card-border);color:var(--t2);" onclick="simAuto()"><span class="sbtn-i">âš¡</span>Auto-Play</button>
      </div>
    </div>
  </div>

  <div class="ftr">hecho por juan sebastian guerrero rodriguez, hecho con el ğŸ’›<br><span style="opacity:0.4">NPS Real Time Engine V3 Â· 2026</span></div>
</div>

<!-- PARTE 2 SCRIPT EN SIGUIENTE MENSAJE -->

  <script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DATA
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const LID=[
  {id:'lnocua',n:'Lnocua'},{id:'nimoreno',n:'Nimoreno'},{id:'marmendez',n:'Marmendez'},
  {id:'jpuyo',n:'Jpuyo'},{id:'lflorez',n:'Lflorez'}
];
const REPS=[
  {id:'pepitoperez',n:'Pepito PÃ©rez',av:'PP',c:'#4f46e5',l:'marmendez'},
  {id:'mariagarcia',n:'MarÃ­a GarcÃ­a',av:'MG',c:'#16a34a',l:'marmendez'},
  {id:'carlosruiz',n:'Carlos Ruiz',av:'CR',c:'#dc2626',l:'nimoreno'},
  {id:'anamoreno',n:'Ana Moreno',av:'AM',c:'#7c3aed',l:'lnocua'},
  {id:'luisdiaz',n:'Luis DÃ­az',av:'LD',c:'#ca8a04',l:'jpuyo'},
  {id:'sofialopez',n:'SofÃ­a LÃ³pez',av:'SL',c:'#0891b2',l:'nimoreno'},
  {id:'diegotorres',n:'Diego Torres',av:'DT',c:'#ea580c',l:'lflorez'},
  {id:'valeriacast',n:'Valeria Castro',av:'VC',c:'#059669',l:'jpuyo'},
  {id:'andresrios',n:'AndrÃ©s RÃ­os',av:'AR',c:'#9333ea',l:'lflorez'},
  {id:'camilasan',n:'Camila SÃ¡nchez',av:'CS',c:'#e11d48',l:'marmendez'},
  {id:'julianmart',n:'JuliÃ¡n MartÃ­nez',av:'JM',c:'#0284c7',l:'lnocua'},
  {id:'laurabece',n:'Laura Becerra',av:'LB',c:'#65a30d',l:'jpuyo'}
];
const PROC=['ReputaciÃ³n ME - Reclamo afecta la reputaciÃ³n','PR - Propiedad Intelectual - Denuncia','GestiÃ³n de PublicaciÃ³n - Modificar variantes','Potenciador - Eventos comerciales T1, T2 y T3','Calidad de Fotos - Mejorar fotos','ReputaciÃ³n ME Ventas: LogÃ­stica Places - Excluimos','Antes de Publicar - CorrecciÃ³n catÃ¡logo','PR TÃ©cnica - Datos tÃ©cnicos','PR Art Prohib - ArtÃ­culos prohibidos','GestiÃ³n Pub - ModeraciÃ³n publicaciÃ³n'];
const SOL=['Analizamos reputaciÃ³n y mantenemos impacto','Denuncia recibida - AnÃ¡lisis','Modificar variantes, fotos y precio','Beneficios potenciador explicados','Sugerencia correcciÃ³n enviada','LogÃ­stica Places - Excluimos','Fotos actualizadas','Datos tÃ©cnicos corregidos','ArtÃ­culo restringido - Alternativas','PublicaciÃ³n moderada'];
const CP=['Pudieron solucionar mi problema, excelente','Muy buena ayuda, resolvieron rÃ¡pido','La asesora fue muy amable y clara','Fue buena, todo paso a paso','Excelente servicio, minutos resuelto','Me ayudaron perfecto','SÃºper rÃ¡pido y efectivo'];
const CD=['No me solucionaron el problema','No utilizan criterio ni sentido comÃºn','Speech prearmado, no se salen del texto','No terminÃ³ de ayudarme, me cortÃ³','El vendedor siempre pierde tiempo','Tardaron demasiado, no resolvieron','De asesor en asesor sin soluciÃ³n'];
const CN=['Fue normal, ni bien ni mal','Resolvieron pero tardaron','MÃ¡s o menos, esperaba mejor','AtenciÃ³n regular, proceso largo','No fue mala pero tampoco excelente'];
const LOGROS=[{e:'ğŸ’',t:'RACHA PERFECTA',d:'5 promotores seguidos'},{e:'ğŸ”¥',t:'EN LLAMAS',d:'3 promotores consecutivos'},{e:'ğŸ›¡ï¸',t:'RECUPERACIÃ“N',d:'Promotor despuÃ©s de detractor'},{e:'â­',t:'ESTRELLA DEL DÃA',d:'Mayor NPS con 5+ enc'},{e:'ğŸš€',t:'PRIMER PROMOTOR',d:'Â¡ArrancÃ³ con todo!'},{e:'ğŸ‘‘',t:'INVICTO',d:'0 detractores en el dÃ­a'}];
const WK=[{d:'Lun',e:14,p:8,n:2,dd:4},{d:'Mar',e:18,p:11,n:3,dd:4},{d:'MiÃ©',e:0,p:0,n:0,dd:0},{d:'Jue',e:0,p:0,n:0,dd:0},{d:'Vie',e:0,p:0,n:0,dd:0}];
const TDI=2;

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let S={p:0,n:0,d:0,rachas:{},enc:[],feedOn:false,cN:436200000,hN:8,mN:3,selRep:null,fType:'all',fLid:'all',fRep:'all'};
REPS.forEach(r=>S.rachas[r.id]=[]);

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
(function init(){
  // Selects
  const ls=document.getElementById('fLider');
  LID.forEach(l=>{const o=document.createElement('option');o.value=l.id;o.textContent=l.n;ls.appendChild(o);});
  popRepSel('all');
  // Clock
  updClk();setInterval(updClk,1000);
  // Chart
  initChart();
  // Pre-populate
  prePop();
  apply();
})();

function popRepSel(lid){
  const s=document.getElementById('fRep');
  const r=lid==='all'?REPS:REPS.filter(x=>x.l===lid);
  s.innerHTML='<option value="all">Rep Â·</option>'+r.map(x=>`<option value="${x.id}">${x.n}</option>`).join('');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TABS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function swTab(t){
  document.querySelectorAll('.nav-t').forEach(e=>e.classList.remove('on'));
  document.querySelectorAll('.tab-p').forEach(e=>e.classList.remove('on'));
  document.getElementById(t==='rt'?'tabRT':'tabSIM').classList.add('on');
  document.getElementById(t==='rt'?'panelRT':'panelSIM').classList.add('on');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CLOCK
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function updClk(){
  const now=new Date();
  document.getElementById('clockD').textContent=now.toLocaleTimeString('es-CO',{hour:'2-digit',minute:'2-digit',second:'2-digit'});
  const h=now.getHours(),m=now.getMinutes();
  document.getElementById('nextCi').textContent=h<12||(h===12&&m<25)?'PrÃ³ximo cierre: 12:25 PM':h<18||(h===18&&m<30)?'PrÃ³ximo cierre: 6:30 PM':'Cierres completados âœ…';
  if(h===0&&m===0&&now.getSeconds()<2)autoReset();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FILTERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function setFT(btn,v){S.fType=v;document.querySelectorAll('.fpill').forEach(b=>b.classList.remove('on'));btn.classList.add('on');apply();}
function setFL(v){S.fLid=v;S.fRep='all';popRepSel(v);apply();}
function setFR(v){S.fRep=v;apply();}
function gf(){return S.enc.filter(e=>{if(S.fType!=='all'&&e.t!==S.fType)return false;if(S.fLid!=='all'&&e.lid!==S.fLid)return false;if(S.fRep!=='all'&&e.rid!==S.fRep)return false;return true;});}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ACCORDION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function togAcc(el){
  const b=el.nextElementSibling;
  const a=el.querySelector('.acc-arr');
  b.classList.toggle('open');
  a.style.transform=b.classList.contains('open')?'rotate(180deg)':'';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// APPLY (main re-render)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function apply(){
  const f=gf();
  const pC=f.filter(e=>e.t==='P').length;
  const nC=f.filter(e=>e.t==='N').length;
  const dC=f.filter(e=>e.t==='D').length;
  const tot=f.length;
  const nps=tot>0?((pC-dC)/tot*100):null;

  // Hoy
  document.getElementById('hoyEnc').textContent=tot;
  document.getElementById('hoyP').textContent=pC;
  document.getElementById('hoyN').textContent=nC;
  document.getElementById('hoyD').textContent=dC;

  const hN=document.getElementById('hoyNps');
  const bV=document.getElementById('barV');
  const bF=document.getElementById('barF');

  if(nps===null){
    hN.textContent='--%';hN.style.color='var(--t3)';
    bV.textContent='--%';bV.style.color='var(--t3)';
    bF.style.width='50%';bF.style.background='var(--t3)';
  } else {
    const c=nps>=36.6?'var(--green)':nps>=0?'var(--yellow)':'var(--red)';
    const pct=Math.max(2,Math.min(100,(nps+100)/200*100));
    hN.textContent=nps.toFixed(1)+' %';hN.style.color=c;
    bV.textContent=nps.toFixed(1)+'%';bV.style.color=c;
    bF.style.width=pct+'%';bF.style.background=c;
  }

  document.getElementById('ayerVsHoy').innerHTML=`Ayer a esta hora: <b>8 enc Â· 37.5%</b> â†’ Hoy: <b>${tot} enc Â· ${nps!==null?nps.toFixed(1)+'%':'--%'}</b>`;

  updThermo(tot,nps);
  updTopR(f);
  updTopE(f);
  rendTable(f);
  updChart();
  rendRachas();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// THERMO
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function updThermo(tot,nps){
  const el=document.getElementById('thermo');
  if(!tot){el.innerHTML='ğŸ§Š TermÃ³metro: <b>Sin actividad â€” Â¿QuiÃ©n serÃ¡ el primer promotor del dÃ­a? ğŸš€</b>';return;}
  let i,t;
  if(nps>=60){i='ğŸ”¥ğŸ”¥ğŸ”¥';t='Â¡EQUIPO EN LLAMAS!';}
  else if(nps>=36.6){i='ğŸ”¥ğŸ”¥';t='Â¡Sobre la meta! Encendidos';}
  else if(nps>=20){i='ğŸ”¥';t='Buen ritmo, cerquita de la meta';}
  else if(nps>=0){i='ğŸŒ¡ï¸';t='Tibio, hay que empujar';}
  else if(nps>=-30){i='ğŸ¥¶';t='FrÃ­o â€” mÃ¡s promotores';}
  else{i='â„ï¸';t='Muy frÃ­o â€” reagrupar';}
  el.innerHTML=`${i} TermÃ³metro: <b>${t}</b>`;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TOP REP / EQUIPO
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function updTopR(f){
  const by={};f.forEach(e=>{if(!by[e.rid])by[e.rid]={p:0,n:0,d:0,t:0,nm:e.rn};const o=by[e.rid];if(e.t==='P')o.p++;else if(e.t==='N')o.n++;else o.d++;o.t++;});
  let best=null,bn=-999;
  Object.values(by).forEach(v=>{const np=(v.p-v.d)/v.t*100;if(np>bn||(np===bn&&v.t>(best?best.t:0))){bn=np;best=v;}});
  const el=document.getElementById('topRH');
  if(!best){el.innerHTML='<div class="tcard-r"><span style="color:var(--t3);font-size:9px">Esperando...</span></div>';return;}
  const c=bn>=36.6?'var(--green)':bn>=0?'var(--yellow)':'var(--red)';
  el.innerHTML=`<div class="tcard-r"><span>REPRESENTANTE</span><span>ENC ğŸ“Š</span><span>NPS ğŸ“ˆ</span></div><div class="tcard-r" style="margin-top:3px"><span class="tcard-n">${best.nm}</span><span style="color:var(--t2)">${best.t}</span><span class="tcard-nps" style="color:${c}">${bn.toFixed(0)}%</span></div>`;
}
function updTopE(f){
  const by={};f.forEach(e=>{const k=e.lid;if(!by[k])by[k]={p:0,n:0,d:0,t:0,nm:LID.find(l=>l.id===k)?.n||k};const o=by[k];if(e.t==='P')o.p++;else if(e.t==='N')o.n++;else o.d++;o.t++;});
  let best=null,bn=-999;
  Object.values(by).forEach(v=>{const np=(v.p-v.d)/v.t*100;if(np>bn||(np===bn&&v.t>(best?best.t:0))){bn=np;best=v;}});
  const el=document.getElementById('topEH');
  if(!best){el.innerHTML='<div class="tcard-r"><span style="color:var(--t3);font-size:9px">Esperando...</span></div>';return;}
  const c=bn>=36.6?'var(--green)':bn>=0?'var(--yellow)':'var(--red)';
  el.innerHTML=`<div class="tcard-r"><span>LÃDER</span><span>ENC ğŸ“Š</span><span>NPS ğŸ“ˆ</span></div><div class="tcard-r" style="margin-top:3px"><span class="tcard-n">${best.nm}</span><span style="color:var(--t2)">${best.t}</span><span class="tcard-nps" style="color:${c}">${bn.toFixed(0)}%</span></div>`;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CHART
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let chart=null;
function initChart(){
  const ctx=document.getElementById('chartH').getContext('2d');
  chart=new Chart(ctx,{
    type:'bar',
    data:{
      labels:['8h','9h','10h','11h','12h','13h','14h','15h','16h','17h','18h'],
      datasets:[
        {type:'bar',label:'Encuestas',data:Array(11).fill(0),backgroundColor:'rgba(79,70,229,0.15)',borderColor:'rgba(79,70,229,0.4)',borderWidth:1,borderRadius:3,yAxisID:'y1',order:2},
        {type:'line',label:'NPS',data:Array(11).fill(null),borderColor:'#16a34a',backgroundColor:'rgba(22,163,74,0.06)',borderWidth:2,pointRadius:4,pointBackgroundColor:'#16a34a',fill:true,tension:0.3,yAxisID:'y',order:1,spanGaps:true}
      ]
    },
    options:{
      responsive:true,maintainAspectRatio:false,
      interaction:{mode:'index',intersect:false},
      plugins:{legend:{display:true,position:'top',labels:{color:'#5a5f7a',font:{size:9,family:'Inter'},boxWidth:10,padding:6}}},
      scales:{
        x:{ticks:{color:'#9ca3b4',font:{size:9}},grid:{color:'rgba(0,0,0,0.04)'}},
        y:{position:'left',min:-100,max:100,ticks:{color:'#9ca3b4',font:{size:9},callback:v=>v+'%'},grid:{color:'rgba(0,0,0,0.04)'}},
        y1:{position:'right',min:0,ticks:{color:'#9ca3b4',font:{size:9}},grid:{display:false}}
      }
    }
  });
}
function updChart(){
  if(!chart)return;
  const f=gf();const hrs={};
  f.forEach(e=>{const h=e.hr;if(!hrs[h])hrs[h]={p:0,n:0,d:0,t:0};if(e.t==='P')hrs[h].p++;else if(e.t==='N')hrs[h].n++;else hrs[h].d++;hrs[h].t++;});
  const eD=[],nD=[];
  for(let h=8;h<=18;h++){if(hrs[h]&&hrs[h].t>0){eD.push(hrs[h].t);nD.push((hrs[h].p-hrs[h].d)/hrs[h].t*100);}else{eD.push(0);nD.push(null);}}
  chart.data.datasets[0].data=eD;
  chart.data.datasets[1].data=nD;
  chart.update('none');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RACHAS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function rendRachas(){
  const box=document.getElementById('rBox');
  let reps=[...REPS];
  if(S.fLid!=='all')reps=reps.filter(r=>r.l===S.fLid);
  if(S.fRep!=='all')reps=reps.filter(r=>r.id===S.fRep);
  const active=reps.filter(r=>(S.rachas[r.id]||[]).length>0).sort((a,b)=>(S.rachas[b.id]||[]).length-(S.rachas[a.id]||[]).length);

  document.getElementById('rCnt').textContent=active.length;
  if(!active.length){box.innerHTML='<div class="empty"><div class="empty-e">ğŸš€</div><div class="empty-t">Â¿QuÃ© esperas?</div><div class="empty-s">SÃ© el primer promotor del dÃ­a</div></div>';return;}

  let html='';
  active.forEach(rep=>{
    const dots=S.rachas[rep.id]||[];
    const sk=calcSk(dots);const si=skI(sk);
    const pC=dots.filter(x=>x==='P').length,nC=dots.filter(x=>x==='N').length,dC=dots.filter(x=>x==='D').length;
    const sel=S.selRep===rep.id;

    html+=`<div class="rrow ${sel?'sel':''}" onclick="togRep('${rep.id}')">
      <div class="rav" style="background:${rep.c}14;color:${rep.c};border:1px solid ${rep.c}30">${rep.av}</div>
      <div class="rinf">
        <div class="rnm">${rep.n} <span style="font-size:8px;color:var(--t3);font-weight:400">${LID.find(l=>l.id===rep.l)?.n||''}</span></div>
        <div class="rst">${dots.length} enc Â· ${pC}P ${nC}N ${dC}D</div>
        <div class="rdots">${dots.map((dd,i)=>{const dim=S.fType!=='all'&&dd!==S.fType?'opacity:0.2;':'';return`<div class="rd ${dd}" style="animation-delay:${i*0.03}s;${dim}">${dd}</div>`;}).join('')}</div>
      </div>
      <div class="rstrk" style="background:${si.bg};color:${si.c}">${si.i} ${sk.count}</div>
    </div>`;

    if(sel){
      const re=S.enc.filter(e=>e.rid===rep.id);
      const filtered=S.fType==='all'?re:re.filter(e=>e.t===S.fType);
      const rP=re.filter(e=>e.t==='P').length,rN=re.filter(e=>e.t==='N').length,rD=re.filter(e=>e.t==='D').length;
      const rNps=re.length>0?((rP-rD)/re.length*100):0;
      const rC=rNps>=36.6?'var(--green)':rNps>=0?'var(--yellow)':'var(--red)';

      html+=`<div class="rep-det">
        <div class="rep-det-h">
          <div class="rav" style="background:${rep.c}14;color:${rep.c};border:1px solid ${rep.c}30;width:34px;height:34px;font-size:13px;">${rep.av}</div>
          <div><div class="rep-det-nm">${rep.n}</div>
          <div class="rep-det-st"><span>NPS: <b style="color:${rC}">${rNps.toFixed(1)}%</b></span><span>Enc: <b>${re.length}</b></span><span style="color:var(--green)">P:<b>${rP}</b></span><span style="color:var(--yellow)">N:<b>${rN}</b></span><span style="color:var(--red)">D:<b>${rD}</b></span></div></div>
        </div>
        <div class="rep-enc-list">${filtered.length?[...filtered].reverse().map(e=>{
          const nc=e.t==='P'?'var(--green)':e.t==='N'?'var(--yellow)':'var(--red)';
          const nv=e.t==='P'?'100%':e.t==='N'?'0%':'-100%';
          return`<div class="rep-enc-i"><span style="color:var(--t3);min-width:36px">${e.ts}</span><span style="color:var(--t3);min-width:66px">Caso ${e.cid}</span><span style="flex:1;white-space:nowrap;overflow:hidden;text-overflow:ellipsis">${e.proc}</span><span style="font-weight:700;color:${nc};min-width:36px;text-align:right">${nv}</span></div>`;
        }).join(''):'<div style="text-align:center;padding:10px;color:var(--t3);font-size:9px">Sin encuestas con este filtro</div>'}</div>
      </div>`;
    }
  });
  box.innerHTML=html;
}

function togRep(id){S.selRep=S.selRep===id?null:id;rendRachas();}
function calcSk(d){if(!d.length)return{type:null,count:0};let l=d[d.length-1],c=0;for(let i=d.length-1;i>=0;i--){if(d[i]===l)c++;else break;}return{type:l,count:c};}
function skI(s){if(!s.type)return{i:'',bg:'transparent',c:'var(--t3)'};return{P:{i:'ğŸ”¥',bg:'var(--greenBg)',c:'var(--green)'},N:{i:'ğŸ˜',bg:'var(--yellowBg)',c:'var(--yellow)'},D:{i:'âš ï¸',bg:'var(--redBg)',c:'var(--red)'}}[s.type];}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TABLE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function rendTable(f){
  const tb=document.getElementById('tblB');
  if(!f||!f.length){tb.innerHTML='<tr><td colspan="7" style="text-align:center;padding:18px;color:var(--t3)">Sin encuestas</td></tr>';return;}
  tb.innerHTML=[...f].reverse().map(e=>{
    const pc=e.t==='P'?'p':e.t==='N'?'n':'d';
    const nv=e.t==='P'?'100%':e.t==='N'?'0%':'-100%';
    return`<tr><td>feb 11, ${e.ts}a.m.</td><td>${e.cid}</td><td>${LID.find(l=>l.id===e.lid)?.n||e.lid}</td><td><b>${e.rn}</b></td><td style="max-width:160px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis">${e.sol}</td><td style="max-width:180px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;font-style:italic">"${e.com}"</td><td><span class="npill ${pc}">${nv}</span></td></tr>`;
  }).join('');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FEED
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function addFeed(h){const fb=document.getElementById('feedB');if(!S.feedOn){fb.innerHTML='';S.feedOn=true;}fb.insertAdjacentHTML('afterbegin',h);while(fb.children.length>20)fb.removeChild(fb.lastChild);}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TOAST
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showToast(emoji,title,desc){
  const c=document.getElementById('toasts');
  const t=document.createElement('div');t.className='toast';
  t.innerHTML=`<div class="toast-e">${emoji}</div><div class="toast-bd"><div class="toast-tt">ğŸ† Â¡${title}!</div><div class="toast-ds">${desc}</div><div class="toast-bar"><div class="toast-bar-f"></div></div></div>`;
  c.appendChild(t);miniConf();
  addFeed(`<div class="fc" style="background:#f5f3ff;border-color:#ddd6fe"><div class="fch"><span class="fci-i">${emoji}</span><span class="fct" style="color:var(--purple)">Â¡Logro!</span></div><div class="fcb"><b>${title}</b> â€” ${desc}</div></div>`);
  setTimeout(()=>t.remove(),7500);
}
function miniConf(){const cols=['#4f46e5','#16a34a','#7c3aed','#0891b2','#ca8a04','#ea580c'];for(let i=0;i<20;i++){const c=document.createElement('div');c.className='confetti';c.style.cssText=`left:${70+Math.random()*28}%;background:${cols[i%6]};width:${Math.random()*6+3}px;height:${Math.random()*6+3}px;border-radius:${Math.random()>0.5?'50%':'1px'};animation-duration:${Math.random()*1.4+1}s;animation-delay:${Math.random()*0.3}s;`;document.body.appendChild(c);setTimeout(()=>c.remove(),3000);}}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// HELPERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function nC(){S.cN+=Math.floor(Math.random()*30)+5;return S.cN;}
function aT(){S.mN+=Math.floor(Math.random()*8)+2;if(S.mN>=60){S.mN-=60;S.hN=Math.min(18,S.hN+1);}return`${S.hN}:${String(S.mN).padStart(2,'0')}`;}
function rnd(a){return a[Math.floor(Math.random()*a.length)];}
function flash(c){const el=document.getElementById(c==='r'?'flR':'flG');el.classList.add('show');setTimeout(()=>el.classList.remove('show'),150);}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SIM PROMOTOR
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function simP(){
  const rep=rnd(REPS),pi=Math.floor(Math.random()*PROC.length),com=rnd(CP);
  const cid=nC(),ts=aT();
  S.enc.push({t:'P',rid:rep.id,rn:rep.n,lid:rep.l,proc:PROC[pi],sol:SOL[pi],com:com,cid:cid,ts:ts,hr:S.hN});
  S.p++;S.rachas[rep.id].push('P');
  flash('g');
  const sk=calcSk(S.rachas[rep.id]);const prev=S.rachas[rep.id].length>=2?S.rachas[rep.id][S.rachas[rep.id].length-2]:null;
  addFeed(`<div class="fc pro"><div class="fch"><span class="fci-i">ğŸŸ¢</span><span class="fct" style="color:var(--green)">Promotor</span><span class="fctime">${ts} Â· ${cid}</span></div><div class="fcb"><b>${rep.n}</b> Â· ${PROC[pi]}<br><em>"${com}"</em></div></div>`);
  apply();
  if(sk.type==='P'&&sk.count===5)setTimeout(()=>showToast('ğŸ’','RACHA PERFECTA',`${rep.n} â€” 5 promotores seguidos`),400);
  else if(sk.type==='P'&&prev==='D')setTimeout(()=>showToast('ğŸ›¡ï¸','RECUPERACIÃ“N',`${rep.n} â€” Promotor despuÃ©s de detractor`),400);
  else if(S.p===1&&S.n===0&&S.d===0)setTimeout(()=>showToast('ğŸš€','PRIMER PROMOTOR',`${rep.n} â€” Â¡ArrancÃ³ con todo!`),400);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SIM DETRACTOR
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function simD(){
  const rep=rnd(REPS),pi=Math.floor(Math.random()*PROC.length),com=rnd(CD);
  const cid=nC(),ts=aT();
  S.enc.push({t:'D',rid:rep.id,rn:rep.n,lid:rep.l,proc:PROC[pi],sol:SOL[pi],com:com,cid:cid,ts:ts,hr:S.hN});
  S.d++;S.rachas[rep.id].push('D');
  flash('r');
  const detC=S.enc.filter(x=>x.rid===rep.id&&x.t==='D').length;
  const ref=REPS.filter(r=>r.id!==rep.id);
  const e1=rnd(ref),e2=rnd(ref.filter(r=>r.id!==e1.id));
  addFeed(`<div class="fc det"><div class="fch"><span class="fci-i">ğŸš¨</span><span class="fct" style="color:var(--red)">Detractor</span><span class="fctime">${ts} Â· ${cid}</span></div><div class="fcb"><b>${rep.n}</b> Â· ${PROC[pi]}<br>Sol: ${SOL[pi]}<br><em>"${com}"</em></div><div class="espejo"><div class="espejo-t">ğŸ’¡ Casos espejo â€” Promotor en menor tiempo</div><div class="espejo-i">âœ… ${cid-Math.floor(Math.random()*3000)-800} Â· <b>${e1.n}</b> Â· ${(Math.random()*6+12).toFixed(1)} min â†’ 100%</div><div class="espejo-i">âœ… ${cid-Math.floor(Math.random()*5000)-1500} Â· <b>${e2.n}</b> Â· ${(Math.random()*8+13).toFixed(1)} min â†’ 100%</div></div><div class="pbox"><div class="pbox-t">âš ï¸ Contexto histÃ³rico</div><div style="font-size:8px;color:var(--t2);line-height:1.4"><b>${rep.n}</b> lleva <b>${detC}</b> detractor${detC>1?'es':''} en <em>${PROC[pi].split(' - ')[0]}</em> este mes. Referente: <b>${rnd(ref).n}</b></div></div></div>`);
  apply();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SIM NEUTRO
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function simN(){
  const rep=rnd(REPS),pi=Math.floor(Math.random()*PROC.length),com=rnd(CN);
  const cid=nC(),ts=aT();
  S.enc.push({t:'N',rid:rep.id,rn:rep.n,lid:rep.l,proc:PROC[pi],sol:SOL[pi],com:com,cid:cid,ts:ts,hr:S.hN});
  S.n++;S.rachas[rep.id].push('N');
  addFeed(`<div class="fc neu"><div class="fch"><span class="fci-i">ğŸŸ¡</span><span class="fct" style="color:var(--yellow)">Neutro</span><span class="fctime">${ts} Â· ${cid}</span></div><div class="fcb"><b>${rep.n}</b> Â· ${PROC[pi]}<br><em>"${com}"</em></div></div>`);
  apply();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SIM PATRON
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function simPat(){
  const pr=rnd(PROC).split(' - ')[0],sb=rnd(SOL),sg=rnd(SOL);
  const pD=Math.floor(Math.random()*20)+65,pP=Math.floor(Math.random()*18)+60,at=(Math.random()*6+12).toFixed(1),hr=Math.floor(Math.random()*4)+14;
  addFeed(`<div class="fc pat"><div class="fch"><span class="fci-i">ğŸ§ </span><span class="fct" style="color:var(--indigo)">PatrÃ³n</span><span class="fctime">HistÃ³rico</span></div><div class="fcb"><b>${pr}</b> + <em>"${sb.substring(0,28)}..."</em><br>â†’ <b style="color:var(--red)">${pD}% detractores</b> este mes</div><div class="pbox"><div class="pbox-t">ğŸ’¡ Alternativa</div><div style="font-size:8px;color:var(--t2);line-height:1.4">Con <em>"${sg.substring(0,28)}..."</em> â†’ <b style="color:var(--green)">${pP}% promotor</b> Â· ${at} min<br>DespuÃ©s de las ${hr}:00 detractores +23%</div></div></div>`);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SIM LOGRO
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function simLog(){const l=rnd(LOGROS),rep=rnd(REPS);showToast(l.e,l.t,`${rep.n} â€” ${l.d}`);}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CIERRE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function simCi(t){
  const am=t==='am';
  document.getElementById('ciTL').textContent=am?'CIERRE TURNO MAÃ‘ANA':'CIERRE TURNO TARDE';
  document.getElementById('ciHR').textContent=am?'ğŸ“Š 12:25 PM':'ğŸ“Š 6:30 PM';
  WK[TDI]={d:'MiÃ©',e:S.p+S.n+S.d,p:S.p,n:S.n,dd:S.d};
  document.getElementById('ciWK').innerHTML=WK.map((w,i)=>{
    const today=i===TDI,future=i>TDI;
    const nps=w.e>0?((w.p-w.dd)/w.e*100):null;
    const c=nps===null?'var(--t3)':nps>=36.6?'var(--green)':nps>=0?'var(--yellow)':'var(--red)';
    return`<div class="ci-day ${today?'today':''} ${future?'future':''}"><div style="font-size:9px;font-weight:700;color:var(--t3);margin-bottom:2px">${w.d}</div><div style="font-size:18px;font-weight:800">${future?'--':w.e||'--'}</div><div style="font-size:10px;font-weight:600;color:${future?'var(--t3)':c}">${future?'--':nps!==null?nps.toFixed(1)+'%':'--'}</div></div>`;
  }).join('');
  const wt=WK.reduce((a,w)=>({p:a.p+w.p,n:a.n+w.n,d:a.d+w.dd,e:a.e+w.e}),{p:0,n:0,d:0,e:0});
  const wN=wt.e>0?((wt.p-wt.d)/wt.e*100):null;
  const sn=document.getElementById('ciSN');
  sn.textContent=wN!==null?wN.toFixed(1)+'%':'--%';
  sn.style.color=wN===null?'var(--t3)':wN>=36.6?'var(--green)':wN>=0?'var(--yellow)':'var(--red)';
  const mg=document.getElementById('ciMG');
  if(am)mg.innerHTML=wN>=36.6?'Â¡Por encima de la meta! ğŸ’ª Pueden caer mÃ¡s encuestas,<br>Â¡el turno maÃ±ana dejÃ³ la vara alta! ğŸ”¥':wN>=15?'Cerquita de la meta ğŸ“ˆ<br>Â¡Esperemos que la tarde ayude a cerrar mejor! ğŸ’ª':'Semana retadora, cada encuesta cuenta ğŸ›¤ï¸<br>Â¡Esperemos cerrar mejor al final del dÃ­a!';
  else mg.innerHTML=wN>=36.6?'Â¡Gran cierre! El equipo lo dio todo ğŸ†<br>MaÃ±ana seguimos construyendo. Â¡A descansar! ğŸŒ™':wN>=15?'AsÃ­ cerramos hoy. Pueden caer mÃ¡s encuestas,<br>pero el equipo dio todo. Â¡MaÃ±ana seguimos! ğŸ”¥':'DÃ­a retador, cada dÃ­a es oportunidad nueva ğŸŒ…<br>Â¡MaÃ±ana arrancamos con toda! ğŸ’ª';
  document.getElementById('ciOv').classList.add('show');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// AUTO-PLAY
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let autoT=null;
function simAuto(){
  if(autoT){clearInterval(autoT);autoT=null;return;}
  swTab('rt');
  const seq=['P','P','D','P','N','P','P','P','D','N','P','P','D','P','P','N','P','P','P','D'];
  let i=0;
  autoT=setInterval(()=>{
    if(i>=seq.length){clearInterval(autoT);autoT=null;setTimeout(simPat,300);setTimeout(()=>simCi('pm'),1800);return;}
    seq[i]==='P'?simP():seq[i]==='D'?simD():simN();i++;
  },650);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// AUTO RESET
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function autoReset(){
  S={p:0,n:0,d:0,rachas:{},enc:[],feedOn:false,cN:436200000,hN:8,mN:3,selRep:null,fType:'all',fLid:'all',fRep:'all'};
  REPS.forEach(r=>S.rachas[r.id]=[]);
  WK[TDI]={d:'MiÃ©',e:0,p:0,n:0,dd:0};
  document.getElementById('feedB').innerHTML='<div class="empty" style="padding:20px 8px"><div class="empty-e" style="font-size:28px">ğŸ“¡</div><div class="empty-t" style="font-size:13px">Escuchando...</div><div class="empty-s" style="font-size:10px">Alertas aparecerÃ¡n aquÃ­</div></div>';
  document.querySelectorAll('.fpill').forEach(b=>b.classList.remove('on'));
  document.querySelector('.fpill[data-v="all"]').classList.add('on');
  document.getElementById('fLider').value='all';popRepSel('all');
  apply();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PRE-POPULATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function prePop(){
  const data=[
    {t:'P',r:0},{t:'P',r:1},{t:'D',r:2},{t:'P',r:3},{t:'N',r:4},
    {t:'P',r:5},{t:'P',r:0},{t:'D',r:6},{t:'P',r:7},{t:'P',r:1},
    {t:'N',r:8},{t:'P',r:9},{t:'D',r:10},{t:'P',r:11},{t:'P',r:3},
    {t:'P',r:5},{t:'N',r:7},{t:'P',r:0},{t:'D',r:2},{t:'P',r:9}
  ];
  data.forEach(d=>{
    const rep=REPS[d.r],pi=Math.floor(Math.random()*PROC.length);
    const com=d.t==='P'?rnd(CP):d.t==='D'?rnd(CD):rnd(CN);
    const cid=nC(),ts=aT();
    S.enc.push({t:d.t,rid:rep.id,rn:rep.n,lid:rep.l,proc:PROC[pi],sol:SOL[pi],com:com,cid:cid,ts:ts,hr:S.hN});
    if(d.t==='P')S.p++;else if(d.t==='D')S.d++;else S.n++;
    S.rachas[rep.id].push(d.t);
  });
  // Feed
  S.feedOn=true;
  const fb=document.getElementById('feedB');fb.innerHTML='';
  [...S.enc].reverse().slice(0,10).forEach(e=>{
    const cls=e.t==='P'?'pro':e.t==='D'?'det':'neu';
    const icon=e.t==='P'?'ğŸŸ¢':e.t==='D'?'ğŸš¨':'ğŸŸ¡';
    const lab=e.t==='P'?'Promotor':e.t==='D'?'Detractor':'Neutro';
    const col=e.t==='P'?'var(--green)':e.t==='D'?'var(--red)':'var(--yellow)';
    let extra='';
    if(e.t==='D'){const ref=REPS.filter(r=>r.id!==e.rid);extra=`<div class="espejo"><div class="espejo-t">ğŸ’¡ Casos espejo</div><div class="espejo-i">âœ… ${e.cid-900} Â· <b>${rnd(ref).n}</b> Â· ${(Math.random()*5+13).toFixed(1)} min â†’ 100%</div></div><div class="pbox"><div class="pbox-t">âš ï¸ Contexto</div><div style="font-size:8px;color:var(--t2);line-height:1.3"><b>${e.rn}</b> lleva <b>${S.enc.filter(x=>x.rid===e.rid&&x.t==='D').length}</b> det. en <em>${e.proc.split(' - ')[0]}</em>. Ref: <b>${rnd(ref).n}</b></div></div>`;}
    fb.insertAdjacentHTML('beforeend',`<div class="fc ${cls}" style="animation:none"><div class="fch"><span class="fci-i">${icon}</span><span class="fct" style="color:${col}">${lab}</span><span class="fctime">${e.ts} Â· ${e.cid}</span></div><div class="fcb"><b>${e.rn}</b> Â· ${e.proc}<br><em>"${e.com}"</em></div>${extra}</div>`);
  });
}
</script>
</body>
</html>

